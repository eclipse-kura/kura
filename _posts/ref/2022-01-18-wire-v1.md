---
layout: page
title:  "WIRE-V1 REST API and MQTT Request Handler"
categories: [ref]
---

The WIRE-V1 cloud request handler and the corresponding REST APIs allow to update, delete and get the current Wire Graph status. This request handler provides the equivalent of the `org.eclipse.kura.wire.graph.WireGraphService` Java API.

The WIRE-V1 request handler is compatible with the Wire Graph import/export functionality of the ESF Web UI. In fact, the get and update operations respectively consume and produce a JSON object specified by [ComponentConfigurationList]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#componentconfigurationlist).
A valid object in this format can be obtained by navigating to the **Wires** section of ESF web UI, clicking the **Download** button and selecting the JSON format download.

Accessing the REST APIs requires to use an identity with the `rest.configuration` permission assigned.
## Request definitions
#### GET/graph
  * **REST API path** : /services/wire/v1/graph
  * **description** : Returns the current Wire Graph Configuration as a [ComponentConfigurationList]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#componentconfigurationlist) object. The received configuration will include the [WireGraphService]({{ site.baseurl }}{% link _posts/ref/2022-01-18-wire-graph-service.md %}) configuration containing the graph layout and the configuration of the components currently referenced by the Wire Graph.
  * **responses** :
    * **200**
      * **description** : The current wire graph configuration.
      * **response body** :
        * [ComponentConfigurationList]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#componentconfigurationlist) 
    * **500**
      * **description** : An unexpected internal error occurred.
      * **response body** :
        * [GenericFailureReport]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#genericfailurereport)

#### PUT/graph
  * **REST API path** : /services/wire/v1/graph
  * **description** : Updates the current Wire Graph.
  * **request body** :
    * [ComponentConfigurationList]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#componentconfigurationlist) 
  * **responses** :
    * **200**
      * **description** : The current Wire Graph has been updated.
    * **400**
      * **description** : The request body is not valid JSON or it contains invalid parameters.
      * **response body** :
        * [GenericFailureReport]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#genericfailurereport)
    * **500**
      * **description** : An unexpected internal error occurred.
      * **response body** :
        * [GenericFailureReport]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#genericfailurereport)

This request will replace the current graph topology with the received one.

* Wire Components and Wires that are specified in the request and do not exist on the current graph on the device will be created.
* Wire Components and Wires that exist in the current graph but are not included in the request will be deleted.
* Wire Component configurations and rendering properties of existing Wire Components will be updated.

The received configuration must satisfy the following requirements. If any of the requirements is not met, the operation will fail and no changes will be applied to the system:

  * The configuration of the `org.eclipse.kura.wire.graph.WireGraphService` component must be specified.
  * The configuration of the `org.eclipse.kura.wire.graph.WireGraphService` component must contain a property named `WireGraph` of `STRING` type containing the graph layout as described in the [WireGraphService]({{ site.baseurl }}{% link _posts/ref/2022-01-18-wire-graph-service.md %}) document.
  * The `inputPortCount` and `outputPortCount` properties must be specified for all components in **WireGraphService** configuration.
  * The configuration of all components referenced by **WireGraphService** configuration that do not exist on target device must be specified.
  * The configuration of all components referenced by **WireGraphService** configuration that do not exist on target device must specify the `service.factoryPid` configuration property reporting the component factory pid.

It is possible to omit the configurations of the Wire Components that are already part of the current Wire Graph whose configuration does not need to be changed. The full graph layout in the **WireGraphService** `WireGraph` property must always be specified.

If a component already exists on the system and its configuration is supplied as part of the request, the component configuration will be updated. In this case the usual configuration merge semantics will be applied, the set of received properties will be merged with the existing one. The properties in the request body will overwrite the existing ones with the same name.

It is also allowed to specify configurations that are not referenced by the Wire Graph in request body (e.g. Driver configurations), in this case these configurations will updated or created in case of factory components not yet existing on the system.

#### DEL/graph
  * **REST API path** : /services/wire/v1/graph
  * **description** : Deletes the current Wire Graph.
  * **responses** :
    * **200**
      * **description** : The current wire graph has been deleted.
    * **500**
      * **description** : An unexpected internal error occurred.
      * **response body** :
        * [GenericFailureReport]({{ site.baseurl }}{% link _posts/ref/2021-12-13-conf-v2.md %}#genericfailurereport)

## GET/POST format example
```json
{
  "configs": [
    {
      "pid": "org.eclipse.kura.wire.graph.WireGraphService",
      "properties": {
        "WireGraph": {
          "type": "STRING",
          "value": "{\"components\":[{\"pid\":\"timer\",\"inputPortCount\":0,\"outputPortCount\":1,\"renderingProperties\":{\"position\":{\"x\":-300,\"y\":-20},\"inputPortNames\":{},\"outputPortNames\":{}}},{\"pid\":\"logger\",\"inputPortCount\":1,\"outputPortCount\":0,\"renderingProperties\":{\"position\":{\"x\":-100,\"y\":-20},\"inputPortNames\":{},\"outputPortNames\":{}}}],\"wires\":[{\"emitter\":\"timer\",\"emitterPort\":0,\"receiver\":\"logger\",\"receiverPort\":0}]}"
        }
      }
    },
    {
      "pid": "timer",
      "properties": {
        "componentDescription": {
          "type": "STRING",
          "value": "A wire component that fires a ticking event on every configured interval"
        },
        "componentId": {
          "type": "STRING",
          "value": "timer"
        },
        "componentName": {
          "type": "STRING",
          "value": "Timer"
        },
        "cron.interval": {
          "type": "STRING",
          "value": "0/10 * * * * ?"
        },
        "emitter.port.count": {
          "type": "INTEGER",
          "value": 1
        },
        "factoryComponent": {
          "type": "BOOLEAN",
          "value": false
        },
        "factoryPid": {
          "type": "STRING",
          "value": "org.eclipse.kura.wire.Timer"
        },
        "kura.service.pid": {
          "type": "STRING",
          "value": "timer"
        },
        "receiver.port.count": {
          "type": "INTEGER",
          "value": 0
        },
        "service.factoryPid": {
          "type": "STRING",
          "value": "org.eclipse.kura.wire.Timer"
        },
        "service.pid": {
          "type": "STRING",
          "value": "org.eclipse.kura.wire.Timer-1642493602000-13"
        },
        "simple.custom.first.tick.interval": {
          "type": "INTEGER",
          "value": 0
        },
        "simple.first.tick.policy": {
          "type": "STRING",
          "value": "DEFAULT"
        },
        "simple.interval": {
          "type": "INTEGER",
          "value": 10
        },
        "simple.time.unit": {
          "type": "STRING",
          "value": "SECONDS"
        },
        "type": {
          "type": "STRING",
          "value": "SIMPLE"
        }
      }
    },
    {
      "pid": "logger",
      "properties": {
        "componentDescription": {
          "type": "STRING",
          "value": "A wire component which logs data as received from upstream connected Wire Components"
        },
        "componentId": {
          "type": "STRING",
          "value": "logger"
        },
        "componentName": {
          "type": "STRING",
          "value": "Logger"
        },
        "emitter.port.count": {
          "type": "INTEGER",
          "value": 0
        },
        "factoryComponent": {
          "type": "BOOLEAN",
          "value": false
        },
        "factoryPid": {
          "type": "STRING",
          "value": "org.eclipse.kura.wire.Logger"
        },
        "kura.service.pid": {
          "type": "STRING",
          "value": "logger"
        },
        "log.verbosity": {
          "type": "STRING",
          "value": "QUIET"
        },
        "receiver.port.count": {
          "type": "INTEGER",
          "value": 1
        },
        "service.factoryPid": {
          "type": "STRING",
          "value": "org.eclipse.kura.wire.Logger"
        },
        "service.pid": {
          "type": "STRING",
          "value": "org.eclipse.kura.wire.Logger-1642493602046-14"
        }
      }
    }
  ]
}
```