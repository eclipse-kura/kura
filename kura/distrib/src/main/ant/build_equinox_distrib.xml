<!--

    Copyright (c) 2011, 2018 Eurotech and others

     All rights reserved. This program and the accompanying materials
     are made available under the terms of the Eclipse Public License v1.0
     which accompanies this distribution, and is available at
     http://www.eclipse.org/legal/epl-v10.html

    Contributors:
      Eurotech
      Red Hat Inc
-->
<project name="build_equinox_distrib" default="dist-linux" basedir="../../../">

	<target name="dist-linux">

		<property name="build.output.name" value="kura_${project.version}_${build.name}"/>

		<!--
        Loads entries from a manifest file.
        @jar     The jar from where to read
        @prefix  A prefix to prepend
        -->
		<macrodef name="loadmf">
			<attribute name="jar"/>
			<attribute name="prefix" default=""/>
			<sequential>
				<loadproperties>
					<!-- Load the manifest entries -->
					<zipentry zipfile="@{jar}" name="META-INF/MANIFEST.MF"/>
					<!-- Add the prefix -->
					<filterchain>
						<prefixlines prefix="@{prefix}"/>
					</filterchain>
				</loadproperties>
			</sequential>
		</macrodef>

		<echo message="Building Kura Distribution for ${build.output.name}..." />
		<echo message="Dave: ${kura.install.dir}" />

		<copy file="src/main/resources/${build.name}/kura.properties"
              tofile="${project.build.directory}/${build.output.name}/kura.properties" />
		<propertyfile file="${project.build.directory}/${build.output.name}/kura.properties">
			<entry key="kura.version"   value="KURA_${kura.version}" />
			<entry key="kura.home"   value="${kura.install.dir}/kura/kura" />
			<entry key="kura.plugins"   value="${kura.install.dir}/kura/kura/plugins" />
			<entry key="kura.packages"   value="${kura.install.dir}/kura/kura/packages" />

			<entry key="kura.marketplace.compatibility.version"   value="KURA_${kura.version}" />

			<entry key="kura.data"   value="${kura.install.dir}/kura/data" />
			<entry key="kura.snapshots"   value="${kura.install.dir}/kura/data/snapshots" />
			<entry key="kura.style.dir"   value="${kura.install.dir}/kura/console/skin" />

			<entry key="version"       value="${kura.version}" />
			<entry key="build.version" value="${buildNumber}" />
			<entry key="build.number"  value="${build.name}-${buildNumber}" />
		</propertyfile>
		<replace file="${project.build.directory}/${build.output.name}/kura.properties" token="{kura.install.dir}" value="${kura.install.dir}"/>
		<replace file="${project.build.directory}/${build.output.name}/kura.properties" token="{kura.symlink}" value="${kura.symlink}"/>


		<condition property="kura.osgi.repo" value="../../target-platform/p2-repo-equinox_3.12.50/target/source">
			<or>
				<not>
					<isset property="kura.osgi"/>
				</not>
				<equals arg1="${kura.osgi}" arg2="equinox"/>
			</or>
		</condition>

		<copy file="src/main/resources/${build.name}/snapshot_0.xml"
              tofile="${project.build.directory}/${build.output.name}/snapshot_0.xml" />
		<copy file="src/main/osgi/equinox_3.12.50/configuration/config.ini"
              tofile="${project.build.directory}/${build.output.name}/config.ini" />

		<!-- Copy jdk.dio files -->
		<copy file="src/main/resources/${build.name}/jdk.dio.properties"
              tofile="${project.build.directory}/${build.output.name}/jdk.dio.properties" />
		<copy file="src/main/resources/common/jdk.dio.policy"
              tofile="${project.build.directory}/${build.output.name}/jdk.dio.policy" />
              
    	<copy file="src/main/resources/common/cacerts.ks" tofile="${project.build.directory}/${build.output.name}/cacerts.ks" />


        <!-- Populate config.ini with correct OSGi packages -->
		<antcall target="osgi-base-config" />

		<!-- Populate config.ini with correct versions -->
		<replace file="${project.build.directory}/${build.output.name}/config.ini"
                 token="{kura.build.version}" value="${kura.build.version}"/>

		<!-- Populate config.ini with correct Kura bundles -->
		<antcall target="api-config" />
		<antcall target="core-config" />
		<antcall target="core.certificates-config" />
		<antcall target="core.cloud-config" />
		<antcall target="core.comm-config" />
		<antcall target="core.configuration-config" />
		<antcall target="core.crypto-config" />
		<antcall target="core.deployment-config" />
		<antcall target="core.net-config" />
		<antcall target="core.status-config" />
		<antcall target="deployment.agent-config" />
		<antcall target="linux.clock-config" />
		<antcall target="linux.command-config" />
		<antcall target="linux.position-config" />
		<antcall target="linux.usb-config" />
		<antcall target="linux.bluetooth-config" />
		<antcall target="linux.watchdog-config" />


		<!-- Added Camel bundles configs -->
		<antcall target="camel-config" />

		<!-- Rest bundles config -->
		<antcall target="rest-config" />

		<!-- Asset bundles config -->
		<antcall target="asset-config" />

		<!-- Added Artemis bundles configs -->
		<antcall target="artemis-config" />

		<!-- Deployment hook bundles configs -->
		<antcall target="deployment-hooks-config" />
		
		<!-- Marshalling bundles configs -->
		<antcall target="marshallers-config" />

		<!-- Wires bundles config -->
		<antcall target="wires-config" />

		<!-- Miscellaneous bundles config -->
		<antcall target="misc-config" />

		<!-- Conditional entries. Check for jar presence, and invoke relevant ant target-->
		<available file="${project.build.directory}/plugins/org.eclipse.kura.web2_${org.eclipse.kura.web2.version}.jar" property="is.web2.jar.available" />
		<antcall target="web2-config" />

		<available file="${project.build.directory}/plugins/org.eclipse.kura.linux.gpio_${org.eclipse.kura.linux.gpio.version}.jar" property="linux.gpio.jar.present" />
		<antcall target="gpio-config" />
		<antcall target="emulator-gpio-config" />


		<condition property="is.nn">
			<contains string="${build.name}" substring="-nn"/>
		</condition>
		<antcall target="emulator-config" />
		<antcall target="linux-config" />


		<!-- Add mToolkit to config.ini -->
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
                   value=", reference:file:../plugins/org.tigris.mtoolkit.iagent.rpc_3.0.0.20110411-0918.jar@5:start" />
		</propertyfile>



		<propertyfile file="${project.build.directory}/${build.output.name}/dpa.properties">
			<entry key="kura"
                   value="file:${kura.install.dir}/kura/kura/packages/${build.output.name}.dp" />
		</propertyfile>

		<!-- Set web UI port -->
		<antcall target="set-http-port" />

		<!-- Copy selinux policy change -->
		<copy file="src/main/resources/${build.name}/selinuxKura.pp" tofile="${project.build.directory}/${build.output.name}/selinuxKura.pp" failonerror="false" />

		<!-- Create the Kura start scripts -->
		<echo file="${project.build.directory}/${build.output.name}/start_kura.sh" append="false"><![CDATA[#!/bin/sh

export PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/opt/jvm/bin:/usr/java/bin:$PATH
export MALLOC_ARENA_MAX=1

DIR=$(cd $(dirname $0)/..; pwd)
cd $DIR

# set up the configuration area
mkdir -p /tmp/.kura/configuration
cp ${DIR}/kura/config.ini /tmp/.kura/configuration/

KURA_RUNNING=`ps ax | grep java | grep "org.eclipse.osgi"`

if [ -z "$KURA_RUNNING" ] ; then
        exec java -Xms${kura.mem.size} -Xmx${kura.mem.size} \
        -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/log/kura-heapdump.hprof \
        -XX:ErrorFile=/var/log/kura-error.log \
        -XX:+IgnoreUnrecognizedVMOptions \
        --add-modules=java.sql,java.xml,java.xml.bind \
        -Dkura.os.version=${kura.os.version} \
        -Dkura.arch=${kura.arch} \
        -Dtarget.device=${target.device} \
        -Declipse.ignoreApp=true \
        -Dkura.home=${DIR}/kura \
        -Dkura.configuration=file:${DIR}/kura/kura.properties \
        -Dkura.custom.configuration=file:${DIR}/kura/kura_custom.properties \
        -Dkura.data.dir=${DIR}/data \
        -Ddpa.configuration=${DIR}/kura/dpa.properties \
        -Dlog4j.configurationFile=file:${DIR}/kura/log4j.xml \
        -Djava.security.policy=${DIR}/kura/jdk.dio.policy \
        -Djdk.dio.registry=${DIR}/kura/jdk.dio.properties \
        -Djdk.tls.trustNameService=true \
        -Dosgi.console \
        -Declipse.consoleLog=true \
        -jar ${DIR}/plugins/org.eclipse.equinox.launcher_${org.eclipse.equinox.launcher.version}.jar \
        -configuration  /tmp/.kura/configuration
else
		echo "Failed to start Kura. It is already running ..."
fi]]>
	</echo>
		<echo file="${project.build.directory}/${build.output.name}/start_kura_debug.sh" append="false"><![CDATA[#!/bin/sh

export PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/opt/jvm/bin:/usr/java/bin:$PATH
export MALLOC_ARENA_MAX=1

DIR=$(cd $(dirname $0)/..; pwd)
cd $DIR

# set up the configuration area
mkdir -p /tmp/.kura/configuration
cp ${DIR}/kura/config.ini /tmp/.kura/configuration/

KURA_RUNNING=`ps ax | grep java | grep "org.eclipse.osgi"`

if [ -z "$KURA_RUNNING" ] ; then
        exec java -Xms${kura.mem.size} -Xmx${kura.mem.size} \
        -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:/var/log/kura-gc.log \
        -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M \
        -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/log/kura-heapdump.hprof \
        -XX:ErrorFile=/var/log/kura-error.log \
        -XX:+IgnoreUnrecognizedVMOptions \
        --add-modules=java.sql,java.xml,java.xml.bind \
        -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8000,suspend=n \
        -Dkura.os.version=${kura.os.version} \
        -Dkura.arch=${kura.arch} \
        -Dtarget.device=${target.device} \
        -Declipse.ignoreApp=true \
        -Dkura.home=${DIR}/kura \
        -Dkura.configuration=file:${DIR}/kura/kura.properties \
        -Dkura.custom.configuration=file:${DIR}/kura/kura_custom.properties \
        -Dkura.data.dir=${DIR}/data \
        -Ddpa.configuration=${DIR}/kura/dpa.properties \
        -Dlog4j.configurationFile=file:${DIR}/kura/log4j.xml \
        -Djava.security.policy=${DIR}/kura/jdk.dio.policy \
        -Djdk.dio.registry=${DIR}/kura/jdk.dio.properties \
        -Djdk.tls.trustNameService=true \
        -Dosgi.console \
        -Declipse.consoleLog=true \
        -jar ${DIR}/plugins/org.eclipse.equinox.launcher_${org.eclipse.equinox.launcher.version}.jar \
        -configuration  /tmp/.kura/configuration
else
		echo "Failed to start Kura. It is already running ..."
fi]]>
	</echo>
		<echo file="${project.build.directory}/${build.output.name}/start_kura_background.sh" append="false"><![CDATA[#!/bin/sh

# Kura should be installed to the ${kura.install.dir} directory.
export PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/opt/jvm/bin:/usr/java/bin:$PATH
export MALLOC_ARENA_MAX=1

DIR=$(cd $(dirname $0)/..; pwd)
cd $DIR

# set up the configuration area
mkdir -p /tmp/.kura/configuration
cp ${DIR}/kura/config.ini /tmp/.kura/configuration/

KURA_RUNNING=`ps ax | grep java | grep "org.eclipse.osgi"`

if [ -z "$KURA_RUNNING" ] ; then
  nohup java -Xms${kura.mem.size} -Xmx${kura.mem.size} \
        -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/log/kura-heapdump.hprof \
        -XX:ErrorFile=/var/log/kura-error.log \
        -XX:+IgnoreUnrecognizedVMOptions \
        --add-modules=java.sql,java.xml,java.xml.bind \
        -Dkura.os.version=${kura.os.version} \
        -Dkura.arch=${kura.arch} \
        -Dtarget.device=${target.device} \
        -Declipse.ignoreApp=true \
        -Dkura.home=${DIR}/kura \
        -Dkura.configuration=file:${DIR}/kura/kura.properties \
        -Dkura.custom.configuration=file:${DIR}/kura/kura_custom.properties \
        -Dkura.data.dir=${DIR}/data \
        -Ddpa.configuration=${DIR}/kura/dpa.properties \
        -Dlog4j.configurationFile=file:${DIR}/kura/log4j.xml \
        -Djava.security.policy=${DIR}/kura/jdk.dio.policy \
        -Djdk.dio.registry=${DIR}/kura/jdk.dio.properties \
        -Djdk.tls.trustNameService=true \
        -Dosgi.console=5002 \
        -Declipse.consoleLog=true >> /var/log/kura-console.log 2>> /var/log/kura-console.log \
        -jar ${DIR}/plugins/org.eclipse.equinox.launcher_${org.eclipse.equinox.launcher.version}.jar \
        -configuration /tmp/.kura/configuration &

    #Save the PID
    KURA_PID=$!
    echo "Kura Started (pid="$KURA_PID") ..." >> /var/log/kura-console.log
    echo $KURA_PID > /var/run/kura.pid
else
    echo "Failed to start Kura. It is already running ..." >> /var/log/kura-console.log
fi]]>
	</echo>

		<!-- Populate parameters -->
		<copy file="src/main/resources/${build.name}/kura_install.sh"
              tofile="${project.build.directory}/${build.output.name}/kura_install.sh" />
		<copy file="src/main/resources/common/kura.init.yocto"
              tofile="${project.build.directory}/${build.output.name}/kura.init.yocto"
              failonerror="false" />
		<copy file="src/main/resources/common/kura.init.raspbian"
              tofile="${project.build.directory}/${build.output.name}/kura.init.raspbian"
        	  failonerror="false" />
		<copy file="src/main/resources/common/kura.service"
              tofile="${project.build.directory}/${build.output.name}/kura.service"
        	  failonerror="false" />
		<replaceregexp file="${project.build.directory}/${build.output.name}/kura_install.sh" match="INSTALL_DIR=.*" replace="INSTALL_DIR=${kura.install.dir}" />
		<replaceregexp file="${project.build.directory}/${build.output.name}/kura.init.yocto" match="INSTALL_DIR=.*" replace="INSTALL_DIR=${kura.install.dir}" />
		<replaceregexp file="${project.build.directory}/${build.output.name}/kura.init.raspbian" match="INSTALL_DIR=.*" replace="INSTALL_DIR=${kura.install.dir}" />
		<replaceregexp file="${project.build.directory}/${build.output.name}/kura.service" match="INSTALL_DIR" replace="${kura.install.dir}" />

		<zip destfile="${project.build.directory}/${build.output.name}.zip">

			<zipfileset file="${project.build.directory}/${build.output.name}/snapshot_0.xml"
                        prefix="${build.output.name}/data/snapshots/" />

			<zipfileset file="${project.build.directory}/${build.output.name}/config.ini"
                        prefix="${build.output.name}/kura/" />

			<zipfileset file="${project.build.directory}/${build.output.name}/jdk.dio.policy"
                        prefix="${build.output.name}/kura/" />

			<zipfileset file="${project.build.directory}/${build.output.name}/jdk.dio.properties"
                        prefix="${build.output.name}/kura/" />
                        
            <zipfileset file="${project.build.directory}/${build.output.name}/cacerts.ks" prefix="${build.output.name}/security/" />

			<zipfileset file="src/main/resources/common/kura_custom.properties"
                        prefix="${build.output.name}/kura/" />

			<zipfileset file="${project.build.directory}/${build.output.name}/kura_install.sh"
                        prefix="${build.output.name}/install/" />

			<zipfileset file="src/main/resources/${build.name}/kuranet.conf"
                        prefix="${build.output.name}/install/" />

			<zipfileset file="${project.build.directory}/${build.output.name}/kura.init.yocto"
                        prefix="${build.output.name}/install" />
			<zipfileset file="${project.build.directory}/${build.output.name}/kura.init.raspbian"
                        prefix="${build.output.name}/install" />
			<zipfileset file="${project.build.directory}/${build.output.name}/kura.service"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/${build.name}/recover_default_config.init"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/${build.name}/firewall.init"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/${build.name}/iptables.init"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/monit.init.raspbian"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/monitrc.raspbian"
                        prefix="${build.output.name}/install" />
            <zipfileset file="src/main/resources/${build.name}/kura-tmpfiles.conf"
                        prefix="${build.output.name}/install" />


			<zipfileset file="src/main/resources/common/logrotate.conf"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/kura.logrotate"
                        prefix="${build.output.name}/install" />

            <zipfileset file="src/main/resources/common/sysctl.kura.conf"
                         prefix="${build.output.name}/install" />
            <zipfileset file="src/main/resources/common/sysctl.kura.raspbian.conf"
                         prefix="${build.output.name}/install" />
            <zipfileset file="src/main/resources/common/patch_sysctl.sh"
                         prefix="${build.output.name}/install" />

			<zipfileset file="src/main/resources/common/hostapd.conf"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/dhcpd-eth0.conf"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/dhcpd-wlan0.conf"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/dhcpd-enp2s0.conf"
                        prefix="${build.output.name}/install" />
			<!-- <intel-edison> -->
			<zipfileset file="src/main/resources/${build.name}/udhcpd-for-hostapd.service"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/${build.name}/udhcpd-usb0.conf"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/${build.name}/udhcpd-wlan0.conf"
                        prefix="${build.output.name}/install" />
			<!-- </intel-edison> -->
			<zipfileset file="src/main/resources/common/named/named.conf"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/named/named.ca"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/named/named.rfc1912.zones"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/named/usr.sbin.named"
        	              prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/${build.name}/bind.init"
                        prefix="${build.output.name}/install" />

			<zipfileset file="src/main/resources/common/ifcfg-eth0"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/ifcfg-eth1"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/ifcfg-wlan0"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/network.interfaces"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/network.interfaces.raspbian"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/network.interfaces.ubuntu"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/ifdown-local"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/ifup-local"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/ifup-local.debian"
                        prefix="${build.output.name}/install" />
			<zipfileset file="src/main/resources/common/ifup-local.raspbian"
                        prefix="${build.output.name}/install" />

			<zipfileset file="${project.build.directory}/${build.output.name}/selinuxKura.pp"
                prefix="${build.output.name}/install" />

			<zipfileset file="${project.build.directory}/${build.output.name}/start_kura.sh"
                        fullpath="${build.output.name}/bin/start_kura.sh" filemode="777" />
			<zipfileset file="${project.build.directory}/${build.output.name}/start_kura_debug.sh"
                        fullpath="${build.output.name}/bin/start_kura_debug.sh" filemode="777" />
			<zipfileset file="${project.build.directory}/${build.output.name}/start_kura_background.sh"
                        fullpath="${build.output.name}/bin/start_kura_background.sh" filemode="777" />

			<zipfileset file="RELEASE_NOTES.txt"
                        prefix="${build.output.name}/kura/" />
			<zipfileset file="notice.html"
                        prefix="${build.output.name}/" />
			<zipfileset file="epl-v10.html"
                        prefix="${build.output.name}/" />
			<zipfileset file="src/main/resources/${build.name}/log4j.xml"
                        prefix="${build.output.name}/kura/" />
			<zipfileset file="${project.build.directory}/${build.output.name}/kura.properties"
                        prefix="${build.output.name}/kura/" />

			<zipfileset dir="${kura.osgi.repo}/plugins/"
                        prefix="${build.output.name}/plugins">

				<!-- exclude source bundles -->
				<exclude name="*.source_*.jar"/>
				<!-- exclude .SNAPSHOT bundles -->
				<exclude name="*.SNAPSHOT.jar"/>

			</zipfileset>

			<zipfileset dir="../target-definition/common/repository/plugins"
                        prefix="${build.output.name}/plugins">

				<exclude name="com.google.protobuf_2.6.0.jar"/>
				<exclude name="org.eclipse.paho.*"/>
				<exclude name="com.gwt.user_*"/>
				<exclude name="org.junit*"/>
				<exclude name="org.moka7*"/>
				<exclude name="tinyb*"/>

				<!-- exclude source bundles -->
				<exclude name="*.source_*.jar"/>

				<!-- exclude .SNAPSHOT bundles -->
				<exclude name="*.SNAPSHOT.jar"/>

			</zipfileset>

			<!-- add .SNAPSHOT as -SNAPSHOT -->
			<mappedresources>
				<fileset dir="${kura.osgi.repo}/plugins" includes="*.SNAPSHOT.jar" />
				<globmapper from="*.SNAPSHOT.jar" to="${build.output.name}/plugins/*-SNAPSHOT.jar" />
			</mappedresources>
			<mappedresources>
				<fileset dir="../target-definition/common/repository/plugins" includes="*.SNAPSHOT.jar" excludes="tinyb*"/>
				<globmapper from="*.SNAPSHOT.jar" to="${build.output.name}/plugins/*-SNAPSHOT.jar" />
			</mappedresources>

			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.deployment.agent_${org.eclipse.kura.deployment.agent.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.api_${org.eclipse.kura.api.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core_${org.eclipse.kura.core.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.certificates_${org.eclipse.kura.core.certificates.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.cloud_${org.eclipse.kura.core.cloud.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.comm_${org.eclipse.kura.core.comm.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.configuration_${org.eclipse.kura.core.configuration.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.crypto_${org.eclipse.kura.core.crypto.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.deployment_${org.eclipse.kura.core.deployment.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.net_${org.eclipse.kura.core.net.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.clock_${org.eclipse.kura.linux.clock.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.command_${org.eclipse.kura.linux.command.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.position_${org.eclipse.kura.linux.position.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.usb_${org.eclipse.kura.linux.usb.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.usb.${native.tag}_${org.eclipse.kura.linux.usb.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.bluetooth_${org.eclipse.kura.linux.bluetooth.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
	        <zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.ble.provider_${org.eclipse.kura.ble.provider.version}.jar"
	                        prefix="${build.output.name}/kura/plugins" />
            <zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.ble.ibeacon.provider_${org.eclipse.kura.ble.ibeacon.provider.version}.jar"
                            prefix="${build.output.name}/kura/plugins" />
            <zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.ble.eddystone.provider_${org.eclipse.kura.ble.eddystone.provider.version}.jar"
                            prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.watchdog_${org.eclipse.kura.linux.watchdog.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.core.status_${org.eclipse.kura.core.status.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.gpio_${org.eclipse.kura.linux.gpio.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux_${org.eclipse.kura.linux.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
		</zip>

		<antcall target="camel-jar" />

		<antcall target="rest-jar" />

		<antcall target="asset-jar" />

		<antcall target="artemis-jar" />

		<antcall target="marshallers-jar" />
		<antcall target="deployment-hooks-jar" />

		<antcall target="wires-jar" />

		<antcall target="misc-jar" />

		<!-- Conditional inclusion of jar files in the distribution jar -->
		<antcall target="web2-jar" />
		<antcall target="gpio-jar" />
		<antcall target="emulator-gpio-jar" />
		<antcall target="emulator-jars" />
		<antcall target="linux-jars" />
		<antcall target="tinyb-jars" />

		<echo message="Building Kura Distribution for ${build.name}-jars..." />

		<!-- Create installer script -->
		<echo message="Creating Installer for ${build.name}  ${kura.install.dir}" />
		<exec executable="${project.build.directory}/../src/main/sh/create_installer.sh">
			<arg value="${project.build.directory}" />
			<arg value="${build.output.name}.zip" />
			<arg value="kura_${project.version}_${build.name}_installer.sh" />
			<arg value="${build.name}" />
			<arg value="${kura.install.dir}" />
		</exec>



		<!-- Get version information for the bundles/files in this build -->
		<echo message="Gathering version information for the bundles/files in ${build.name}" />
		<exec executable="src/main/sh/get_build_versions.sh">
			<arg value="${project.build.directory}" />
			<arg value="${build.output.name}.zip" />
			<arg value="kura_${project.version}_${build.name}.catalog" />
			<arg value="${build.name}" />
		</exec>


		<!-- Diff with the previous version -->
		<property file="RELEASE_INFO/version.properties" />
		<echo message="Diff version information with ${build.name} version ${kura.project.version.previous}" />
		<exec executable="src/main/sh/diff_build_versions.sh">
			<arg value="RELEASE_INFO/${kura.project.version.previous}/kura_${kura.project.version.previous}_${build.name}.catalog" />
			<arg value="${project.build.directory}/${build.output.name}.catalog" />
			<arg value="${project.build.directory}/kura_${kura.project.version.previous}_to_${project.version}_${build.name}" />
			<arg value="${build.name}" />
		</exec>


		<!-- Create upgrader -->
		<echo message="Creating Upgrader for ${build.name}" />
		<exec executable="${project.build.directory}/../src/main/sh/create_upgrader.sh">
			<arg value="${project.build.directory}" />
			<arg value="${project.build.directory}/${build.output.name}.zip" />
			<arg value="kura_${project.version}_${build.name}_upgrade.zip" />
			<arg value="KURA_${kura.project.version.previous}" />
			<arg value="${kura.install.dir}" />
			<arg value="${build.output.name}" />
			<arg value="kura_${kura.project.version.previous}_to_${project.version}_${build.name}.removed" />
			<arg value="kura_${kura.project.version.previous}_to_${project.version}_${build.name}.keep" />
			<arg value="${build.output.name}_upgrader.sh" />
			<arg value="${build.name}" />
		</exec>
	</target>

	<target name="set-http-port" if="http.port">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="org.osgi.service.http.port" operation="="
                   value="${http.port}" />
		</propertyfile>
	</target>

	<!-- OSGi base configs -->
	<target name="osgi-base-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value="reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.cm_${org.eclipse.equinox.cm.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.kura.sun.misc_${org.eclipse.kura.sun.misc.version}.jar@1" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.common_${org.eclipse.equinox.common.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.registry_${org.eclipse.equinox.registry.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.http.registry_${org.eclipse.equinox.http.registry.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.console_${org.eclipse.equinox.console.version}.jar@1" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.ds_${org.eclipse.equinox.ds.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.event_${org.eclipse.equinox.event.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.io_${org.eclipse.equinox.io.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.metatype_${org.eclipse.equinox.metatype.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.util_${org.eclipse.equinox.util.version}.jar@1:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.osgi.services_${org.eclipse.osgi.services.version}.jar@2:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.osgi.util_${org.eclipse.osgi.util.version}.jar@2:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.felix.scr_${org.apache.felix.scr.version}.jar@5" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.felix.gogo.command_${org.apache.felix.gogo.command.version}.jar@5" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.felix.gogo.runtime_${org.apache.felix.gogo.runtime.version}.jar@5" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.felix.gogo.shell_${org.apache.felix.gogo.shell.version}.jar@5" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.knowhowlab.osgi.monitoradmin_${org.knowhowlab.osgi.monitoradmin.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.felix.dependencymanager_${org.apache.felix.dependencymanager.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.felix.deploymentadmin_${org.apache.felix.deploymentadmin.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/osgi.cmpn_${osgi.cmpn.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.wireadmin_${org.eclipse.equinox.wireadmin.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.http.jetty_${org.eclipse.equinox.http.jetty.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.equinox.http.servlet_${org.eclipse.equinox.http.servlet.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.jetty.continuation_${org.eclipse.jetty.continuation.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.jetty.http_${org.eclipse.jetty.http.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.jetty.io_${org.eclipse.jetty.io.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.jetty.security_${org.eclipse.jetty.security.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.jetty.server_${org.eclipse.jetty.server.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.jetty.servlet_${org.eclipse.jetty.servlet.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.jetty.util_${org.eclipse.jetty.util.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/javax.servlet_${javax.servlet.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.fileupload_${org.apache.commons.fileupload.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.io_${org.apache.commons.io.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/slf4j.api_${slf4j.api.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
			    value=", reference:file:${kura.install.dir}/kura/plugins/jcl.over.slf4j_${jcl.over.slf4j.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.log4j2-api-config_${org.apache.log4j2-api-config.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.logging.log4j.api_${log4j.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.logging.log4j.core_${log4j.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.logging.log4j.slf4j-impl_${log4j.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/minimal-json_${com.eclipsesource.minimal-json.version}.jar" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.hsqldb.hsqldb_${org.hsqldb.hsqldb.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.h2_${com.h2database.h2.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
                value=", reference:file:${kura.install.dir}/kura/plugins/com.codeminders.hidapi.${native.tag}_${com.codeminders.hidapi.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/com.codeminders.hidapi_${com.codeminders.hidapi.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
                value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.soda.dk.comm.${native.tag}_${org.eclipse.soda.dk.comm.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.soda.dk.comm_${org.eclipse.soda.dk.comm.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.lang3_${org.apache.commons.lang3.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.usb4java_${org.usb4java.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/usb4java-javax_${usb4java-javax.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
                value=", reference:file:${kura.install.dir}/kura/plugins/jdk.dio.${native.tag}_${jdk.dio.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/jdk.dio_${jdk.dio.version}.jar@3" />
	        <entry key="osgi.bundles" operation="+"
	            value=", reference:file:${kura.install.dir}/kura/plugins/tinyb.${native.tag}_${tinyb.version}.jar@3" />
	        <entry key="osgi.bundles" operation="+"
	            value=", reference:file:${kura.install.dir}/kura/plugins/tinyb_${tinyb.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.net_${org.apache.commons.net.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
                value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.exec_${org.apache.commons.exec.version}.jar" />
			<entry key="osgi.bundles" operation="+"
					      value=", reference:file:${kura.install.dir}/kura/plugins/com.eclipsesource.jaxrs.jersey-min_${com.eclipsesource.jaxrs.jersey-min.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
					      value=", reference:file:${kura.install.dir}/kura/plugins/com.eclipsesource.jaxrs.publisher_${com.eclipsesource.jaxrs.publisher.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
					      value=", reference:file:${kura.install.dir}/kura/plugins/com.eclipsesource.jaxrs.provider.gson_${com.eclipsesource.jaxrs.provider.gson.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
					      value=", reference:file:${kura.install.dir}/kura/plugins/com.eclipsesource.jaxrs.provider.security_${com.eclipsesource.jaxrs.provider.security.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
								value=", reference:file:${kura.install.dir}/kura/plugins/com.google.gson_${com.google.gson.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
								value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.csv_${org.apache.commons.csv.version}.jar@3" />
		</propertyfile>
	</target>


	<!-- Kura config targets -->
	<target name="api-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.api_${org.eclipse.kura.api.version}.jar@3:start" />
		</propertyfile>
	</target>

	<target name="core-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core_${org.eclipse.kura.core.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="core.certificates-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.certificates_${org.eclipse.kura.core.certificates.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="core.cloud-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.cloud_${org.eclipse.kura.core.cloud.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="core.comm-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.comm_${org.eclipse.kura.core.comm.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="core.configuration-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.configuration_${org.eclipse.kura.core.configuration.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="core.crypto-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.crypto_${org.eclipse.kura.core.crypto.version}.jar@3:start" />
		</propertyfile>
	</target>

	<target name="core.deployment-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.deployment_${org.eclipse.kura.core.deployment.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="core.net-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.net_${org.eclipse.kura.core.net.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="deployment.agent-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.deployment.agent_${org.eclipse.kura.deployment.agent.version}.jar@5:start" />
		</propertyfile>
	</target>

	<target name="linux.clock-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.clock_${org.eclipse.kura.linux.clock.version}.jar@4" />
		</propertyfile>
	</target>

	<target name="linux.command-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.command_${org.eclipse.kura.linux.command.version}.jar@4" />
		</propertyfile>
	</target>

	<target name="linux.position-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
			     value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.position_${org.eclipse.kura.linux.position.version}.jar@4" />
		</propertyfile>
	</target>

	<target name="linux.usb-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
                 value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.usb.${native.tag}_${org.eclipse.kura.linux.usb.version}.jar@4" />
			<entry key="osgi.bundles" operation="+"
			     value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.usb_${org.eclipse.kura.linux.usb.version}.jar@4" />
		</propertyfile>
	</target>

	<target name="linux.bluetooth-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
			      value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.bluetooth_${org.eclipse.kura.linux.bluetooth.version}.jar@4:start" />
	        <entry key="osgi.bundles" operation="+"
	              value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.ble.provider_${org.eclipse.kura.ble.provider.version}.jar@4:start" />
	        <entry key="osgi.bundles" operation="+"
	              value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.ble.ibeacon.provider_${org.eclipse.kura.ble.ibeacon.provider.version}.jar@4:start" />
	        <entry key="osgi.bundles" operation="+"
	              value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.ble.eddystone.provider_${org.eclipse.kura.ble.eddystone.provider.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="linux.watchdog-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
		          value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.watchdog_${org.eclipse.kura.linux.watchdog.version}.jar@4" />
		</propertyfile>
	</target>

	<target name="core.status-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
	               value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.core.status_${org.eclipse.kura.core.status.version}.jar@4" />
		</propertyfile>
	</target>

	<target name="web2-config" if="is.web2.jar.available">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				   value=", reference:file:${kura.install.dir}/kura/plugins/com.gwt.user_${com.gwt.user.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
	               value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.web2_${org.eclipse.kura.web2.version}.jar@6:start" />
		</propertyfile>
	</target>

	<target name="gpio-config" if="linux.gpio.jar.present">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.gpio_${org.eclipse.kura.linux.gpio.version}.jar@5:start" />
		</propertyfile>
	</target>

	<target name="emulator-gpio-config" unless="linux.gpio.jar.present">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.emulator.gpio_${org.eclipse.kura.emulator.gpio.version}.jar@5:start" />
		</propertyfile>
	</target>

	<target name="emulator.usb-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.emulator.usb_${org.eclipse.kura.emulator.usb.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="emulator.watchdog-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.emulator.watchdog_${org.eclipse.kura.emulator.watchdog.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="asset-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.asset.provider_${org.eclipse.kura.asset.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.asset.cloudlet.provider_${org.eclipse.kura.asset.cloudlet.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.asset.helper.provider_${org.eclipse.kura.asset.helper.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.rest.asset.provider_${org.eclipse.kura.rest.asset.provider.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="rest-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.rest.provider_${org.eclipse.kura.rest.provider.version}.jar@4:start" />
		</propertyfile>
	</target>

	<target name="deployment-hooks-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.hook.file.move.provider_${org.eclipse.kura.hook.file.move.provider.version}.jar@4:start" />
		</propertyfile>
	</target>
	
	<target name="marshallers-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.json.marshaller.unmarshaller.provider_${org.eclipse.kura.json.marshaller.unmarshaller.provider.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.xml.marshaller.unmarshaller.provider_${org.eclipse.kura.xml.marshaller.unmarshaller.provider.version}.jar@3:start" />
		</propertyfile>
	</target>

	<target name="wires-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.driver.helper.provider_${org.eclipse.kura.driver.helper.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.localization_${org.eclipse.kura.localization.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.localization.resources_${org.eclipse.kura.localization.resources.version}.jar" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.util_${org.eclipse.kura.util.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.wire.h2db.component.provider_${org.eclipse.kura.wire.h2db.component.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.wire.component.provider_${org.eclipse.kura.wire.component.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.wire.helper.provider_${org.eclipse.kura.wire.helper.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.wire.provider_${org.eclipse.kura.wire.provider.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.wire.component.conditional.provider_${org.eclipse.kura.wire.component.conditional.provider.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.wire.component.join.provider_${org.eclipse.kura.wire.component.join.provider.version}.jar@5:start" />
		</propertyfile>
	</target>

	<target name="asset-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.asset.provider_${org.eclipse.kura.asset.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.asset.cloudlet.provider_${org.eclipse.kura.asset.cloudlet.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.asset.helper.provider_${org.eclipse.kura.asset.helper.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.rest.asset.provider_${org.eclipse.kura.rest.asset.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="rest-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.rest.provider_${org.eclipse.kura.rest.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="deployment-hooks-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.hook.file.move.provider_${org.eclipse.kura.hook.file.move.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>
	
	<target name="marshallers-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.json.marshaller.unmarshaller.provider_${org.eclipse.kura.json.marshaller.unmarshaller.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.xml.marshaller.unmarshaller.provider_${org.eclipse.kura.xml.marshaller.unmarshaller.provider.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="wires-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.asset.provider_${org.eclipse.kura.asset.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
            <zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.asset.cloudlet.provider_${org.eclipse.kura.asset.cloudlet.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
           	<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.asset.helper.provider_${org.eclipse.kura.asset.helper.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
           	<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.driver.helper.provider_${org.eclipse.kura.driver.helper.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.localization_${org.eclipse.kura.localization.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.localization.resources_${org.eclipse.kura.localization.resources.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.util_${org.eclipse.kura.util.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.wire.h2db.component.provider_${org.eclipse.kura.wire.h2db.component.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.wire.component.provider_${org.eclipse.kura.wire.component.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
            <zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.wire.helper.provider_${org.eclipse.kura.wire.helper.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.wire.provider_${org.eclipse.kura.wire.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
            <zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.wire.component.conditional.provider_${org.eclipse.kura.wire.component.conditional.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
            <zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.wire.component.join.provider_${org.eclipse.kura.wire.component.join.provider.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<!-- Camel config targets -->
	<target name="camel-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.eclipse.kura.camel.sun.misc_${org.eclipse.kura.camel.sun.misc.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.camel.camel-amqp_${org.apache.camel.camel-amqp.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.camel.camel-core_${org.apache.camel.camel-core.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.camel.camel-core-osgi_${org.apache.camel.camel-core-osgi.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.camel.camel-jms_${org.apache.camel.camel-jms.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.camel.camel-script_${org.apache.camel.camel-script.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.camel.camel-stream_${org.apache.camel.camel-stream.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.camel_${org.eclipse.kura.camel.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.camel.cloud.factory_${org.eclipse.kura.camel.cloud.factory.version}.jar@5:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.camel.xml_${org.eclipse.kura.camel.xml.version}.jar@5:start" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.wire.camel_${org.eclipse.kura.wire.camel.version}.jar@5:start" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.qpid.jms.client_${apache-qpid-jms-client.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.qpid.proton-j_${apache-qpid-proton-j.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.servicemix.bundles.spring-beans_${spring.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.servicemix.bundles.spring-context_${spring.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.servicemix.bundles.spring-core_${spring.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.servicemix.bundles.spring-expression_${spring.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.servicemix.bundles.spring-jms_${spring.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.servicemix.bundles.spring-tx_${spring.version}.jar@3:start" />
		</propertyfile>
	</target>

	<!-- Artemis config targets -->
	<target name="artemis-config">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/com.google.guava_${guava.version}.jar@3" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.buffer_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.codec_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.codec-http_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.codec-mqtt_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.common_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.handler_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.resolver_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.transport_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.transport-native-epoll_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.transport-native-kqueue_${io.netty.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/io.netty.transport-native-unix-common_${io.netty.version}.jar@3" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.activemq.artemis-mqtt-protocol_${org.apache.activemq.artemis.upstream.version}.jar@3:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.activemq.artemis-native_${org.apache.activemq.artemis.upstream.version}.jar@3" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.beanutils_${commons-beanutils.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.commons.collections_${commons-collections.version}.jar@3" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.geronimo.specs.geronimo-jms_2.0_spec_${org.apache.geronimo.specs.jms.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.geronimo.specs.geronimo-json_1.0_spec_${org.apache.geronimo.specs.json.version}.jar@3" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.geronimo.specs.geronimo-jta_1.1_spec_${org.apache.geronimo.specs.jta.version}.jar@3" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.jboss.logging.jboss-logging_${org.jboss.logging.version}.jar@3" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/plugins/org.apache.activemq.artemis_${org.apache.activemq.artemis.version}.jar@3" />

			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.broker.artemis.core_${org.eclipse.kura.broker.artemis.core.version}.jar@4" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.broker.artemis.simple.mqtt_${org.eclipse.kura.broker.artemis.simple.mqtt.version}.jar@4:start" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.broker.artemis.xml_${org.eclipse.kura.broker.artemis.xml.version}.jar@4:start" />
		</propertyfile>
	</target>


	<!-- Jar targets -->
	<target name="camel-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.camel_${org.eclipse.kura.camel.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.camel.cloud.factory_${org.eclipse.kura.camel.cloud.factory.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.camel.xml_${org.eclipse.kura.camel.xml.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />

			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.wire.camel_${org.eclipse.kura.wire.camel.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />

		</zip>
	</target>

	<target name="artemis-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.broker.artemis.core_${org.eclipse.kura.broker.artemis.core.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.broker.artemis.simple.mqtt_${org.eclipse.kura.broker.artemis.simple.mqtt.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.broker.artemis.xml_${org.eclipse.kura.broker.artemis.xml.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="web2-jar" if="is.web2.jar.available">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.web2_${org.eclipse.kura.web2.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="../target-definition/common/repository/plugins/com.gwt.user_${com.gwt.user.version}.jar"
                        prefix="${build.output.name}/plugins" />
		</zip>
	</target>

	<target name="gpio-jar" if="linux.gpio.jar.present">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.gpio_${org.eclipse.kura.linux.gpio.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="emulator-gpio-jar" unless="linux.gpio.jar.present">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.emulator.gpio_${org.eclipse.kura.emulator.gpio.version}.jar"
	                    prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="emulator-config" if="is.nn">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.emulator_${org.eclipse.kura.emulator.version}.jar@4" />
			<entry key="osgi.bundles" operation="+"
				value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.emulator.net_${org.eclipse.kura.emulator.net.version}.jar@4" />
		</propertyfile>
	</target>

	<target name="linux-config" unless="is.nn">
		<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
			<entry key="osgi.bundles" operation="+"
							value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.linux.net_${org.eclipse.kura.linux.net.version}.jar@4" />
			<entry key="osgi.bundles" operation="+"
                   value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.net.admin_${org.eclipse.kura.net.admin.version}.jar@5:start" />
		</propertyfile>
	</target>

	<target name="emulator-jars" if="is.nn">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.emulator_${org.eclipse.kura.emulator.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.emulator.net_${org.eclipse.kura.emulator.net.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="linux-jars" unless="is.nn">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.linux.net_${org.eclipse.kura.linux.net.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.net.admin_${org.eclipse.kura.net.admin.version}.jar"
                        prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

	<target name="tinyb-jars">
	    <condition property="is.tinyb.snapshot" value="">
	        <contains string="${tinyb.version}" substring="SNAPSHOT"/>
	    </condition>
		<antcall target="tinyb-snapshot-jars" />
		<antcall target="tinyb-no-snapshot-jars" />
	</target>

    <target name="tinyb-snapshot-jars" if="is.tinyb.snapshot">
        <zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
            <mappedresources>
                <fileset dir="../target-definition/common/repository/plugins" includes="tinyb.${native.tag}_*.jar" />
                <globmapper from="*.SNAPSHOT.jar" to="${build.output.name}/plugins/*-SNAPSHOT.jar" />
            </mappedresources>
            <mappedresources>
                <fileset dir="../target-definition/common/repository/plugins" includes="tinyb_*.jar" />
                <globmapper from="*.SNAPSHOT.jar" to="${build.output.name}/plugins/*-SNAPSHOT.jar" />
            </mappedresources>
        </zip>
    </target>

	<target name="tinyb-no-snapshot-jars" unless="is.tinyb.snapshot">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
            <zipfileset file="../target-definition/common/repository/plugins/tinyb.${native.tag}_${tinyb.version}.jar"
                prefix="${build.output.name}/plugins" />
            <zipfileset file="../target-definition/common/repository/plugins/tinyb_${tinyb.version}.jar"
                prefix="${build.output.name}/plugins" />
	    </zip>
	</target>

	<target name="web2-jar-win" if="is.web2.jar.available">
    	<echo message="web2-jar-win ${project.build.directory}/${build.output.name}/config.ini..." />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.web2_${org.eclipse.kura.web2.version}.jar"
			todir="${build.install.dir.kura}/kura/plugins" />
		<copy file="../target-definition/common/repository/plugins/com.gwt.user_${com.gwt.user.version}.jar"
			todir="${build.install.dir.kura}/plugins" />
	</target>

	<target name="emulator-gpio-jar-win">
    	<echo message="emul-gpio-jar-win ${project.build.directory}/${build.output.name}/config.ini..." />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.emulator.gpio_${org.eclipse.kura.emulator.gpio.version}.jar"
			todir="${build.install.dir.kura}/kura/plugins" />
	</target>

    <target name="camel-jar-win">
        <copy file="${project.build.directory}/plugins/org.eclipse.kura.camel_${org.eclipse.kura.camel.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
    	<copy file="${project.build.directory}/plugins/org.eclipse.kura.camel.cloud.factory_${org.eclipse.kura.camel.cloud.factory.version}.jar"
    	    todir="${build.install.dir.kura}/kura/plugins" />
        <copy file="${project.build.directory}/plugins/org.eclipse.kura.camel.xml_${org.eclipse.kura.camel.xml.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
        <copy file="${project.build.directory}/plugins/org.eclipse.kura.wire.camel_${org.eclipse.kura.wire.camel.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
    </target>

	<target name="wires-jar-win">
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.asset.provider_${org.eclipse.kura.asset.provider.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
        <copy file="${project.build.directory}/plugins/org.eclipse.kura.asset.cloudlet.provider_${org.eclipse.kura.asset.cloudlet.provider.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
       	<copy file="${project.build.directory}/plugins/org.eclipse.kura.asset.helper.provider_${org.eclipse.kura.asset.helper.provider.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
       	<copy file="${project.build.directory}/plugins/org.eclipse.kura.driver.helper.provider_${org.eclipse.kura.driver.helper.provider.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.localization_${org.eclipse.kura.localization.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.localization.resources_${org.eclipse.kura.localization.resources.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.util_${org.eclipse.kura.util.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.wire.h2db.component.provider_${org.eclipse.kura.wire.h2db.component.provider.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.wire.component.provider_${org.eclipse.kura.wire.component.provider.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
		<copy file="${project.build.directory}/plugins/org.eclipse.kura.wire.provider_${org.eclipse.kura.wire.provider.version}.jar"
            todir="${build.install.dir.kura}/kura/plugins" />
	</target>

	<target name="misc-config">
			<propertyfile file="${project.build.directory}/${build.output.name}/config.ini">
				<entry key="osgi.bundles" operation="+"
					value=", reference:file:${kura.install.dir}/kura/kura/plugins/org.eclipse.kura.misc.cloudcat_${org.eclipse.kura.misc.cloudcat.version}.jar@4:start" />
			</propertyfile>
	</target>
	<target name="misc-jar">
		<zip destfile="${project.build.directory}/${build.output.name}.zip" update="true">
			<zipfileset file="${project.build.directory}/plugins/org.eclipse.kura.misc.cloudcat_${org.eclipse.kura.misc.cloudcat.version}.jar"
				prefix="${build.output.name}/kura/plugins" />
		</zip>
	</target>

</project>
