webpackJsonp([5],{1737:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(1738)},1738:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(1739),n(1740),n(1741),n(1742),n(1743),n(1744),n(1745),n(1746),n(1747),n(1748),n(1749),n(1750),n(1751),n(1752),n(1753),n(1754),n(1755),n(1756),n(1757),n(1758),n(1759),n(1760),n(1761),n(1762),n(1763),n(1764),n(1765),n(1766),n(1767),n(1768),n(1769),n(1770),n(1771),n(1772),n(1773),n(1774),n(1776),n(1777),n(1778)},1739:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,m,f,v,y,S,A,T,C,w,b,P,E,k){var $=this;this.$q=e,this.esParser=t,this.esTriggers=n,this.navigateToMostActiveChannelActionHandler=a,this.navigateToAppsActionHandler=r,this.navigateToFilesActionHandler=i,this.navigateToChatActionHandler=o,this.navigateToChatWithContactActionHandler=s,this.navigateToTeamsActionHandler=c,this.navigateToCalendarActionHandler=u,this.navigateToCallsActionHandler=l,this.navigateToActivityActionHandler=p,this.navigateToNewChatActionHandler=g,this.navigateToTwtCreateActionHandler=d,this.navigateToSettingActionHandler=h,this.downloadDesktopActionHandler=m,this.updateUserProfileActionHandler=f,this.sendMemberInvitesActionHandler=v,this.clickBodyActionHandler=y,this.navigateToMostRecentTeamActionHandler=S,this.expandChannelListsActionHandler=A,this.collapseChannelListsActionHandler=T,this.downloadAndroidAppActionHandler=C,this.navigateToUrlAcionHandler=w,this.updateDiscoverySettingsActionHandler=b,this.displaySurfaceActionHandler=P,this.navigateToWhatsNewActionHandler=E,this.changeThemeActionHandler=k,this.actionHandlers={};var O=Array.from(arguments);this.actionHandlers={},O.forEach(function(e){$.isActionHandler(e)&&($.actionHandlers[e.actionKey]=e)})}return e.$inject=["$q","esParser","esTriggers","navigateToMostActiveChannelActionHandler","navigateToAppsActionHandler","navigateToFilesActionHandler","navigateToChatActionHandler","navigateToChatWithContactActionHandler","navigateToTeamsActionHandler","navigateToCalendarActionHandler","navigateToCallsActionHandler","navigateToActivityActionHandler","navigateToNewChatActionHandler","navigateToTwtCreateActionHandler","navigateToSettingActionHandler","downloadDesktopActionHandler","updateUserProfileActionHandler","sendMemberInvitesActionHandler","clickBodyActionHandler","navigateToMostRecentTeamActionHandler","expandChannelListsActionHandler","collapseChannelListsActionHandler","downloadAndroidAppActionHandler","navigateToUrlAcionHandler","updateDiscoverySettingsActionHandler","displaySurfaceActionHandler","navigateToWhatsNewActionHandler","changeThemeActionHandler"],e.prototype.isActionHandler=function(e){return e&&e.actionKey&&e.handleAction},e.prototype.hasRegisteredAction=function(e){if(!e)return!1;var t=this.parseActionKey(e).key;return!(!t||!this.actionHandlers[t])},e.prototype.actionTitle=function(e){var t,n=this;if(this.hasRegisteredAction(e)){var a=this.parseActionKey(e),r=a.key,i=a.params;if(this.actionHandlers[r].title){var o=this.esTriggers.getResolutionContext(),s=i.map(function(e){return n.esParser.evaluateExpression(e,o)});return(t=this.actionHandlers[r]).title.apply(t,s)}}},e.prototype.handleAction=function(e,t,n){var a,r=this;if(!this.hasRegisteredAction(e))return this.$q.reject(e+" is not a registered action");var i=this.parseActionKey(e),o=i.key,s=i.params.map(function(e){return r.esParser.evaluateExpression(e,n)});return(a=this.actionHandlers[o]).handleAction.apply(a,[t].concat(s))},e.prototype.parseActionKey=function(e){var t=this.esParser.parseFnCall(e);return{key:t.fnName,params:t.params}},e}();t.EsActionHandler=a,angular.module("teamspace.esActionHandler",["teamspace.esParser","teamspace.esTriggers","teamspace.navigateToMostActiveChannelActionHandler","teamspace.navigateToAppsActionHandler","teamspace.navigateToAppBarItemActionHandlers","teamspace.navigateToChatWithContactActionHandler","teamspace.navigateToNewChatActionHandler","teamspace.navigateToTwtCreateActionHandler","teamspace.navigateToSettingActionHandler","teamspace.downloadDesktopActionHandler","teamspace.updateUserProfileActionHandler","teamspace.sendMemberInvitesActionHandler","teamspace.navigateToUrlActionHandler","teamspace.clickBodyActionHandler","teamspace.navigateToMostRecentTeamActionHandler","teamspace.expandCollapseChannelListsActionHandlers","teamspace.updateDiscoverySettingsActionHandler","teamspace.displaySurfaceActionHandler","teamspace.navigateToWhatsNewActionHandler","teamspace.changeThemeActionHandler"]).service("esActionHandler",a)},1740:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.$qNoApply=e,this.constants=t}return e.$inject=["$qNoApply","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.clickBody},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return $("body").click(),this.$qNoApply.resolve().finally(function(){return e.close()})},e}();t.ClickBodyActionHandler=a,angular.module("teamspace.clickBodyActionHandler",["teamspace.constants"]).service("clickBodyActionHandler",a)},1741:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.downloadAppService=n}return e.$inject=["$qNoApply","constants","downloadAppService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.downloadDesktopApp},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.downloadAppService.download()}).finally(function(){return e.close()})},e}();t.DownloadDesktopActionHandler=a,angular.module("teamspace.downloadDesktopActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.downloadAppService"]).service("downloadDesktopActionHandler",a)},1742:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.Expand=0]="Expand",e[e.Collapse=1]="Collapse"}(a=t.ExpandCollapseAction||(t.ExpandCollapseAction={}));var r=function(){function e(e,t,n){this.$qNoApply=e,this._actionKey=t,this.action=n}return Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=$('[data-tid="team-channel-list"]').controller("channelList")||{};return _.each(n.teamsByOrder,function(e){return e&&e.isCollapsed==(t.action==a.Expand)&&n.expandCollapseTeam(e)}),this.$qNoApply.resolve()},e}();t.ExpandCollapseChannelListsActionHandler=r,angular.module("teamspace.expandCollapseChannelListsActionHandlers",["teamspace.qNoApply","teamspace.constants"]).factory("expandChannelListsActionHandler",["$qNoApply","constants",function(e,t){return new r(e,t.growth.engagementSurfaces.actionKey.expandChannelLists,a.Expand)}]).factory("collapseChannelListsActionHandler",["$qNoApply","constants",function(e,t){return new r(e,t.growth.engagementSurfaces.actionKey.collapseChannelLists,a.Collapse)}])},1743:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t,n,a,r,i,o){this.esTranslate=e,this.constants=t,this.loggingService=n,this.resources=a,this.localizationService=r,this.mobileDownloadEmailService=i,this.mobileDownloadSmsService=o}return e.$inject=["esTranslate","constants","loggingService","resources","localizationService","mobileDownloadEmailService","mobileDownloadSmsService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.mobileUpsell},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.mobileUpsell);if(e)if(e.getIsLoading())t.incomplete({message:"action is currently on-going"});else{var n=_(e.getUiControls()).filter(function(e){return a.IsUserInterfaceEmailSms(e.control)}).first();if(n)if(n.isValid){e.setIsLoading(!0),e.setErrorText(""),n.isLoading=!0,(validator.isEmail(n.value)?this.sendEmail(n.value,e,t):this.sendSms(n.phoneNumber,e,t)).finally(function(){e.setIsLoading(!1),n.isLoading=!1})}else t.incomplete({message:"user input is not valid"});else t.fail({message:"unable to find input context for mobile upsell"})}else t.fail({message:"controller is a required argument to handleAction!"})},e.prototype.sendEmail=function(e,t,n){var a=this;return this.mobileDownloadEmailService.sendDownloadMail(e,this.localizationService.getLocale()).then(function(){n.stop({message:"success sending email"}),a.setIsCompleted(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_send_completed,{sendTo:"email"},{email:e}),t)}).catch(function(e){var r=(e||{}).statusCode;n.fail({message:"unable to send mobile download email. statusCode="+r}),t.setErrorText(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_error_message))})},e.prototype.sendSms=function(e,t,n){var a=this,r=libphonenumber.PhoneNumberUtil.getInstance();return this.mobileDownloadSmsService.sendSms(e).then(function(){n.stop({message:"success sending sms"}),a.setIsCompleted(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_send_completed,{sendTo:"phoneNo"},{phoneNo:r.format(e,libphonenumber.PhoneNumberFormat.NATIONAL)}),t)}).catch(function(e){var r=(e||{}).statusCode;n.fail({message:"unable to send mobile download sms. statusCode="+r}),t.setErrorText(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_sms_error_message))})},e.prototype.setIsCompleted=function(e,t){t.getUiControls().forEach(function(e){var t=a.IsUserInterfaceControlImage(e.control),n=a.IsUserInterfaceControlQrCodeImage(e.control),r=a.IsUserInterfaceControlBoldText(e.control);e.isHidden=!t&&!r||n}),t.setIsCompleted(e,this.esTranslate.instant(this.resources.strings.mobile_upsell_dialog_send_another_link))},e}();t.MobileUpsellActionHandler=r,angular.module("teamspace.mobileUpsellActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.localizationService","teamspace.esTranslate","teamspace.mobileDownloadEmailService","teamspace.mobileDownloadSmsService"]).service("mobileUpsellActionHandler",r)},1744:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.constants=e,this.navigationService=t}return e.$inject=["constants","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToMostRecentTeam},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return this.navigationService.navigateToLastTeamState("engagement-surfaces").then(function(){}).finally(function(){return e.close()})},e}();t.NavigateToMostRecentTeamActionHandler=a,angular.module("teamspace.navigateToMostRecentTeamActionHandler",["teamspace.navigationService","teamspace.constants"]).service("navigateToMostRecentTeamActionHandler",a)},1745:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.navigationService=a,this.logger=n.newLogger("NavigateToAppsActionHandler")}return e.$inject=["$qNoApply","constants","loggingService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToApps},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToAppsView()}).catch(function(e){return t.logger.error("unable to navigate to apps"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToAppsActionHandler=a,angular.module("teamspace.navigateToAppsActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.navigationService"]).service("navigateToAppsActionHandler",a)},1746:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i,o,s,c,u,l){this.$rootScope=e,this.$qNoApply=t,this.esLogger=n,this._actionKey=a,this.appId=r,this.appBarItemType=i,this.layoutService=o,this.userAppsStore=s,this.appBarService=c,this.settingsService=u,this.constants=l}return Object.defineProperty(e.prototype,"enableDynamicAppBarRendering",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableDynamicAppBarRendering)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.userAppsStore.waitForPinnedAndCoreAppsToInitialize().then(function(){if(t.enableDynamicAppBarRendering)return(e=t.appBarService.getAppBarItem(t.appId))?t.appBarService.onAppSelected(t.$rootScope,e):t.$qNoApply.reject("app bar item not found");var e=t.layoutService.getAppBarItem(t.appBarItemType);if(!e)return t.$qNoApply.reject("app bar item not found");t.layoutService.onAppBarItemClick(e),e.clicked(e)}).catch(function(e){var n=teamspace.services.AppBarItemType[t.appBarItemType];return t.esLogger.error("unable to navigate to app bar item: "+n+" "+t.appId+"-"+t.enableDynamicAppBarRendering),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToAppBarItemActionHandler=a,angular.module("teamspace.navigateToAppBarItemActionHandlers",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.userAppsStore","teamspace.appBarService","teamspace.layoutService","teamspace.userAppsStore","teamspace.settingsService"]).factory("navigateToFilesActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToFilesActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToFiles,n.appId.files,teamspace.services.AppBarItemType.Files,i,o,s,c,n)}]).factory("navigateToChatActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToChatActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToChat,n.appId.chat,teamspace.services.AppBarItemType.Chat,i,o,s,c,n)}]).factory("navigateToTeamsActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToTeamsActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToTeams,n.appId.teamsAndChannel,teamspace.services.AppBarItemType.Teams,i,o,s,c,n)}]).factory("navigateToCalendarActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToCalendarActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToCalendar,n.appId.calendar,teamspace.services.AppBarItemType.Calendar,i,o,s,c,n)}]).factory("navigateToCallsActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToCallsActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToCalls,n.appId.calling,teamspace.services.AppBarItemType.Call,i,o,s,c,n)}]).factory("navigateToActivityActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToActivityActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToActivity,n.appId.activity,teamspace.services.AppBarItemType.Alerts,i,o,s,c,n)}])},1747:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$q=e,this.constants=t,this.conversationsService=a,this.navigationService=r,this.logger=n.newLogger("NavigateToChatWithContactActionHandler")}return e.$inject=["$q","constants","esLogger","conversationsService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToConversationWithContact.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToConversationWithContact.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!=n.length||1!=this.paramsDesc.length){o="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(o),e.close(),this.$q.reject(o)}var r=n[0],i=r&&this.conversationsService.getConversationWith(r.mri);if(!i||!i.id){var o="Unable to create conversation with "+JSON.stringify(r);return this.logger.error(o),e.close(),this.$q.reject(o)}return this.navigationService.navigateToChat(i.id,"esp_"+this.actionKey).catch(function(e){t.logger.error("Unable to navigate to contact"),t.$q.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToChatWithContactActionHandler=a,angular.module("teamspace.navigateToChatWithContactActionHandler",["teamspace.constants","teamspace.esLogger","teamspace.conversationsService","teamspace.navigationService"]).service("navigateToChatWithContactActionHandler",a)},1748:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.constants=e,this.channelService=n,this.navigationService=a,this.logger=t.newLogger("NavigateToMostActiveChannelActionHandler")}return e.$inject=["constants","loggingService","channelService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToMostActiveChannel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navCtx",{get:function(){return"nav-to-most-active-channel"},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.channelService.getTeams().then(function(e){var n=e.reduce(function(e,t){return e.concat(t.channels)},[]),a=_(n).map(function(e){return{lastSeen:e.lastSeen||"0",unreadCount:e.unreadCount||0,objectId:e.objectId}}).orderBy(["unreadCount","lastSeen"],["desc","desc"]).first();a?t.navigationService.navigateToChannel(a.objectId,t.navCtx):t.navigationService.navigateToDefaultTeamState(t.navCtx)}).catch(function(){t.logger.error("unable to navigate to most active channel")}).finally(function(){e.close()})},e}();t.NavigateToMostActiveChannelActionHandler=a,angular.module("teamspace.navigateToMostActiveChannelActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.channelService","teamspace.navigationService"]).service("navigateToMostActiveChannelActionHandler",a)},1749:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.newChatService=a,this.logger=n.newLogger("NavigateToNewChatActionHandler")}return e.$inject=["$qNoApply","constants","loggingService","newChatService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToNewChat},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.newChatService.navigateToNewChat("navigate-to-new-chat-action-handler")}).catch(function(e){return t.logger.error("unable to navigate to new chat"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToNewChatActionHandler=a,angular.module("teamspace.navigateToNewChatActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.newChatService"]).service("navigateToNewChatActionHandler",a)},1750:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.teamActionDialogUtilityService=a,this.logger=n.newLogger("NavigateToMostActiveChannelActionHandler")}return e.$inject=["$qNoApply","constants","loggingService","teamActionDialogUtilityService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToTwtCreateStep},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return e.close()}).then(function(){return t.teamActionDialogUtilityService.openCreateTeamDialog(0,!0)}).catch(function(e){return t.logger.error("unable to navigate to create team wizard"),t.$qNoApply.reject(e)})},e}();t.NavigateToTwtCreateActionHandler=a,angular.module("teamspace.navigateToTwtCreateActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.teamActionDialogUtilityService"]).service("navigateToTwtCreateActionHandler",a)},1751:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.dialogService=a,this.logger=n.newLogger("NavigateToSettingActionHandler")}return e.$inject=["$qNoApply","constants","esLogger","dialogService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToSetting},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.dialogService.open(t.constants.dialogs.optionsSettingsDialog,{tabItemId:"Privacy"})}).catch(function(e){return t.logger.error("unable to navigate to setting"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToSettingActionHandler=a,angular.module("teamspace.navigateToSettingActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.dialogService"]).service("navigateToSettingActionHandler",a)},1752:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.esLogger=n,this.navigationService=a}return e.$inject=["$qNoApply","constants","esLogger","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToWhatsNew},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToHelpAppWhatsNew()}).catch(function(e){return t.esLogger.error("unable to navigate to whats new"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToWhatsNewActionHandler=a,angular.module("teamspace.navigateToWhatsNewActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.navigationService"]).service("navigateToWhatsNewActionHandler",a)},1753:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t,n,a,r){this.$q=e,this.constants=t,this.loggingService=n,this.channelService=a,this.conversationsService=r}return e.$inject=["$q","constants","loggingService","channelService","conversationsService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateDiscoverySettings},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.discoverySettings);if(e)if(e.getIsLoading())n.incomplete({message:"loading is currently on-going"});else{var r=_(e.getUiControls()).filter(function(e){return a.IsUserInterfaceDiscoverySettings(e.control)}).first();if(r)if(r.isPending)n.incomplete({message:"action is currently on-going"});else{r.isPending=!0;var i=void 0!==r.erroredSettings&&r.erroredSettings.length>0,o=i?r.erroredSettings:r.discoverySettings.filter(function(e){return e.isDiscoverable});if(0!==o.length){var s=_.map(o,function(e){var n=t.$q.defer(),a=t.conversationsService.getConversation(e.team.objectId).groupId;return t.channelService.setTeamIsDiscoverable(a,!0).then(function(t){if(i){var a=r.erroredSettings.indexOf(e,0);a>-1&&r.erroredSettings.splice(a,1)}n.resolve()}).catch(function(t){e.retryFailed=i,i||r.erroredSettings.push(e),n.reject()}),n.promise});return this.$q.all(s).then(function(e){n.stop({message:"success updating discovery settings"}),r.isPending=!1,r.isSuccess=!0,r.handleSuccess()}).catch(function(e){n.fail({message:"unable to update discovery setting for one or more teams"}),r.isPending=!1,r.handleError()})}}else n.fail({message:"unable to find input context for discovery settings"})}else n.fail({message:"controller is a required argument to handleAction!"})},e}();t.UpdateDiscoverySettingsActionHandler=r,angular.module("teamspace.updateDiscoverySettingsActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.channelService","teamspace.conversationsService"]).service("updateDiscoverySettingsActionHandler",r)},1754:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t,n){this.$q=e,this.constants=t,this.logger=n.newLogger("UpdateUserProfileActionHandler")}return e.$inject=["$q","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateUserProfile},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=_(e.getUiControls()).filter(function(e){return a.IsUserInterfaceUpdateUserProfile(e.control)}).first();return t?(t.onSave(),this.$q.resolve()):(this.logger.error("unable to find input context for update user profile"),e.close(),this.$q.reject())},e}();t.UpdateUserProfileActionHandler=r,angular.module("teamspace.updateUserProfileActionHandler",["teamspace.constants","teamspace.esLogger"]).service("updateUserProfileActionHandler",r)},1755:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t){this.$q=e,this.constants=t}return e.$inject=["$q","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.sendMemberInvites},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return _(e.getUiControls()).filter(function(e){return a.IsUserInterfaceControlMemberInvite(e.control)}).first().sendInvitations(),this.$q.resolve()},e}();t.SendMemberInvitesActionHandler=r,angular.module("teamspace.sendMemberInvitesActionHandler",["teamspace.constants"]).service("sendMemberInvitesActionHandler",r)},1756:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.esLogger=t,this.$window=n,this._actionKey=a,this.url=r}return Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey},enumerable:!0,configurable:!0}),e.prototype.title=function(){return this.url},e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){t.$window.open(t.url,"_blank"),t.esLogger.info("User successfully navigated to "+t.url)}).finally(function(){return e.close()})},e}();t.NavigateToUrlLegacyActionHandler=a;var r=function(){function e(e,t,n,a){this.$qNoApply=e,this.$window=t,this.constants=n,this.logger=a.newLogger("NavigateToUrlActionHandler")}return e.$inject=["$qNoApply","$window","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToUrl.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToUrl.params},enumerable:!0,configurable:!0}),e.prototype.title=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e?e[0]:void 0},e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!=n.length||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(r),e.close(),this.$qNoApply.reject(r)}var i=n[0];return this.$qNoApply.resolve().then(function(){t.$window.open(i,"_blank"),t.logger.info("User successfully navigated to "+i)}).finally(function(){return e.close()})},e}();t.NavigateToUrlActionHandler=r,angular.module("teamspace.navigateToUrlActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger"]).service("navigateToUrlAcionHandler",r).factory("downloadAndroidAppActionHandler",["$qNoApply","constants","$window","esLogger",function(e,t,n,r){return new a(e,r.newLogger("downloadAndroidAppActionHandler"),n,t.growth.engagementSurfaces.actionKey.downloadAndroidApp,t.growth.engagementSurfaces.externalUrls.androidAppStoreUrl)}])},1757:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.$injector=t,this.constants=n,this.loggingService=a,this.logger=r.newLogger("DisplaySurfaceActionHandler")}return e.$inject=["$qNoApply","$injector","constants","loggingService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.displaySurface.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.displaySurface.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e.close(),!t||1!=t.length||1!=this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(t);return this.logger.error(a),this.$qNoApply.reject(a)}var r=t[0],i=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.displaySurface);return this.$injector.get("esDisplayManager").displayById(r,e,i)},e}();t.DisplaySurfaceActionHandler=a,angular.module("teamspace.displaySurfaceActionHandler",["teamspace.constants","teamspace.esDisplayManager"]).service("displaySurfaceActionHandler",a)},1758:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.banner=t,this.id=e.id,this.treatment=e.treatment}return e.prototype.close=function(){this.banner.hide()},e}(),r=function(){function e(e,t,n,a,r,i,o,s,c,u){this.$rootScope=e,this.$q=t,this.constants=n,this.esTranslate=r,this.esActionHandler=i,this.esSurfaceStack=o,this.appStateAdapter=s,this.analyticsService=c,this.eventingService=u}return e.$inject=["$rootScope","$q","constants","loggingService","esTranslate","esActionHandler","esSurfaceStack","appStateAdapter","analyticsService","eventingService"],e.prototype.displayBanner=function(e,t,n){var a,r=this,i=this.$q.defer(),o=e.params,s=o.actionCssClass||"",c=function(){a&&a.hide(),i.resolve()},u=(o.actions||[]).map(function(t,i){return{message:r.esTranslate.instant(t.resxKey,t.resxParams,n),icon:t.icon,title:r.esActionHandler.actionTitle(t.actionKey),run:function(){r.esSurfaceStack.setCurrentAction(t.actionKey);var i=r.createBannerActionContext(e,a);r.esActionHandler.handleAction(t.actionKey,i,n).catch(function(){return i.close()})},telemetryOptions:{moduleName:teamspace.components.PanelModuleName.engagementSurfaceBannerButton,moduleType:teamspace.components.PanelModuleType.button,scenario:teamspace.components.PanelActionScenario.engagementSurfaceBannerButton,scenarioType:teamspace.components.PanelActionScenarioType.engagementSurface,moduleSummary:"engagment surface banner button resx="+t.resxKey,gesture:teamspace.components.PanelActionGesture.click,dataBag:{id:e.id,currIndex:i,treatment:e.treatment,actionKey:r.esActionHandler.parseActionKey(t.actionKey).key}}}});a=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Promo,this.esTranslate.instant(o.resxKey,o.resxParams,n),e.id+"-"+e.treatment,{countdownInSeconds:-1,autoHideTimer:o.autoCloseInSeconds||0,action:u,hideAction:function(t){r.setActionFromBannerHideSource(e,t),i.resolve()},cssClass:"engagement-surface",bannerIcon:o.icon,actionCssClass:s,telemetryOptions:{panelRegion:teamspace.PanelRegion.banner,panelType:teamspace.PanelType.engagementSurfaceBanner,moduleName:teamspace.components.PanelModuleName.notificationBanner,closeGesture:teamspace.components.PanelActionGesture.click,closeModuleType:teamspace.components.PanelModuleType.button,closeScenario:teamspace.components.PanelActionScenario.engagementSurfaceBannerButton,scenarioType:teamspace.components.PanelActionScenarioType.engagementSurface,closeOutcome:teamspace.components.PanelActionOutcome.dismiss,closeModuleSummary:"close engagement surface banner",dataBag:{id:e.id,treatment:e.treatment}}}),t.stop();var l=this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return c()});return i.promise.finally(function(){return l()}),i.promise},e.prototype.setActionFromBannerHideSource=function(e,t){var n,a=this,r=(n={},n[teamspace.services.BannerHideSource.Close]=this.constants.growth.engagementSurfaces.actionKey.xClose,n[teamspace.services.BannerHideSource.Timeout]=this.constants.growth.engagementSurfaces.actionKey.timeout,n)[t];if(r){if(r===this.constants.growth.engagementSurfaces.actionKey.timeout){var i={panelType:teamspace.PanelType.engagementSurfaceBanner,dataBag:{id:e.id,treatment:e.treatment,actionKey:r}};_.defer(function(){return a.analyticsService.sendPseudoPanelView(i)})}this.esSurfaceStack.setCurrentAction(r)}},e.prototype.createBannerActionContext=function(e,t){return new a(e,t)},e}();t.EsBannerService=r,angular.module("teamspace.esBannerService",["teamspace.esTranslate","teamspace.loggingService","teamspace.appStateAdapter","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.constants","teamspace.analyticsService","teamspace.eventingService"]).service("esBannerService",r)},1759:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2),o=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,m,f,v,y,S,A,T){this.$q=e,this.constants=t,this.esRepository=n,this.dialogService=a,this.settingsService=r,this.loggingService=i,this.analyticsService=o,this.$state=s,this.utilityService=c,this.esTriggers=u,this.esSurfaceStack=l,this.esBannerService=p,this.esHelpBotService=g,this.esCarouselService=d,this.esCoachmarkService=h,this.esQuickGuideService=m,this.esMenuService=f,this.esActionHandler=v,this.esFetchDataHandler=y,this.esParser=S,this.firstRunService=A,this.logger=T.newLogger("EsDisplayManger"),this.queue=[]}return e.$inject=["$q","constants","esRepository","dialogService","settingsService","loggingService","analyticsService","$state","utilityService","esTriggers","esSurfaceStack","esBannerService","esHelpBotService","esCarouselService","esCoachmarkService","esQuickGuideService","esMenuService","esActionHandler","esFetchDataHandler","esParser","firstRunService","esLogger"],e.prototype.initialize=function(e){this.esConfig=e,this.queue.forEach(function(e){e.scenario.incomplete({message:"re-initializing display manager after updated esConfig"})}),this.queue=[]},e.prototype.enqueue=function(e,t,n){var a=this;if(this.logger.info("enqueuing surface "+e.id+" "+e.treatment),this.settingsService.valueAsBoolean(this.constants.settings.names.sendPanelViewOnEngagementSurfaceQueued)&&this.sendPanelView(e,teamspace.PanelType.enqueuedEngagementSurface),e.trigger===i.Trigger.SurfaceShown)return this.displaySurface(e,t,n);this.queue.push({esSurfaceConfig:e,scenario:t,context:n});var r=this.$q.defer();return _.defer(function(){return a.processQueue().then(r.resolve,r.reject)}),r.promise},e.prototype.display=function(t,n){var a=e.onDemandSurfaceEcsMap[t],r=this.settingsService.valueFor(a),i=this.esTriggers.getResolutionContext();if(!_.isNil(r)){var o=this.esRepository.expandOnDemandSurfaceConfig(r,a);return this.displaySurface(o,n,i)}return this.$q.reject("on-demand surface is not configured")},e.prototype.displayById=function(e,t,n){var a=this.esConfig.engagementSurfaces.find(function(t){return t.id===e}),r=this.esTriggers.getResolutionContext();if(a){var i=this.esRepository.convertToProgrammaticSurface(a,t.id);return this.displaySurface(i,n,r)}return this.$q.reject("surface id is not defined")},e.prototype.getDateUntilNextPriority=function(e){if(e.trigger===i.Trigger.FirstRun)return moment(new Date(0));var t=e.priority,n=this.esConfig.priorityThrottlesInMinutes[t],a=this.esConfig.engagementSurfaces.reduce(function(e,t){return e.concat(t.displayed)},[]);if(!a.length)return moment(new Date(0));var r=moment.max(a).clone();return r.add(n,this.constants.momentjs.unitOfTime.minutes),r},e.prototype.processQueue=function(){var e=this;return this.processingQueuePromise||(this.processingQueuePromise=this._processQueue().finally(function(){return e.processingQueuePromise=void 0})),this.processingQueuePromise},e.prototype._processQueue=function(){var e=this,t=this.$q.resolve(),n=_.partition(this.queue,function(e){return e.esSurfaceConfig.displayed.length<e.esSurfaceConfig.recur}),a=n[0];if(n[1].forEach(function(t){var n="not showing surface "+t.esSurfaceConfig.id+". already shown "+t.esSurfaceConfig.displayed.length+" times";e.logger.warn(n),t.scenario.stop({message:n})}),this.queue=a,!this.queue.length)return t;this.queue=_.sortBy(this.queue,[function(e){return e.esSurfaceConfig.displayed.length},function(e){return e.esSurfaceConfig.priority},function(e){return e.esSurfaceConfig.isSettled},function(e){return e.esSurfaceConfig.order}]);var r=!!this.esSurfaceStack.getSurfaceState().curr,o=moment(new Date),s=_.find(this.queue,function(t){var n=t.esSurfaceConfig,a=t.context;return e.esMenuService.isMenuInProgress(n,a,e.esConfig)})||_.find(this.queue,function(t){var n=t.esSurfaceConfig,a=t.context;if(-1===n.priority)return!0;var i=e.getDateUntilNextPriority(n),s=o.isAfter(i)&&!r,c=e.esMenuService.isMenuComplete(n,a,e.esConfig);return s&&!c});if(s){_.remove(this.queue,function(e){return e.esSurfaceConfig.id===s.esSurfaceConfig.id});var c=s.esSurfaceConfig,u=s.scenario,l=s.context;if(t=this.displaySurface(c,u,l),c.trigger===i.Trigger.FirstRun){var p=_.partition(this.queue,function(e){return e.esSurfaceConfig.trigger===i.Trigger.FirstRun}),g=p[0];return p[1].forEach(function(t){var n="not showing surface "+t.esSurfaceConfig.id+". does not meet display requirements";t.scenario.stop({message:n}),e.logger.info(n)}),this.queue=g,t=this.queue.length?t.finally(function(){return e._processQueue()}):t.finally(function(){e.firstRunService.setFreComplete(),e.esTriggers.onFirstRunComplete(),e.esTriggers.fire(i.Trigger.AppReady)})}}else this.logger.info("not showing "+this.queue.length+" surface(s) due to time-based throttling."),r&&this.logger.error("not showing surface. the surface "+this.esSurfaceStack.getSurfaceState().curr.id+" is currently showing");return this.queue.forEach(function(e){e.scenario.stop({message:"not showing surface. does not meet display requirements"})}),this.queue=[],t},e.prototype.getSurfaceDisplayAction=function(e,t,n){var a,r=this,o=(a={},a[i.EngagementSurface.Modal]=this.displayModal,a[i.EngagementSurface.Coachmark]=this.displayCoachmark,a[i.EngagementSurface.Banner]=this.displayBanner,a[i.EngagementSurface.HelpBot]=this.postProactiveMessage,a[i.EngagementSurface.Carousel]=this.displayCarousel,a[i.EngagementSurface.QuickGuide]=this.displayQuickGuide,a[i.EngagementSurface.Menu]=this.displayMenu,a);return function(){return o[e.surface].bind(r)(e,t,n)}},e.prototype.executePreActions=function(e,t,n){var a,r=this,i=this.$q.resolve(),o=e.id,s=e.treatment;return(e.preActionKeys||[]).forEach(function(e){i=i.then(function(){return a=e,r.esActionHandler.handleAction(e,{id:o,treatment:s,close:$.noop},n)}).then(function(){return r.logger.info("pre-display action "+e+" executed by "+o)})}),i.catch(function(e){var n="not showing surface "+o+". failed to execute pre-display action "+a+". "+e;return r.logger.error(n),t.fail({message:n}),r.$q.reject(e)}),i},e.prototype.executeFetchDataActions=function(e,t,n){var r=this;void 0===n&&(n={});var o={},s=[],c=(e.fetchDataKeys||[]).filter(function(e){return void 0===n[e]}).map(function(t){return r.esFetchDataHandler.fetchData(t).then(function(e){return o=a({},o,e)}).then(function(){return(e.trigger===i.Trigger.SurfaceShown||e.trigger===i.Trigger.Programmatic)&&r.logger.warn("Suboptimal configuration for chained surface "+e.id+": consider adding fetchedDataKey "+t+" to the first surface of the chain as well.")}).catch(function(e){var n="failed to execute fetchdata action "+t+": "+e;return s.push(n),r.$q.reject(e)})});return this.$q.all(c).then(function(){return o}).catch(function(){var e="not showing surface. failed to execute one of the fetchdata actions:\n"+s.join("\n");return r.logger.error(e),t.fail({message:e}),r.$q.reject(e)})},e.prototype.evaluateDataCondition=function(e,t,n){var a=e.dataCondition,r=a&&this.esParser.evaluateExpression(a,n),i=!a||!!r;return i||this.logger.warn("Data condition ("+a+") is false for "+e.id),i},e.prototype.displaySurface=function(e,t,n){var a=this;void 0===n&&(n={}),this.logger.info("displaying surface "+e.id);var r=this.loggingService.newScenario("display_"+e.id),o=function(){var e="engagement surfaces control group bi logging only";return t.stop({message:e}),r.stop({message:e}),a.logger.info(e),a.$q.resolve()},s=0;return this.executeFetchDataActions(e,t,n).then(function(e){return _.merge(n,e)}).then(function(){return a.evaluateDataCondition(e,t,n)}).then(function(e){return e||a.$q.reject()}).then(function(){return a.sendEligiblePanelView(e)}).then(function(){return e.isControlGroup?o():a.$q.resolve().then(function(){return a.esSurfaceStack.setCurrentSurface(e)}).then(function(){return a.executePreActions(e,t,n)}).then(function(){return s=Date.now()}).then(function(){return r.pause({reason:"displaying surface"})}).then(function(){return a.getSurfaceDisplayAction(e,t,n)()}).then(function(){return a.sendElapsedPanelView(e,s)}).then(function(){return r.stop()}).catch(function(){return a.esSurfaceStack.unsetCurrentSurface(),a.$q.reject()}).then(function(){return e.displayed.push(moment(new Date))}).then(function(){return a.esSurfaceStack.onSurfaceClosed()}).then(function(){a.esRepository.updateSurfaceAsDisplayed(e)}).then(function(){return a.esTriggers.fire(i.Trigger.SurfaceShown)})})},e.prototype.displayBanner=function(e,t,n){return this.esBannerService.displayBanner(e,t,n)},e.prototype.displayCoachmark=function(e,t,n){return this.esCoachmarkService.displayCoachmark(e,t,n)},e.prototype.displayModal=function(e,t,n){var a=this,r=this.$q.defer(),i=function(){return a.dialogService.open(a.constants.dialogs.engagementSurfaceDialog,{id:e.id,treatment:e.treatment,uiControls:e.userInterfaceControls,params:e.params,context:n,scenario:t}).closePromise.then(r.resolve).catch(r.reject)};if(this.dialogService.isAnyDialogOpen()){var o="waiting for existing dialog to close before showing engagement modal";t.pause({reason:o}),this.logger.warn(o),this.dialogService.onAllDialogsClosed().then(function(){t.resume(),i()})}else i();return r.promise},e.prototype.displayCarousel=function(e,t,n){return this.esCarouselService.displayCards(e,t,n)},e.prototype.displayQuickGuide=function(e,t,n){return this.esQuickGuideService.displayQuickGuide(e,t,n)},e.prototype.displayMenu=function(e,t,n){return this.esMenuService.displayMenu(e,t,n,this.esConfig)},e.prototype.postProactiveMessage=function(e,t,n){return this.esHelpBotService.invokeMessage(e,t,n)},e.prototype.sendEligiblePanelView=function(e){return e.eligibleTimes.length<e.recur?(this.sendPanelView(e,teamspace.PanelType.eligibleEngagementSurface),this.sendPseudoSurfacePanelView(e),e.eligibleTimes.push(moment(new Date)),this.esRepository.updateEligiblePanelViewSent(e).then(function(){})):this.$q.resolve()},e.prototype.sendPseudoSurfacePanelView=function(e){var t;if(this.settingsService.valueAsBoolean(this.constants.settings.names.sendPseudoEngagementSurfacePanelViewInControl)&&e.isControlGroup){var n=(t={},t[i.EngagementSurface.Modal]={panelRegion:teamspace.PanelRegion.modal,panelType:teamspace.PanelType.engagementSurfaceDialog},t[i.EngagementSurface.Coachmark]={panelRegion:teamspace.PanelRegion.popover,panelType:teamspace.PanelType.engagementSurfaceCoachmark},t[i.EngagementSurface.Banner]={panelRegion:teamspace.PanelRegion.banner,panelType:teamspace.PanelType.engagementSurfaceBanner},t[i.EngagementSurface.HelpBot]={panelRegion:teamspace.PanelRegion.main,panelType:teamspace.PanelType.engagementSurfaceProactiveMessage},t[i.EngagementSurface.Carousel]={panelRegion:teamspace.PanelRegion.modal,panelType:teamspace.PanelType.engagementSurfaceCarousel},t);this.sendPanelView(e,n[e.surface].panelType,n[e.surface].panelRegion)}},e.prototype.sendElapsedPanelView=function(e,t){this.sendPanelView(e,teamspace.PanelType.elapsedEngagementSurface,teamspace.PanelRegion.main,{elapsedMs:Date.now()-t})},e.prototype.sendPanelView=function(e,t,n,r){this.analyticsService.sendPanelView({panel:{launchMethod:teamspace.components.LaunchMethod[teamspace.components.LaunchMethod.direct],previousUri:void 0,previousUriParams:void 0,region:teamspace.PanelRegion[n||teamspace.PanelRegion.main],uri:this.$state.current.name,uriParams:this.loggingService.hashUriParamsPII(this.$state.params),viewId:this.utilityService.generateUUID(),type:teamspace.PanelType[t]},dataBag:a({id:e.id,treatment:e.treatment,isControlGroup:e.isControlGroup,pseudo:!0},r)})},e.onDemandSurfaceEcsMap=(r={},r[teamspace.services.engagementSurfaces.OnDemandSurface.MobileDownloadSendLinkModal]=teamspace.Constants.Instance.settings.names.mobileDownloadSendLinkModal,r[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumUpdateProfileDialogFre]=teamspace.Constants.Instance.settings.names.freemiumUpdateProfileDialogFre,r[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumInviteMembersDialogFre]=teamspace.Constants.Instance.settings.names.freemiumInviteMembersDialogFre,r[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumJoinByUrlDialogFre]=teamspace.Constants.Instance.settings.names.freemiumJoinByUrlDialogFre,r[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreQuickGuideSurface]=teamspace.Constants.Instance.settings.names.freemiumFreQuickGuideSurface,r[teamspace.services.engagementSurfaces.OnDemandSurface.DefaultFrePromptCards]=teamspace.Constants.Instance.settings.names.defaultFrePromptCards,r),e}();t.EsDisplayManager=o,angular.module("teamspace.esDisplayManager",["teamspace.constants","teamspace.esRepository","teamspace.loggingService","teamspace.settingsService","teamspace.analyticsService","teamspace.esTriggers","teamspace.esSurfaceStack","teamspace.esBannerService","teamspace.esHelpBotService","teamspace.esCarouselService","teamspace.esCoachmarkService","teamspace.esQuickGuideService","teamspace.esActionHandler","teamspace.esFetchDataHandler","teamspace.esParser","teamspace.firstRunService","teamspace.esMenuService"]).service("esDisplayManager",o)},1760:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,m){this.$rootScope=e,this.$q=t,this.$timeout=n,this.$interval=a,this.esRepository=r,this.esTriggers=i,this.esParser=o,this.esDisplayManager=s,this.constants=u,this.loggingService=l,this.appStateService=p,this.settingsService=g,this.firstRunService=h,this.eventingService=m,this._syncCount=0,this._numOfPendingFirstRunSurfaces=0,this._configContainsFirstRunSurfaces=!1,this._enqueuedFirstRunSurface=!1,this._firstRunFired=!1,this._subscriptionComplete=!1,this.logger=c.newLogger("EsEngine"),this.initializeOnAppLaunchAndReinit(),d.registerForMtma(this)}return e.$inject=["$rootScope","$q","$timeout","$interval","esRepository","esTriggers","esParser","esDisplayManager","esLogger","constants","loggingService","appStateService","settingsService","orchestrationService","firstRunService","eventingService"],e.prototype.cleanupOnAppTeardown=function(){this.resetFirstRunState(),this.config=void 0,this._hasStarted=!1,this._syncCount=0,this.esTriggers.clear(),this.esDisplayManager.initialize(this.config)},e.prototype.initializeOnAppLaunchAndReinit=function(){var e=this;this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.engagementSurfaces.onAction,function(t,n){e.config&&(e.config.userState.completedActions=_.uniq(e.config.userState.completedActions.concat(n)))})},e.prototype.mtmaTelemetryIdentifier=function(){return"EsEngine"},e.prototype.onFirstRunFired=function(){return this._firstRunFired=!0,this.checkFirstRun(),this.$q.resolve()},e.prototype.resetFirstRunState=function(){this._numOfPendingFirstRunSurfaces=0,this._configContainsFirstRunSurfaces=!1,this._enqueuedFirstRunSurface=!1,this._firstRunFired=!1,this._subscriptionComplete=!1},e.prototype.startUp=function(){var e=this;this._hasStarted||(this._hasStarted=!0,this.logger.info("starting up the engagement surface engine"),this.syncConfig(),this.$timeout(function(){e.shouldSyncDaily()&&e.syncConfig(),e.$interval(function(){e.shouldSyncDaily()&&e.syncConfig()},e.constants.timeInMiliseconds.day,0,!1)},this.getMillisecondsUntilTomorrowBetween1amAnd4am(),!1))},e.prototype.syncConfig=function(){var e=this;this._syncCount++,this.logger.info("syncing the engagement surface config");var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.startUp);this.resetFirstRunState(),this.esTriggers.clear(),this.esTriggers.subscribe(a.Trigger.FirstRun,void 0,function(){return e.onFirstRunFired()}),this._syncCount>1&&this.eventingService.$emit(this.constants.events.fre.evaluate),this.esRepository.getConfig().then(function(n){n||(t.stop({message:"no engagement surfaces defined"}),e.logger.warn("no engagement surfaces defined"),n={engagementSurfaces:[]}),e.config=n,e.logger.info("engagement surface configuration retrieved"),e.esDisplayManager.initialize(n);var r=[];n.engagementSurfaces.filter(function(e){return e.displayed.length<e.recur}).forEach(function(t){if(!t.id||_.isUndefined(t.trigger)||_.isUndefined(t.surface)){o="invalid es config. id="+t.id+" trigger="+t.trigger+" surface="+a.EngagementSurface[t.surface];return r.push(o),void e.logger.error(o)}try{var i=e.esParser.parse(t.condition,n.engagementSurfaces);e.esTriggers.subscribe(t.trigger,t.triggerFilter,function(a){return e.handleTriggerFire(t,n.userState,i,a)},t.delayInSeconds),t.trigger===a.Trigger.FirstRun&&e._numOfPendingFirstRunSurfaces++}catch(n){var o="failed to parse ["+t.condition.toString()+"] or ["+t.triggerFilter.toString()+"]. "+n.message;r.push(o),e.logger.error(o)}}),e._subscriptionComplete=!0,e._configContainsFirstRunSurfaces=e._numOfPendingFirstRunSurfaces>0,e.checkFirstRun(),r.length?t.fail({message:r.join(",")}):t.stop()}).catch(function(n){e.appStateService.isConnected?t.fail({message:"failed to retrieve configuration",statusCode:(n||{}).statusCode}):t.incomplete({message:"failed to retrieve configuration - app is not connected",statusCode:(n||{}).statusCode})})},e.prototype.onFirstRunWithNoSurfaces=function(){var e=this;this.logger.error("FirstRun triggered with no applicable surfaces! Displaying default FRE experience.");var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.defaultFreFallback);this.esDisplayManager.display(teamspace.services.engagementSurfaces.OnDemandSurface.DefaultFrePromptCards,t).then(function(){e.firstRunService.setFreComplete(),e.esTriggers.onFirstRunComplete()})},e.prototype.checkFirstRun=function(){this._firstRunFired&&this._subscriptionComplete&&(this._configContainsFirstRunSurfaces||this.onFirstRunWithNoSurfaces())},e.prototype.shouldSyncDaily=function(){return!this.settingsService.valueAsBoolean(this.constants.settings.names.disableEngagementSurfacesDailySync)},e.prototype.handleTriggerFire=function(e,t,n,r){var i=e.trigger==a.Trigger.FirstRun;i&&this._numOfPendingFirstRunSurfaces--;var o="handling trigger "+a.Trigger[e.trigger]+" with condition "+e.condition+" for id="+e.id+" "+e.treatment;if(this.logger.info(o),n.invoke(t)){i&&(this._enqueuedFirstRunSurface=!0);var s=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleTriggerFire,null,null,this.constants.timeInMiliseconds.hour);return s.eventData={intent:o},this.esDisplayManager.enqueue(e,s,r)}return this.logger.info("surface not shown: condition not satisfied"),i&&0===this._numOfPendingFirstRunSurfaces&&!this._enqueuedFirstRunSurface&&this.onFirstRunWithNoSurfaces(),this.$q.resolve()},e.prototype.getMillisecondsUntilTomorrowBetween1amAnd4am=function(){var e=moment(new Date),t=moment(new Date).add(1,this.constants.momentjs.unitOfTime.days);return t.hour(1),t.minute(0),t.second(0),t.millisecond(0),t.diff(e)+Math.ceil(3*this.constants.timeInMiliseconds.hour*Math.random())},e}();t.EsEngine=r,angular.module("teamspace.esEngine",["teamspace.esRepository","teamspace.esTriggers","teamspace.esParser","teamspace.esDisplayManager","teamspace.constants","teamspace.loggingService","teamspace.appState","teamspace.settingsService","teamspace.esLogger","teamspace.orchestrationService","teamspace.firstRunService","teamspace.eventingService"]).service("esEngine",r)},1761:function(e,t,n){"use strict";var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=function(){function e(e){this.expression=e}return e.prototype.toString=function(){return this.expression},e}(),s=function(e){function t(t,n,a,r,i,o,s,c,u,l,p,g,d,h,m,f,v,y,S,A,T,C,w,b,P,E,k,$){var O=e.call(this,t.middleTierConstants.newEndpointAddress,i,c,a,n,r,l,s)||this;return O.appConfig=t,O.$q=n,O.$http=a,O.$qNoApply=r,O.settingsService=i,O.loggingService=o,O.appStateService=s,O.constants=c,O.resources=u,O.authenticationService=l,O.myUserPreferencesStore=p,O.eventingService=g,O.channelService=d,O.tenantService=h,O.userAppsStore=m,O.utilityService=f,O.userResourcesSettingsStore=v,O.identityService=y,O.helpBotService=S,O.sfbTeamsUpgradeService=A,O.esSurfaceStack=T,O.esPortalComms=w,O.storageService=b,O.downloadAppService=P,O.callingService=E,O.callingSupportService=k,O.firstRunService=$,O.logger=C.newLogger("EsRepository"),O}return a(t,e),t.$inject=["appConfig","$q","$http","$qNoApply","settingsService","loggingService","appStateService","constants","resources","authenticationService","myUserPreferencesStore","eventingService","channelService","tenantService","userAppsStore","utilityService","userResourcesSettingsStore","identityService","helpBotService","sfbTeamsUpgradeService","esSurfaceStack","esLogger","esPortalComms","storageService","downloadAppService","callingService","callingSupportService","firstRunService"],Object.defineProperty(t.prototype,"enableEspDebugOverride",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableEspDebugOverride)},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var e=this,n=this.settingsService.valueAsBoolean(this.constants.settings.names.enableEngagementSurfaces);return this.getEcsSurfaceConfigurations().then(function(a){if(!n||!a||!a.length)return e.$qNoApply.resolve(void 0);var r={"x-no-cs-call":!0};e.settingsService.valueAsBoolean(e.constants.settings.names.disableEngagementSurfaceChatServiceSupression)&&(r={});var i={retryOn:["5xx","404","429"],maxRetries:3};e.firstRunService.isFRESession()&&(i={retryOn:[],maxRetries:0});var o=function(t){return e.applyCache(t).then(function(t){return e.convert(t,a)}).then(function(t){return e.esSurfaceStack.setSurfaces(t.engagementSurfaces),t})};return e.withRetry(function(){return e.performApiGet(t.API_ENDPOINT,{callType:t.CALL_TYPE,headers:r}).toNgPromise(e.$qNoApply).then(function(e){return o(e)})},null,i.retryOn,i.maxRetries).then(function(t){return e.syncCache(),t}).catch(function(n){if(e.firstRunService.isFRESession())return e.logger.warn("GET engagementSurfaces failed for FRE user, falling back to naked implementation"),o(t.NAKED_DTO);throw n})})},t.prototype.updateSurfaceAsDisplayed=function(e){return this.updateSurfaceAsDisplayedOrEligible(e,!1)},t.prototype.updateEligiblePanelViewSent=function(e){return this.updateSurfaceAsDisplayedOrEligible(e,!0)},t.prototype.resetSurfaces=function(){var e=this;return this.withRetry(function(){return e.performApiDelete(t.API_ENDPOINT,{callType:t.CALL_TYPE}).toNgPromise(e.$qNoApply)})},t.prototype.addEngagemetSurfaceActions=function(e){var n=this;if(!e||!e.length)return this.$q.resolve();this.eventingService.$emit(this.constants.events.engagementSurfaces.onAction,e);var a={items:e.map(function(e){return{action:e}})};return this.withRetry(function(){return n.performApiPut(t.API_ENDPOINT+"/actions",{callType:t.CALL_TYPE},a).toNgPromise(n.$qNoApply)}).catch(function(){var t=e.map(function(e){return i.EngagementSurfaceAction[e]}).join(",");n.logger.warn("failed to update engagement surface actions: "+t+". cacheing locally."),n.esCache.addActions(a)})},t.prototype.expandOnDemandSurfaceConfig=function(e,t){var n=r({},e,{id:t,treatment:"",trigger:"Programmatic",isSettled:!1,eligibleTimes:[],condition:"",order:0,priority:-1});return this.convertSurfaceConfig(n)},t.prototype.convertToProgrammaticSurface=function(e,t){return r({},e,{id:t?t+"->"+e.id:e.id,trigger:i.Trigger.Programmatic,priority:-1,order:0})},t.prototype.getRelevantContacts=function(){var e=this;return this.withRetry(function(){return e.performApiGet(t.RELEVANTCONTACTS_ENDPOINT,{callType:t.CALL_TYPE}).toNgPromise(e.$qNoApply).then(function(t){return e.logger.info("Retrieved "+t.value.length+" relevant contacts"),t.value})},null,["5xx"])},t.prototype._getAuthHeaders=function(e){var t=this;return void 0===e&&(e=!1),this.authenticationService.getSkypeTokens(e).then(function(e){var n={};return n[t.constants.headers.accept]=t.constants.headers.jsonContent,n[t.constants.headers.tokens.xSkypeToken]=e.skypeToken,t.authenticationService.getAuthHeaders(n)})},t.prototype.updateSurfaceAsDisplayedOrEligible=function(e,n){var a=this;if(this.esPortalComms.isUsingEspPortal())return this.$qNoApply.resolve();if(e.trigger===i.Trigger.Programmatic||e.trigger===i.Trigger.SurfaceShown)return this.$qNoApply.resolve();var r={id:e.id,priority:e.priority,isControlGroup:n};return this.withRetry(function(){return a.performApiPut(t.API_ENDPOINT+"/displayed",{callType:t.CALL_TYPE},r).toNgPromise(a.$qNoApply)}).catch(function(t){a.logger.warn("unable to update surface "+e.id+" as displayed. cacheing locally."),a.esCache.addDisplayed(r)})},t.prototype.convert=function(e,t){var n=this;return this.convertUserState(e.userState).then(function(a){return{engagementSurfaces:n.getSurfaceConfigurations(t,e.displayed,e.engagementSurfaces),userState:a,priorityThrottlesInMinutes:e.priorityThrottlesInMinutes}})},t.prototype.convertUserState=function(e){var t=this,n=(e.completedActions||[]).slice(),a=[],o=this.myUserPreferencesStore.getUserPreferences(),s=o&&o.firstLoginInformation||{};return[{isActive:!!(s.android||s.ios||s.wp),action:i.EngagementSurfaceAction.LoginTeamsMobileApp},{isActive:!!s.electron,action:i.EngagementSurfaceAction.LoginElectron},{isActive:!!s.desktopHwa,action:i.EngagementSurfaceAction.LoginDesktopHwa},{isActive:!!s.surfaceHub,action:i.EngagementSurfaceAction.LoginSurfaceHub}].forEach(function(e){return e.isActive&&n.push({action:i.EngagementSurfaceAction[e.action]})}),(n=_.uniqBy(n,function(e){return e.action})).length&&(a=_(n).map(function(e){return _.isString(e.action)?i.EngagementSurfaceAction[e.action]:_.isNumber(e.action)?e.action:void 0}).without(void 0).value(),this.eventingService.$emit(this.constants.events.engagementSurfaces.onAction,a)),this.getEnhancedUserStateParams().then(function(e){var n=r({},e,{completedActions:a});return t.applyUserStateDebugOverrides(n)})},t.prototype.withTimeout=function(e,t,n){var a=this;return this.settingsService.valueAsBoolean(this.constants.settings.names.disableEngagementSurfacesStartUpDependencyTimeout)?e:(n=n||this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesStartUpDependencyTimeout)||30*this.constants.timeInMiliseconds.second,this.utilityService.getPromiseWithTimeout(e,n,this.$q,t,!0).catch(function(e){if(e===t){var r=a.loggingService.newScenario(a.constants.scenarios.onboarding.engagementSurfaces.dependencyTimeout),i=t+" exceeded "+n+"ms";r.fail({message:i})}return a.$q.reject(e)}))},t.prototype.getEnhancedUserStateParams=function(){var e=this,t=this.settingsService.valueAsBoolean(this.constants.settings.names.enableSfbSpecificFre),n=this.settingsService.valueAsBoolean(this.constants.settings.names.enableDiscoverySettingEs),a=this.myUserPreferencesStore.getFirstWebLogin()||moment(),r=this.authenticationService.getLoggedInUser().profile||{},i=this.userResourcesSettingsStore.waitForSettingAndGetValue(SkypeX.Services.UserResourcesStorageKey.licenseType),o=this.channelService.getTeams(),s=n?this.channelService.getNonDiscoverableTeams():this.$qNoApply.resolve([]),c=t?this.sfbTeamsUpgradeService.getUpgradePolicyV2():this.$qNoApply.resolve(void 0),u=this.identityService.isTenantAdmin(),l=this.identityService.isServiceAdmin(),p=this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingCanCreateTenantWideTeam),g=u&&p?this.tenantService.canCreateTenantWide():this.$q.resolve({canCreate:!1}),d=this.settingsService.valueAsBoolean(this.constants.settings.names.disableEspWaitForPstnFlag)?this.$q.resolve(this.callingSupportService.isPSTNCallingAllowed()):this.callingSupportService.isPstnCallingAllowedAsync(),h=this.callingSupportService.getPhoneNumberAsync("esRepository");return this.utilityService.whenAllAllowFailures([this.withTimeout(i,"userLicensePromise"),this.withTimeout(o,"getTeamsPromise"),this.withTimeout(s,"getNonDiscoverableTeamsPromise"),this.withTimeout(c,"sfbUpgradePolicyPromise"),this.withTimeout(g,"canCreatePromise"),this.withTimeout(d,"isPstnCallingAllowedPromise"),this.withTimeout(h,"getPhoneNumberPromise")]).then(function(t){var n=t[0].result,i=t[1].result,o=t[2].result,s=t[3].result,c=t[4].result&&t[4].result.canCreate,p=t[5].result,g=t[6].result,d=i.some(function(e){return e.isTenantWide}),h=i.some(function(e){return 2==e.teamType});return{id:r.oid,tenantId:r.tid,teamsCount:(i||[]).length,licenseType:n,firstWebLogin:a,hasChatApp:e.userAppsStore.hasApp(e.constants.appId.chat),hasCallsApp:e.userAppsStore.hasApp(e.constants.appId.calling),hasClassTeam:h,isAnonymous:e.authenticationService.isAnonymous(),isGuest:e.identityService.isGuestUserType(),isFreemiumTenant:e.identityService.isFreemiumTenant(),isSfbUpgrade:s&&e.sfbTeamsUpgradeService.isUpgradedUserPolicy(s),isHelpBotConversationEmpty:e.helpBotService.isEmptyConversation,isTenantAdmin:u,isServiceAdmin:l,hasTWTInTenant:d,canCreateTWT:c,isHealthcareUser:e.settingsService.valueAsBoolean(e.constants.settings.names.enableHealthcareFre),earlyDesktopPromotedTimes:(e.storageService.get(e.constants.growth.earlyDesktopPromo.storageKey,!1)||[]).map(function(e){return moment(e)}),earlyMobilePromotedTimes:(e.storageService.get(e.constants.growth.earlyMobilePromo.storageKey,!1)||[]).map(function(e){return moment(e)}),canPromoteDesktop:e.downloadAppService.isDownloadSupported(),canPromoteMobile:e.settingsService.valueAsBoolean(e.constants.settings.names.promoteMobile),nonDiscoverableTeamsCount:(o||[]).length,isInCall:function(){return!!e.callingService.getActiveCall()},isSMBVoiceUser:"SmallMediumBusiness"==n&&p&&!!g}})},t.prototype.getEcsSurfaceConfigurations=function(){var e=this,t=this._getEcsSurfaceConfigurations();if(this.esPortalComms.isUsingEspPortal())return this.esPortalComms.getSurfacesFromPortal().then(function(t){return e.logger.info("retrieved config from ESP Portal, using --\x3e"),e.logger.info(JSON.stringify(t,null,2)),t}).catch(function(n){return e.logger.error("failed retrieving config from ESP portal"+n.message),t});var n=this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesSTOverride);if(n){try{n=atob(n)}catch(e){}var a=JSON.parse(n);return this.logger.info("retrieved config from ST Override, using --\x3e"),this.logger.info(JSON.stringify(a,null,2)),this.$q.resolve(a)}return this.$q.resolve(t)},t.prototype._getEcsSurfaceConfigurations=function(){var e=this,t=[],n=[this.constants.settings.names.engagementSurfaces,this.constants.settings.names.engagementSurfacesFre];n.forEach(function(n){var a=e.settingsService.valueFor(n);a?((a=_.isString(a)?JSON.parse(a):a).forEach(function(e,t){e.isSettled=!0,e.order=t}),t.push.apply(t,a)):e.logger.warn("no value found for engagement surfaces key '"+n+"'")});var a=this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesExpManifest)||[];return _.without.apply(_,[a].concat(n)).forEach(function(n){var a=e.settingsService.valueFor(n)||[];a.forEach(function(e,t){e.isSettled=!1,e.order=t}),e.addOrReplaceSurfaces(t,a)}),t},t.prototype.addOrReplaceSurfaces=function(e,t){var n=this;(t||[]).forEach(function(t){var a=_.findIndex(e,function(e){return e.id===t.id});a>-1?(e[a]=t,n.logger.info("overwrote surface "+t.id+" from experiment config")):e.push(t)})},t.prototype.getSurfaceConfigurations=function(e,t,n){var a=this,r=_.keyBy(t,function(e){return e.id}),o=e.map(function(e){return a.convertSurfaceConfig(e,r[e.id])}),s=_.keyBy(n,function(e){return e.id}),c=o.filter(function(e){return!!s[e.id]||e.trigger===i.Trigger.SurfaceShown||e.trigger===i.Trigger.Programmatic});if(!n.length&&this.firstRunService.isFRESession()&&(c=o),o.length!==c.length&&this.esPortalComms.isUsingEspPortal()){var u=o.filter(function(e){return!s[e.id]&&e.trigger!==i.Trigger.SurfaceShown&&e.trigger!==i.Trigger.Programmatic}).map(function(e){return e.id});this.logger.warn("non-deployed surface ids detected. ensure MT is deployed prior to using these ids in production: "+u.join()),c=o}return this.applySurfaceDisplayDebugOverrides(c)},t.prototype.convertSurfaceConfig=function(e,t){var n=r({},e,{treatment:e.treatment||"",isControlGroup:e.isControlGroup||!1,isSettled:e.isSettled||!1,trigger:i.Trigger[e.trigger],surface:i.EngagementSurface[e.surface],recur:Math.max(1,e.recur||1),displayed:[],eligibleTimes:[],condition:new o(e.condition),triggerFilter:new o(e.triggerFilter),startTime:void 0,endTime:void 0});return t&&(n.eligibleTimes=_.map(t.controlGroupTimestamps,function(e){return moment(new Date(e))}),n.displayed=e.isControlGroup?n.eligibleTimes:_.map(t.displayedTimestamps,function(e){return moment(new Date(e))})),this.esPortalComms.isUsingEspPortal()&&(n.displayed=[]),e.startTime&&(n.startTime=moment(new Date(e.startTime))),e.endTime&&(n.endTime=moment(new Date(e.endTime))),_.isUndefined(n.trigger)&&this.logger.error("unknown trigger: "+e.trigger),_.isUndefined(n.surface)&&this.logger.error("unknown surface: "+e.surface),_.isNaN(n.recur)&&(this.logger.error("unknown recurrence: "+e.recur),n.recur=1),n},t.prototype.applyUserStateDebugOverrides=function(e){var t=this;if(!this.enableEspDebugOverride)return e;var n=this.storageService.get(this.constants.growth.engagementSurfaces.debugHook.userStateOverrideStorageKey,!0)||{};return _.forOwn(n,function(n,a){var r=moment(n,moment.ISO_8601,!0);r.isValid()?e[a]=r:e[a]="true"===n||"false"===n?t.utilityService.convertStringToBoolean(n):n}),e},t.prototype.applySurfaceDisplayDebugOverrides=function(e){if(!this.enableEspDebugOverride)return e;var t=this.storageService.get(this.constants.growth.engagementSurfaces.debugHook.displayedOverrideStorageKey,!0)||{};return _.forEach(e,function(e){if(t.hasOwnProperty(e.id))if(t[e.id]){var n=moment(t[e.id],moment.ISO_8601,!0);n.isValid()&&(e.displayed=[n])}else e.displayed=[]}),e},t.prototype.withRetry=function(e,t,n,a,r){void 0===t&&(t=null),void 0===n&&(n=["5xx","404"]),void 0===a&&(a=3),void 0===r&&(r=1e3);var i=this.$q.defer(),o=function(s){void 0===s&&(s=0),t&&t.resume(),e().then(i.resolve).catch(function(e){var c=(e||{}).statusCode;if(!n.map(function(e){return new RegExp(e.replace(/x/gi,"\\d"))}).some(function(e){return e.test(c)}))return i.reject(e);s<a?(s++,t&&t.pause({reason:"failed. will retry after delay. status="+c+" count="+s}),setTimeout(function(){return o(s)},Math.pow(s,2)*r)):i.reject(e)})};return o(0),i.promise},t.prototype.syncCache=function(){var e=this;if(this.esCache.needsSync()){this.esCache.startSync();var n=this.$qNoApply.resolve(),a=this.esCache.cache;if(a.actions.length){var r={items:a.actions.map(function(e){return{action:e}})};n=n.finally(function(){return e.performApiPut(t.API_ENDPOINT+"/actions",{callType:t.CALL_TYPE},r).toNgPromise(e.$qNoApply).then(function(){return e.esCache.clearActions()})})}return a.displayed.forEach(function(a){n=n.finally(function(){return e.performApiPut(t.API_ENDPOINT+"/displayed",{callType:t.CALL_TYPE},a).toNgPromise(e.$qNoApply).then(function(){return e.esCache.clearDisplayed(a.id)})})}),n.finally(function(){return e.esCache.endSync()}),n}},t.prototype.applyCache=function(e){return this.esCache.cache.displayed.forEach(function(t){var n=e.displayed.find(function(e){return e.id===t.id});if(n)t.isControlGroup?n.controlGroupTimestamps.push(t.timestamp):n.displayedTimestamps.push(t.timestamp);else{var a={id:t.id,priority:t.priority,displayedTimestamps:[],controlGroupTimestamps:[]};t.isControlGroup?a.controlGroupTimestamps.push(t.timestamp):a.displayedTimestamps.push(t.timestamp),e.displayed.push(a)}}),e.userState.completedActions=e.userState.completedActions||[],this.esCache.cache.actions.forEach(function(t){e.userState.completedActions.push({action:i.EngagementSurfaceAction[t]})}),this.$qNoApply.resolve(e)},Object.defineProperty(t.prototype,"esCache",{get:function(){var e=this,n=function(){return e.storageService.get(t.ES_CACHE_KEY)||{isSyncing:!1,actions:[],displayed:[]}},a=function(n){return e.storageService.set(t.ES_CACHE_KEY,n)},r=function(){return e.storageService.remove(t.ES_CACHE_KEY)};return{needsSync:function(){var e=n();return(e.actions.length||e.displayed.length)&&!e.isSyncing},startSync:function(){var e=n();e.isSyncing=!0,a(e)},endSync:function(){var e=n();e.isSyncing=!1,!e.actions.length&&!e.displayed.length?r():a(e)},addDisplayed:function(e){var t=n();e.timestamp=(new Date).toISOString(),t.displayed.push(e),a(t)},addActions:function(e){var t=n(),r=e.items.map(function(e){return e.action});t.actions=_.uniq(t.actions.concat(r)),a(t)},clearActions:function(){var e=n();e.actions=[],a(e)},clearDisplayed:function(e){var t=n();t.displayed=t.displayed.filter(function(t){return t.id!==e}),a(t)},get cache(){return n()}}},enumerable:!0,configurable:!0}),t.CALL_TYPE="engagement_surfaces",t.API_ENDPOINT="/me/engagementSurfaces",t.RELEVANTCONTACTS_ENDPOINT="/users/relevantcontacts",t.ES_CACHE_KEY="esp-local-cache",t.NAKED_DTO={displayed:[],engagementSurfaces:[],lastDisplayedByPriority:[],priorityThrottlesInMinutes:[30,60,720,1440,10080],userState:{completedActions:[]}},t}(SkypeX.Services.GenericRestClient);t.EsRepository=s,angular.module("teamspace.esRepository",["teamspace.loggingService","skypeX.myUserPreferencesStore","teamspace.eventingService","teamspace.channelService","teamspace.tenantService","teamspace.userAppsStore","teamspace.authenticationService","skypeX.userResourcesSettingsStore","teamspace.utilityService","teamspace.identityService","teamspace.sfbTeamsUpgradeService","teamspace.esSurfaceStack","teamspace.esLogger","teamspace.esPortalComms","teamspace.storageService","teamspace.downloadAppService","teamspace.callingService","teamspace.callingSupportService","teamspace.firstRunService"]).service("esRepository",s)},1762:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t){this.id=e,this.parent=t}return e.prototype.isCyclic=function(e){return!(!e||this.id!==e)||!!this.parent&&this.parent.isCyclic(e||this.id)},e.prototype.toString=function(){return this.parent?this.parent.toString()+" -> "+this.id:this.id},e}(),i=function(){function e(e,t,n,a,r,i,o,s,c,u){this.$parse=e,this.esSurfaceStack=t,this.constants=a,this.platformDetectService=r,this.desktopUtilityService=i,this.desktopHandlingService=o,this.aggregatedSettingsStore=s,this.settingsService=c,this.myUserPreferencesStore=u,this.logger=n.newLogger("EsParser")}return e.$inject=["$parse","esSurfaceStack","esLogger","constants","platformDetectService","desktopUtilityService","desktopHandlingService","aggregatedSettingsStore","settingsService","myUserPreferencesStore"],e.prototype.parse=function(e,t){var n=this,i=/{\s*\$(\S+)\s*}/g,o=e.toString(),s=function(e,a){return e.replace(i,function(e,i){var o=_.find(t,function(e){return e.id===i}),c=new r(i,a);return o?c.isCyclic()?(n.logger.error("Cycle found in condition references: "+c.toString()+"!"),"(false)"):s("("+o.condition.toString()+")",c):(n.logger.error("Unknown condition reference to surface id = "+i+"!"),"(false)")})};o=s(o);var c=this.$parse(o);return{invoke:function(e){var t=$("head"),r={moment:moment,user:_.clone(e),surfaces:n.esSurfaceStack.getSurfaceState(),now:moment(),os:{name:n.platformDetectService.getOS(),version:n.platformDetectService.getOSVersion(),supportsDesktopApp:n.platformDetectService.osSupportsDesktopApp()},client:{isDesktopAppInstalled:n.desktopHandlingService.getIsAppInstalled(),type:n.getClientType(),window:{width:window.innerWidth,height:window.innerHeight},theme:n.settingsService.getActiveTheme(),version:moment(t.data(n.constants.dataNames.versionDate)),build:moment(t.data(n.constants.dataNames.buildDate))},ecs:{moment:function(e){return moment(n.settingsService.valueFor(e))},boolean:function(e){return n.settingsService.valueAsBoolean(e)},value:function(e){return n.settingsService.valueFor(e)}}};t=null,r.user.firstWebLogin=e.firstWebLogin.clone(),r.user.settings=n.aggregatedSettingsStore.getSettings(),r.user.firstLoginInfo={};var i=_.clone(n.myUserPreferencesStore.getUserPreferences().firstLoginInformation||{});return Object.keys(i).forEach(function(e){var t=i[e];t&&moment(t).isValid()&&(r.user.firstLoginInfo[e]=moment(t))}),(e.completedActions||[]).forEach(function(e){var t=a.EngagementSurfaceAction[e],n=t.replace(/^\s*(.)/,function(e,t){return t.toLowerCase()});r.user[t]=r.user[n]=!0}),!!c(r)}}},e.prototype.evaluateExpressions=function(e,t){var n=this,a={};return Object.keys(e).forEach(function(r){var i=e[r];if(_.isNumber(i)&&(i=i.toString()),_.isString(i)){try{i=n.$parse(i)}catch(e){var o="failed to parse ["+i+"] in resx parameters. "+e.message;n.logger.error(o),i=function(){}}e[r]=i}a[r]=i(t)}),a},e.prototype.evaluateExpression=function(e,t){var n;try{n=this.$parse(e)(t)}catch(t){var a="failed to parse ["+e+"] in parameter expression. "+t.message;this.logger.error(a)}return n},e.prototype.parseFnCall=function(e){void 0===e&&(e="");var t=[e.indexOf("("),e.lastIndexOf(")")],n=t[0],a=t[1],r=e.substr(0,n).trim();if(n<0&&a<0)return{fnName:e.trim(),params:[]};if(n>0&&n+1==a)return{fnName:r,params:[]};if(n<=0||a<=0||n>a)return this.logger.error("Invalid parameter expression in "+e),{fnName:void 0,params:[]};var i=e.substring(n+1,a).trim();return 0==i.length?{fnName:r,params:[]}:{fnName:r,params:this.splitTerms(i).map(function(e){return e.trim()||"undefined"})}},e.prototype.getClientType=function(){return this.desktopUtilityService.isSurfaceHub()?"surfaceHub":teamspace.services.ClientType[this.desktopUtilityService.getClientType()]},e.prototype.splitTerms=function(e){var t={"(":")","[":"]","{":"}",'"':'"',"'":"'"},n=[],a=[],r=null,i=[];return(e||"").split("").forEach(function(e){void 0!=t[e]&&(r=t[e],a.push(r)),e===r&&(a.pop(),r=a.length>0?a[a.length-1]:null),null===r&&","===e?(n.push(i.join("")),i=[]):i.push(e)}),(i.length>0||","===e[e.length-1])&&n.push(i.join("")),n},e}();t.EsParser=i,angular.module("teamspace.esParser",["teamspace.constants","teamspace.loggingService","teamspace.esSurfaceStack","teamspace.esLogger","teamspace.platformDetectService","teamspace.desktopUtilityService","teamspace.desktopHandlingService","skypeX.aggregatedSettingsStore","teamspace.settingsService"]).service("esParser",i)},1763:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.$q=e,this.helpBotService=t,this.proactiveMessageService=n}return e.$inject=["$q","helpBotService","proactiveMessageService"],e.prototype.invokeMessage=function(e,t,n){var a=this,r=e.params,i=r.messageId,o=r.action;return this.helpBotService.initialize().then(function(){return a.proactiveMessageService.postProactiveMessage(r)}).then(function(){return t.stop()}).catch(function(e){var n=e.errorCode,r=e.statusCode,s="Failed to post proactive message with messageId:"+i+" action: "+o;return t.fail({errorMessage:s,errorCode:n,statusCode:r}),a.$q.reject({errorMessage:s})})},e}();t.EsHelpBotService=a,angular.module("teamspace.esHelpBotService",["teamspace.loggingService","teamspace.constants","teamspace.helpBotService","teamspace.proactiveMessageService"]).service("esHelpBotService",a)},1764:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,m){this.$window=e,this.$rootScope=t,this.$q=n,this.utilityService=a,this.constants=r,this.coachmarksService=i,this.esActionHandler=o,this.esSurfaceStack=s,this.esTranslate=c,this.esParser=u,this.$sce=p,this.resources=g,this.analyticsService=d,this.eventingService=h,this.ariaLiveService=m,this.logger=l.newLogger("EsMenuService")}return e.$inject=["$window","$rootScope","$q","utilityService","constants","coachmarksService","esActionHandler","esSurfaceStack","esTranslate","esParser","esLogger","$sce","resources","analyticsService","eventingService","ariaLiveService"],e.prototype.isMenuInProgress=function(e,t,n){if(e.surface!==r.EngagementSurface.Menu)return!1;if(!e.displayed.length)return!1;var a=e.params,i=e.id,o=e.treatment,s=this.getTasks(i,o,a,n,t);if(!s||0===s.length)return!1;var c=s.filter(function(e){return e.isComplete}).length;return c>0&&c<s.length},e.prototype.isMenuComplete=function(e,t,n){if(e.surface!==r.EngagementSurface.Menu)return!1;var a=e.params,i=e.id,o=e.treatment,s=this.getTasks(i,o,a,n,t);return!_.some(s,function(e){return!e.isComplete})},e.prototype.displayMenu=function(e,t,n,r){var i=this,o=e.params,s=e.id,c=e.treatment,u=this.getElementAndPlacement(o),l=u.element,p=u.placement,g=this.getImage(o,n),d=this.getTasks(s,c,o,r,n);if(!d)return this.$q.reject();var h=d.filter(function(e){return e.isComplete}).map(function(e){return e.associatedAction}).join(),m=this.esTranslate.instant(o.resxKey,a({},o.resxParams||{},{numTasks:d.length,numCompletedTasks:d.filter(function(e){return e.isComplete}).length}),n),f=function(){i.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc)},v=function(e){var t=e.which||e.keyCode;if(t===i.constants.keyCodes.escape&&(f(),e.stopPropagation()),e.ctrlKey&&t===i.constants.keyCodes.m){var n=i.utilityService.stripHtml(m);i.ariaLiveService.update(n,!0),_.defer(function(){return $(".task-items button.menu-item:first").focus()}),e.stopPropagation()}},y=[];return this.coachmarksService.showAdHocCoachmark({element:l,placement:p,className:o.className,viewport:o.viewport,containedIn:o.containedIn,isSticky:o.isSticky,showStickyClose:o.showStickyClose,autoCloseInSeconds:o.autoCloseInSeconds,hideArrow:o.hideArrow,appendTo:o.appendTo,content:this.$sce.trustAsHtml(m),panelType:teamspace.PanelType.engagementSurfaceMenu,img:g,taskInfo:{tasks:d},trackData:{id:s,treatment:c,state:h},onClose:function(){return i.esSurfaceStack.setCurrentAction(i.constants.growth.engagementSurfaces.actionKey.xClose)},onTimeout:function(){return i.onTimeout(s,c)}},t).then(function(e){if(!e)return i.$q.reject()},function(e){return i.$q.reject(e)},function(){i.$window.addEventListener("keydown",v,!0),y=[i.eventingService.$on(i.$rootScope,i.constants.events.engagementSurfaces.killActive,function(){return f()}),function(){return i.$window.removeEventListener("keydown",v,!0)}],i.ariaLiveService.update(i.esTranslate.instant(i.resources.strings.esp_menu_surface_aria_announcement),!1)}).finally(function(){return y.forEach(function(e){return e()})})},e.prototype.getElementAndPlacement=function(e){var t=e.element,n=e.placement,a=0;return _.isArray(t)&&(t=_.find(t,function(e){return $(e).is(":visible")})||_.first(t),a=_.indexOf(e.element,t)),_.isArray(n)&&(n=n[a]),{element:t,placement:n}},e.prototype.getImage=function(e,t){var n=e.img||{src:void 0};return{src:n.src,altResxKey:n.altResxKey,headerContent:n.headerResxKey&&this.$sce.trustAsHtml(this.esTranslate.instant(n.headerResxKey,n.headerResxParams,t))}},e.prototype.getTasks=function(e,t,n,a,r){var i=this;n.tasks=n.tasks||[];var o=Math.max(n.minTasks||1,1),s=Math.max(n.maxTasks||n.tasks.length,o),c=n.tasks.filter(function(e){var t=_.trim(e.condition)||""+!0;return i.esParser.parse(t,a.engagementSurfaces).invoke(a.userState)}).slice(0,s);if(!(c.length<o))return this.convertTasks(e,t,c,a.userState,r);this.logger.warn("not showing "+e+" due to insufficient number of applicable tasks, tasks="+c.length+" min="+o+" max="+s)},e.prototype.convertTasks=function(e,t,n,i,o){var s=this,c=this.constants.growth.engagementSurfaces.actionKey.displaySurface.name,u={id:e,treatment:t,close:function(){}};return n.map(function(t,n){return{isComplete:i.completedActions.some(function(e){return r.EngagementSurfaceAction[t.associatedAction]===e}),associatedAction:t.associatedAction,content:s.$sce.trustAsHtml(s.esTranslate.instant(t.resxKey,t.resxParams,o)),trackData:{currIndex:n,actionKey:s.esActionHandler.parseActionKey(t.actionKey).key},onClick:function(){s.esSurfaceStack.setCurrentAction(t.actionKey);var n=s.eventingService.$on(s.$rootScope,s.constants.events.engagementSurfaces.onAction,function(e,n){n.some(function(e){return r.EngagementSurfaceAction[t.associatedAction]===e})&&s.eventingService.$emit(s.constants.events.engagementSurfaces.killActive)});s.esActionHandler.handleAction(t.actionKey,u,o).finally(function(){return n()}).finally(function(){return s.esActionHandler.handleAction(c+"('"+e+"')",a({},u,{id:""}),o)})}}})},e.prototype.onTimeout=function(e,t){var n=this,a={panelType:teamspace.PanelType.engagementSurfaceMenu,dataBag:{id:e,treatment:t,actionKey:this.constants.growth.engagementSurfaces.actionKey.timeout}};_.defer(function(){return n.analyticsService.sendPseudoPanelView(a)}),this.esSurfaceStack.setCurrentAction(this.constants.growth.engagementSurfaces.actionKey.timeout)},e}();t.EsMenuService=i,angular.module("teamspace.esMenuService",["teamspace.esTranslate","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.coachmarksService","teamspace.analyticsService","teamspace.esLogger","teamspace.esParser","teamspace.eventingService","teamspace.ariaLiveService","teamspace.utilityService","teamspace.locales"]).service("esMenuService",i)},1765:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$translate=e,this.esParser=t,this.settingsService=n,this.constants=a,this.locale=r.getLocale().replace("-","_")}return e.$inject=["$translate","esParser","settingsService","constants","localizationService"],e.prototype.instant=function(e,t,n){var a=this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesResx)||{};if(!t)return a[this.locale]&&a[this.locale][e]?a[this.locale][e]:this.$translate.instant(e);var r=this.esParser.evaluateExpressions(t,n);if(a[this.locale]&&a[this.locale][e]){var i=a[this.locale][e];return t&&Object.keys(t).forEach(function(e){var t=new RegExp("{{"+e+"}}","g");i=i.replace(t,r[e])}),i}var o=r.html;r.html="{{html}}";var s=this.$translate.instant(e,r);return o&&(s=s.replace(/{{html}}/g,o)),s},e}();t.EsTranslate=a,angular.module("teamspace.esTranslate",["pascalprecht.translate","teamspace.esParser","teamspace.settingsService","teamspace.constants","teamspace.localizationService"]).service("esTranslate",a)},1766:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(){}return e.Action={Gesture:"Action.Gesture",Outcome:"Action.Outcome",Scenario:"Action.Scenario",ScenarioType:"Action.ScenarioType"},e.App={Name:"App.Name"},e.DataBag={id:"DataBag.id",currIndex:"DataBag.currIndex",messageType:"DataBag.messageType",atmentions:"DataBag.atmentions",attachments:"DataBag.attachments",slashCommand:"DataBag.slashCommand"},e.Tab={Ordinal:"Tab.Ordinal"},e.Module={Name:"Module.Name"},e.Panel={Type:"Panel.Type"},e.Thread={Type:"Thread.Type"},e}(),i=function(){function e(){}return e.PanelView="panelView",e.PanelAction="panelAction",e}(),o=function(){function e(){}return e.Scenario={composeSendMessage:"composeSendMessage",addChannel:"addChannel",addMember:"addMember",chatStartAudioCall:"chatStartAudioCall",chatStartAudioCallSFB:"chatStartAudioCallSFB",chatStartVideoCall:"chatStartVideoCall",chatStartVideoCallSFB:"chatStartVideoCallSFB",chatListFavoriteConversation:"chatListFavoriteConversation",composeExpandComposer:"composeExpandComposer",sendInvites:"sendInvites",executeSlashCommand:"executeSlashCommand",teamCreate:"teamCreate",remindMeLater:"remindMeLater",teamDiscoverJoin:"teamDiscoverJoin",activityFeedClick:"activityFeedClick",channelNavTab:"channelNavTab",composeSelectExtension:"composeSelectExtension",channelComposeFocus:"channelComposeFocus",channelNewPost:"channelNewPost",messageReply:"messageReply",changeTheme:"changeTheme",manageTenantSettings:"manageTenantSettings"},e.ScenarioType={admin:"admin",inviteMembers:"inviteMembers",manageLink:"manageLink"},e.Gesture={click:"click"},e.Module={Name:{addMember:"addMember",sendInvites:"sendInvites",reviewTeamDiscoverySettings:"reviewTeamDiscoverySettings",toggleJoinTenantByUrl:"toggleJoinTenantByUrl"}},e.Outcome={submit:"submit",select:"select",closeDialog:"closeDialog"},e.DataBag={newConversation:"newConversation",replyConversation:"replyConversation",newP2PMessage:"newP2PMessage",atMentionCommand:"atMention"},e.Panel={Type:{channel:"channel",activity:"activity"}},e.Thread={Type:{Channel:"Channel",OneOnOneChat:"OneOnOneChat",GroupChat:"GroupChat"}},e}(),s=function(){function e(e,t,n,a,r){this.$rootScope=e,this.constants=t,this.eventingService=n,this.esRepository=a,this.matchers=this.getDataMatchRegistrants(),r.registerForMtma(this),this.initializeOnAppLaunchAndReinit()}return e.$inject=["$rootScope","constants","eventingService","esRepository","orchestrationService"],e.prototype.isPanelAction=function(e){return(e.eventType||"").toLowerCase()===i.PanelAction.toLowerCase()},e.prototype.isPanelView=function(e){return(e.eventType||"").toLowerCase()===i.PanelView.toLowerCase()},e.prototype.propEqual=function(e,t,n){return e.properties[t]&&e.properties[t].value==n},e.prototype.propGreaterThan=function(e,t,n){return e.properties[t]&&e.properties[t].value>n},e.prototype.getDataMatchRegistrants=function(){var e=this;return[{action:a.EngagementSurfaceAction.ComposeChannelMessage,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeSendMessage)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.newConversation)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.Channel)}},{action:a.EngagementSurfaceAction.ComposeChannelReply,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeSendMessage)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.replyConversation)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.Channel)}},{action:a.EngagementSurfaceAction.AddMention,match:function(t){return e.propGreaterThan(t,r.DataBag.atmentions,0)}},{action:a.EngagementSurfaceAction.ComposeOneOnOneChatMessage,match:function(t){return e.propEqual(t,r.DataBag.messageType,o.DataBag.newP2PMessage)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.OneOnOneChat)}},{action:a.EngagementSurfaceAction.ShareFile,match:function(t){return e.propGreaterThan(t,r.DataBag.attachments,0)&&e.propEqual(t,r.Panel.Type,o.Panel.Type.channel)}},{action:a.EngagementSurfaceAction.AddChannel,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.addChannel)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)}},{action:a.EngagementSurfaceAction.AddMember,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.Action.Scenario,o.Scenario.addMember)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.admin)&&e.propEqual(t,r.Module.Name,o.Module.Name.addMember)}},{action:a.EngagementSurfaceAction.ComposeOneOnManyChatMessage,match:function(t){return e.propEqual(t,r.DataBag.messageType,o.DataBag.newP2PMessage)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.GroupChat)}},{action:a.EngagementSurfaceAction.StartAudioCall,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartAudioCall)||e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartAudioCallSFB)}},{action:a.EngagementSurfaceAction.StartVideoCall,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartVideoCall)||e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartVideoCallSFB)}},{action:a.EngagementSurfaceAction.FavoriteConversation,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.chatListFavoriteConversation)}},{action:a.EngagementSurfaceAction.ExpandComposer,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeExpandComposer)}},{action:a.EngagementSurfaceAction.InviteTenantMember,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Outcome,o.Outcome.select)&&e.propEqual(t,r.Action.Scenario,o.Scenario.sendInvites)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.inviteMembers)&&e.propEqual(t,r.Module.Name,o.Module.Name.sendInvites)}},{action:a.EngagementSurfaceAction.SendMessageWithAtCommand,match:function(t){return e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.Action.Scenario,o.Scenario.executeSlashCommand)&&e.propEqual(t,r.DataBag.slashCommand,o.DataBag.atMentionCommand)}},{action:a.EngagementSurfaceAction.CreateTeam,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.teamCreate)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)}},{action:a.EngagementSurfaceAction.SetDiscoverySettingModalReminder,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.remindMeLater)&&e.propEqual(t,r.Action.Outcome,o.Outcome.closeDialog)&&e.propEqual(t,r.Module.Name,o.Module.Name.reviewTeamDiscoverySettings)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask1,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->viewActivityQuickGuide->complete")||e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Scenario,o.Scenario.activityFeedClick)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask2,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->newChatInteractiveGuide->complete")||e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.newP2PMessage)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask3,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->sendChannelMessageInteractiveGuide->complete")||e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.newConversation)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.Channel)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask4,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->joinATeamInteractiveGuide->complete")||e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Scenario,o.Scenario.teamDiscoverJoin)}},{action:a.EngagementSurfaceAction.ChannelNavTab,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.channelNavTab)&&e.propGreaterThan(t,r.Tab.Ordinal,3)}},{action:a.EngagementSurfaceAction.ComposeSelectExtension,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeSelectExtension)}},{action:a.EngagementSurfaceAction.ChannelComposeFocus,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.channelComposeFocus)||e.propEqual(t,r.Action.Scenario,o.Scenario.channelNewPost)||e.propEqual(t,r.Action.Scenario,o.Scenario.messageReply)}},{action:a.EngagementSurfaceAction.ChangeTheme,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.changeTheme)}},{action:a.EngagementSurfaceAction.ManageLinkSettings,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Scenario,o.Scenario.manageTenantSettings)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.manageLink)&&e.propEqual(t,r.Module.Name,o.Module.Name.toggleJoinTenantByUrl)}}]},e.prototype.cleanupOnAppTeardown=function(){this.unbindActionEventFn&&this.unbindActionEventFn(),this.unbindBiEventFn&&this.unbindBiEventFn(),this._hasStarted=!1},e.prototype.initializeOnAppLaunchAndReinit=function(){},e.prototype.mtmaTelemetryIdentifier=function(){return"EsDataCollector"},e.prototype.startUp=function(){var e=this;this._hasStarted||(this._hasStarted=!0,this.unbindActionEventFn=this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.engagementSurfaces.onAction,function(t,n){for(var a=0,r=n||[];a<r.length;a++)!function(t){_.remove(e.matchers,function(e){return e.action===t})}(r[a]);!e.matchers.length&&e.unbindBiEventFn&&e.unbindBiEventFn()}),this.unbindBiEventFn=this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.logging.biEvent,function(t,n){_.defer(function(){var t=_(e.matchers).filter(function(e){return e.match(n)}).map(function(e){return e.action}).value();e.esRepository.addEngagemetSurfaceActions(t)})}))},e}();t.EsDataCollector=s,angular.module("teamspace.esDataCollector",["teamspace.constants","teamspace.eventingService","teamspace.esRepository","teamspace.orchestrationService"]).service("esDataCollector",s)},1767:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.surfaces={}}return e.prototype.setSurfaces=function(e){this.surfaces=_.keyBy(e,function(e){return e.id})},e.prototype.setCurrentSurface=function(e){this.current&&(this.previous=this.current),this.current=a({},e)},e.prototype.unsetCurrentSurface=function(){this.current=void 0},e.prototype.setCurrentAction=function(e){_.isNil(this.current)||(this.current.action=e)},e.prototype.onSurfaceClosed=function(){this.previous=this.current,this.current=void 0},e.prototype.getSurfaceState=function(){var e=_.cloneDeep({prev:this.previous,curr:this.current,all:this.surfaces});return e.prev&&(e.prev.displayed=_.map(e.prev.displayed,function(e){return e.clone()})),e.curr&&(e.curr.displayed=_.map(e.curr.displayed,function(e){return e.clone()})),Object.keys(e.all||{}).forEach(function(t){var n=e.all[t];n.displayed=_.map(n.displayed,function(e){return e.clone()})}),e},e}();t.EsSurfaceStack=r,angular.module("teamspace.esSurfaceStack",[]).service("esSurfaceStack",r)},1768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i){this.$q=e,this.constants=t,this.esParser=n,this.esSurfaceStack=a,this.dialogService=r,this.analyticsService=i}return e.$inject=["$q","constants","esParser","esSurfaceStack","dialogService","analyticsService"],e.prototype.displayCards=function(e,t,n){var a=this,r=this.$q.defer(),i={cards:e.params.map(function(t){return a.transform(e,t,n)}),scenario:t,preCloseCallback:function(e){var t=[a.constants.promptCards.eventSource.overlayClick,a.constants.promptCards.eventSource.escape];if(_.includes(t,e)){var n=angular.element(".prompt-cards-holder"),r=n&&n.scope();r&&a.sendDismissPanelAction(r)}return!0}},o=function(){return a.dialogService.open(a.constants.dialogs.promptCardsHolder,i).closePromise.then(function(e){var t,n=(t={},t[a.constants.promptCards.eventSource.doneBtn]=a.constants.growth.engagementSurfaces.actionKey.completedClose,t[a.constants.promptCards.eventSource.xClose]=a.constants.growth.engagementSurfaces.actionKey.xClose,t[a.constants.promptCards.eventSource.overlayClick]=a.constants.growth.engagementSurfaces.actionKey.xClose,t[a.constants.promptCards.eventSource.escape]=a.constants.growth.engagementSurfaces.actionKey.xClose,t);a.esSurfaceStack.setCurrentAction(n[e.value]),r.resolve()}).catch(r.reject)};return this.dialogService.isAnyDialogOpen()?(t.pause({reason:"waiting for existing dialog to close before showing swipe cards modal"}),this.dialogService.onAllDialogsClosed().then(function(){t.resume(),o()})):o(),r.promise},e.prototype.transform=function(e,t,n){return t.text=t.text||{},{image:t.imageSrc,heading:t.headingResxKey,scenarioStepName:t.name,translationContext:{id:t.text.resxKey,values:this.getResxParamsForPromptCard(t.text.resxParams,n)},video:t.video&&t.video.text&&{hasTranslations:!1,translationContext:{id:t.video.text.resxKey,values:this.getResxParamsForPromptCard(t.video.text.resxParams,n)},playScenarioMarker:t.name+"-playVideo",doneScenarioMarker:t.name+"-closeVideo"},panelType:teamspace.PanelType.engagementSurfaceCarousel,trackData:{id:e.id,treatment:e.treatment,card:t.name}}},e.prototype.getResxParamsForPromptCard=function(e,t){var n=e;return e&&(n=this.esParser.evaluateExpressions(e,t)),n?JSON.stringify(n):void 0},e.prototype.sendDismissPanelAction=function(e){this.analyticsService.onPanelAction(e,{action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.components.PanelActionOutcome.dismiss,scenario:teamspace.components.PanelActionScenario.closeFreCard,scenarioType:teamspace.components.PanelActionScenarioType.quitFRE},module:{name:teamspace.components.PanelModuleName.promptCardHolder.toString(),type:teamspace.components.PanelModuleType.closeDialog,summary:"Close FRE Card"}})},e}();t.EsCarouselService=a,angular.module("teamspace.esCarouselService",["teamspace.esTranslate","teamspace.loggingService","teamspace.appStateAdapter","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.esParser","teamspace.constants"]).service("esCarouselService",a)},1769:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t,n,a,r,i,o,s,c,u,l){this.$rootScope=e,this.$q=t,this.constants=n,this.coachmarksService=a,this.esActionHandler=r,this.esSurfaceStack=i,this.esTranslate=o,this.$sce=s,this.analyticsService=c,this.eventingService=u,this.esTriggers=l}return e.$inject=["$rootScope","$q","constants","coachmarksService","esActionHandler","esSurfaceStack","esTranslate","$sce","analyticsService","eventingService","esTriggers"],e.prototype.displayCoachmark=function(e,t,n){var r=this,i=this.$q.defer(),o=e.params,s=e.id,c=e.treatment,u=$.noop,l=function(){r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),i.resolve(!0)},p=o.primaryAction&&{title:this.esTranslate.instant(o.primaryAction.resxKey,o.primaryAction.resxParams,n),tooltip:this.esActionHandler.actionTitle(o.primaryAction.actionKey),onClick:function(){r.esSurfaceStack.setCurrentAction(o.primaryAction.actionKey),r.esActionHandler.handleAction(o.primaryAction.actionKey,{id:s,treatment:c,close:function(){}},n)},trackScenario:teamspace.components.PanelActionScenario.engagementSurfaceCoachmarkPrimaryButton,trackSummary:"engagement surface coachmark primary button",trackOutcome:teamspace.components.PanelActionOutcome.primary,trackData:{id:e.id,treatment:e.treatment,actionKey:this.esActionHandler.parseActionKey(o.primaryAction.actionKey).key}},g=o.secondaryAction&&{title:this.esTranslate.instant(o.secondaryAction.resxKey,o.secondaryAction.resxParams,n),tooltip:this.esActionHandler.actionTitle(o.secondaryAction.actionKey),onClick:function(){r.esSurfaceStack.setCurrentAction(o.secondaryAction.actionKey),r.esActionHandler.handleAction(o.secondaryAction.actionKey,{id:s,treatment:c,close:function(){}},n)},trackScenario:teamspace.components.PanelActionScenario.engagementSurfaceCoachmarkSecondaryButton,trackSummary:"engagement surface coachmark secondary button",trackOutcome:teamspace.components.PanelActionOutcome.secondary,trackData:{id:e.id,treatment:e.treatment,actionKey:this.esActionHandler.parseActionKey(o.secondaryAction.actionKey).key}},d=o.img||{src:void 0},h=o.element,m=o.placement,f=0;_.isArray(h)&&(h=_.find(h,function(e){return $(e).is(":visible")})||_.first(h),f=_.indexOf(o.element,h)),_.isArray(m)&&(m=m[f]);var v=function(){u(),o.closeOnBiEvent&&(u=r.esTriggers.subscribe(a.Trigger.BIEvent,o.closeOnBiEvent,function(){r.esSurfaceStack.setCurrentAction(r.constants.growth.engagementSurfaces.actionKey.biEvent);var t={panelType:teamspace.PanelType.engagementSurfaceCoachmark,dataBag:{id:e.id,treatment:e.treatment,actionKey:r.constants.growth.engagementSurfaces.actionKey.biEvent}};return _.defer(function(){return r.analyticsService.sendPseudoPanelView(t)}),r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),r.$q.resolve()}))};this.coachmarksService.showAdHocCoachmark({element:h,content:this.$sce.trustAsHtml(this.esTranslate.instant(o.resxKey,o.resxParams,n)),placement:m,className:o.className,viewport:o.viewport,containedIn:o.containedIn,panelType:teamspace.PanelType.engagementSurfaceCoachmark,asModal:o.asModal,isSticky:o.isSticky,showStickyClose:o.showStickyClose,onClose:function(){return r.esSurfaceStack.setCurrentAction(r.constants.growth.engagementSurfaces.actionKey.xClose)},onTimeout:function(){var t={panelType:teamspace.PanelType.engagementSurfaceCoachmark,dataBag:{id:e.id,treatment:e.treatment,actionKey:r.constants.growth.engagementSurfaces.actionKey.timeout}};_.defer(function(){return r.analyticsService.sendPseudoPanelView(t)}),r.esSurfaceStack.setCurrentAction(r.constants.growth.engagementSurfaces.actionKey.timeout)},autoCloseInSeconds:o.autoCloseInSeconds,hideArrow:o.hideArrow,appendTo:o.appendTo,primaryAction:p,secondaryAction:g,img:{src:d.src,altResxKey:d.altResxKey,headerContent:d.headerResxKey&&this.$sce.trustAsHtml(this.esTranslate.instant(d.headerResxKey,d.headerResxParams,n))},markDisplayedOnTargetMove:o.markDisplayedOnTargetMove,trackData:{id:e.id,treatment:e.treatment}},t).then(function(e){o.closeOnBiEvent&&u(),i.resolve(e)},i.reject,function(e){o.closeOnBiEvent&&v(),i.notify(e)});var y=this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return l()});return i.promise.finally(function(){return y()}),i.promise.then(function(e){if(!e)return r.$q.reject()})},e}();t.EsCoachmarkService=r,angular.module("teamspace.esCoachmarkService",["teamspace.esTranslate","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.coachmarksService","teamspace.analyticsService","teamspace.eventingService","teamspace.esTriggers"]).service("esCoachmarkService",r)},1770:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){var e=this;this.debouncedOnResize=_.debounce(function(t){return e.hoistTargets(t.data.config)},100)}return e.prototype.init=function(e){this.removeBottomOverlay(),this.bottomOverlay=$("<div>",{id:"es-bottom-overlay"}).addClass("es-overlay-full").addClass("es-overlay-bottom"),!e.hideDisabledOverlay&&this.bottomOverlay.addClass("es-overlay-full-semiopaque"),_.isFunction(e.onOverlayClick)&&this.bottomOverlay.on("click",function(){return e.onOverlayClick()}),$("body").append(this.bottomOverlay)},e.prototype.next=function(e){$(window).off("resize",this.debouncedOnResize),this.hoistTargets(e),$(window).on("resize",{config:e},this.debouncedOnResize)},e.prototype.hide=function(){$(window).off("resize",this.debouncedOnResize),this.demoteTargets(),this.removeBottomOverlay()},e.prototype.removeBottomOverlay=function(){this.bottomOverlay&&this.bottomOverlay.remove(),this.bottomOverlay=null},e.prototype.hoistTargets=function(e){if(this.demoteTargets(),this.primaryTarget=$(e.targetSelector),this.primaryTarget.length&&(this.primaryTarget.parents().addClass("es-overlay-target-parents-zfix"),this.primaryTarget=this.primaryTarget.first(),this.primaryTarget.is(":visible"))){this.primaryTarget.addClass("es-overlay-primary-target"),this.addRelativePositionIfNecessary(this.primaryTarget),this.primaryOverlay=$("<div>",{id:"es-top-overlay"}).addClass("es-overlay-top"),e.hideDisabledTargetOverlay||(this.primaryOverlay.addClass("es-overlay-primary-semiopaque"),this.primaryOverlay.css("background-color",this.findNearestBackgroundColor(this.primaryTarget))),e.allowTargetInteraction&&this.primaryOverlay.css("z-index",-1),_.isFunction(e.onTargetOverlayClick)&&this.primaryOverlay.on("click",function(){return e.onTargetOverlayClick()});var t=this.findNearestBackgroundColor(this.primaryTarget);if(t&&$("<style>").text(".es-overlay-primary-target { background-color: "+t+" }").appendTo(this.primaryOverlay),this.affixToTargetPosition(this.primaryOverlay,this.primaryTarget),this.primaryTarget.append(this.primaryOverlay),e.focusSelector&&(!(this.secondaryTarget=$(e.focusSelector))||this.secondaryTarget.length)&&(this.secondaryTarget=this.secondaryTarget.first(),this.secondaryTarget.is(":visible"))){this.secondaryTarget.addClass("es-overlay-secondary-target"),this.addRelativePositionIfNecessary(this.secondaryTarget),this.highlightBorder=$("<div>",{id:"es-highlight-border"}).addClass("es-overlay-highlight").addClass("shadow-level-3");var n=e.focusBorderPadding||{vertical:0,horizontal:0};0===n.vertical&&0===n.horizontal||(this.secondaryOverlay=$("<div>").addClass("es-overlay-secondary-overlay"),_.isFunction(e.onTargetOverlayClick)&&this.secondaryOverlay.on("click",function(){return e.onTargetOverlayClick()}),this.affixToTargetPosition(this.secondaryOverlay,this.secondaryTarget),$("body").append(this.secondaryOverlay)),this.affixToTargetPosition(this.highlightBorder,this.secondaryTarget,n.vertical,n.horizontal),$("body").append(this.highlightBorder)}}},e.prototype.demoteTargets=function(){this.primaryOverlay&&this.primaryOverlay.remove(),this.highlightBorder&&this.highlightBorder.remove(),this.secondaryOverlay&&this.secondaryOverlay.remove(),this.primaryTarget&&this.primaryTarget.removeClass("es-overlay-primary-target"),this.primaryTarget&&this.primaryTarget.parents().removeClass("es-overlay-target-parents-zfix"),this.secondaryTarget&&this.secondaryTarget.removeClass("es-overlay-secondary-target"),this.primaryTarget=this.secondaryTarget=this.primaryOverlay=this.highlightBorder=this.secondaryOverlay=null},e.prototype.affixToTargetPosition=function(e,t,n,a){void 0===n&&(n=0),void 0===a&&(a=0),e.css({position:"fixed",height:t.outerHeight()-2*n,width:t.outerWidth()-2*a,top:t.offset().top+n,left:t.offset().left+a})},e.prototype.addRelativePositionIfNecessary=function(e){var t=e.css("position");_.includes(["absolute","relative","fixed"],t)||e.addClass("es-overlay-relative")},e.prototype.findNearestBackgroundColor=function(e){for(var t=void 0;!t&&e&&!e.first().is(":root");){var n=(e=e.first()).css("background-color");n&&"rgba(0, 0, 0, 0)"!==n&&(t=n),e=e.parent()}return t},e}();t.EsOverlayService=a,angular.module("teamspace.esOverlayService",[]).service("esOverlayService",a)},1771:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,m){this.$window=e,this.$rootScope=t,this.$q=n,this.$timeout=a,this.constants=r,this.esActionHandler=i,this.coachmarksService=o,this.esSurfaceStack=s,this.esTranslate=c,this.esTriggers=u,this.esOverlayService=p,this.eventingService=g,this.resources=d,this.ariaLiveService=h,this.utilityService=m,this.logger=l.newLogger("EsQuickGuideService")}return e.$inject=["$window","$rootScope","$q","$timeout","constants","esActionHandler","coachmarksService","esSurfaceStack","esTranslate","esTriggers","esLogger","esOverlayService","eventingService","resources","ariaLiveService","utilityService"],e.prototype.displayQuickGuide=function(e,t,n){var r=this,i=this.$q.defer(),o=e.id,s=e.treatment,c=e.params,u=c.cards||[],l=$.noop,p=$.noop,g=$.noop,d=$.noop,h=function(){_.defer(function(){return $("#coachmark-tooltip").find("[tabbable]:visible:not(.invisible):first").focus()})},m=void 0,f=function(v,y,S){if(void 0===y&&(y=!1),void 0===S&&(S=1),v!==m){if(m=v,p(),(v=Math.max(v,0))>=u.length){var A=y?r.constants.growth.engagementSurfaces.actionKey.xClose:r.constants.growth.engagementSurfaces.actionKey.completedClose;return r.esSurfaceStack.setCurrentAction(A),angular.element(".outer-shell").attr("aria-hidden","false"),r.esOverlayService.hide(),t.stop(),void i.resolve()}t.pause({reason:"showing quick guide index "+v});var T=u[v],C=T.preActionKeys||[],w=T.ariaKey&&r.esTranslate.instant(T.ariaKey),b=r.$q.resolve();C.forEach(function(e){b=b.finally(function(){return r.esSurfaceStack.setCurrentAction(e),r.esActionHandler.handleAction(e,{id:o,treatment:s,close:function(){}},n)})});var P=Math.max(T.delayInSeconds?T.delayInSeconds*r.constants.timeInMiliseconds.second:1,1),E=function(e){return e&&e.split(",").map(function(e){return e.trim()+":visible:first"}).join(", ")},k=E(T.focusSelector),O=E(T.targetSelector),H=k||O,q=_.isBoolean(T.hideDisabledTargetOverlay)?T.hideDisabledTargetOverlay:!!T.nextOnBiEvent,D=_.isBoolean(T.allowTargetInteraction)?T.allowTargetInteraction:!!T.nextOnBiEvent,N=_.isBoolean(T.hideProgress)?T.hideProgress:!!c.hideProgress,M=_.isBoolean(T.hideArrowNavigation)?T.hideArrowNavigation:!!T.nextOnBiEvent,B=_.isBoolean(T.preventFocusGrab)?T.preventFocusGrab:!(!T.nextOnBiEvent&&!T.allowTargetInteraction),x=T.name?e.id+"->"+T.name:e.id,j=r.esTranslate.instant(T.resxKey,T.resxParams,n);D&&k&&(r.logger.error("card ["+(T.name||v)+"] interactive target with focus selector is not allowed"),r.logger.error("card ["+(T.name||v)+"] removing focus selector to allow target to be interactive!"),k=void 0,H=O),d=function(e){var t=$(H),n=$("#coachmark-tooltip");D&&t.is(e)||t.has(e).length||n.is(e)||n.has(e).length||h()},g=function(){if(D&&B){var e=$(H),t=document.activeElement;e.has(t).length||(e.is("button, input, [tabindex]")?e.focus():e.find("button, input, [tabindex]").filter(":visible:not([disabled]):not([tabindex=-1])").filter(function(){return $(this).width()&&$(this).height()}).first().focus())}},b.then(function(){return r.$timeout(P,!1)}).then(function(){return l=function(){r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),f(v+1)}}).then(function(){return r.esOverlayService.next({targetSelector:O,focusSelector:k,focusBorderPadding:T.focusPadding,hideDisabledTargetOverlay:q,allowTargetInteraction:D})}).then(function(){return r.logger.info("displaying card "+(T.name?x:e.id+"->"+(v+1)))}).then(function(){var e=!1;return r.coachmarksService.showAdHocCoachmark({element:H,content:j,placement:T.placement,className:T.className,containedIn:T.containedIn,panelType:teamspace.PanelType.engagementSurfaceCoachmark,onClose:function(){return f(u.length,!0)},quickGuideInfo:{count:u.length,current:v+1,onPrevious:function(){return f(v-1,!1,-1)},onNext:function(){return f(v+1)},hideCloseBtn:c.hideCloseBtn,hideProgress:N,hideArrowNavigation:M,preventFocusGrab:B,ariaLabel:w},trackData:{currIndex:v,id:x,treatment:s},img:{src:T.imageSrc}}).then(function(t){if(!t&&!e)return r.logger.warn("skipping card "+(v+1)+" as "+O+" was not visible or moved"),f(v+S)},function(e){return r.$q.reject(e)},function(){var t=r.utilityService.stripHtml(j);r.ariaLiveService.update(t,!0),T.nextOnBiEvent&&(p=r.esTriggers.subscribe(a.Trigger.BIEvent,T.nextOnBiEvent,function(){return e=!0,r.$q.resolve(l())})),g()})}).catch(function(e){return e=e||{},r.logger.error("skipping index "+v+". Exception thrown "+e.message),f(v+S)}).finally(function(){return m=void 0})}},v=function(){r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),f(u.length)},y={hideDisabledOverlay:c.hideDisabledOverlay,onOverlayClick:function(){c.nextOnOverlayClick&&l&&l()}};angular.element(".outer-shell").attr("aria-hidden","true"),this.esOverlayService.init(y),this.ariaLiveService.update(this.esTranslate.instant(this.resources.strings.esp_quickguides_aria_anouncement),!0),f(0);var S=function(e){e.target&&d(e.target)},A=function(e){var t=e.which||e.keyCode;t===r.constants.keyCodes.escape&&(v(),e.stopPropagation()),e.ctrlKey&&t===r.constants.keyCodes.shift&&g(),e.ctrlKey&&t===r.constants.keyCodes.alt&&h()};this.$window.addEventListener("focus",S,!0),this.$window.addEventListener("keydown",A,!0);var T=[this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return v()}),this.eventingService.$on(this.$rootScope,this.constants.events.calling.callConnecting,function(){return v()}),function(){return r.$window.removeEventListener("focus",S,!0)},function(){return r.$window.removeEventListener("keydown",A,!0)}];return i.promise.finally(function(){return T.forEach(function(e){return e()})}),i.promise},e}();t.EsQuickGuideService=r,angular.module("teamspace.esQuickGuideService",["teamspace.constants","teamspace.esTranslate","teamspace.coachmarksService","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.esOverlayService","teamspace.esTriggers","teamspace.eventingService","teamspace.ariaLiveService","teamspace.utilityService","teamspace.locales"]).service("esQuickGuideService",r)},1772:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){var i=this;this.$q=e,this.fetchRelevantContactsHandler=t,this.fetchWhatsNewHandler=n,this.fetchJoinTenantUrlHandler=a,this.fetchUserPhoneNumberHandler=r,this.dataHandlers={};var o=Array.from(arguments);this.dataHandlers={},o.forEach(function(e){i.isDataHandler(e)&&(i.dataHandlers[e.dataKey]=e)})}return e.$inject=["$q","fetchRelevantContactsHandler","fetchWhatsNewHandler","fetchJoinTenantUrlHandler","fetchUserPhoneNumberHandler"],e.prototype.isDataHandler=function(e){return e&&e.dataKey&&e.fetchData},e.prototype.hasRegisteredData=function(e){return!!this.dataHandlers[e]},e.prototype.fetchData=function(e){return this.hasRegisteredData(e)?this.dataHandlers[e].fetchData():this.$q.reject(e+" is not a registered data key")},e}();t.EsFetchDataHandler=a,angular.module("teamspace.esFetchDataHandler",["teamspace.fetchRelevantContactsHandler","teamspace.fetchWhatsNewHandler","teamspace.fetchJoinTenantUrlHandler","teamspace.fetchUserPhoneNumberHandler"]).service("esFetchDataHandler",a)},1773:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.esRepository=t,this.logger=n.newLogger("FetchRelevantContactsHandler")}return e.$inject=["constants","esRepository","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.relevantContacts},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching data");var t={};return this.esRepository.getRelevantContacts().then(function(n){return t[e.dataKey]=n}).then(function(){return t})},e}();t.FetchRelevantContactsHandler=a,angular.module("teamspace.fetchRelevantContactsHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchRelevantContactsHandler",a)},1774:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1775),r=(function(){}(),function(){function e(e,t,n,a,r,i,o,s,c,u){this.$rootScope=e,this.$qNoApply=t,this.$timeout=n,this.$http=a,this.$compile=r,this.constants=i,this.htmlSanitizer=o,this.whatsNewUrlTemplate="https://support.office.com/api/{0}/o365content/{1}?format=json",this.logger=u.newLogger("fetchWhatsNewHandler");var l=s.valueAsObject(i.settings.names.whatsNewSettings),p=l&&l.assetId||i.help.defaultWhatsNewAssetId,g=c.getLocale();this.whatsNewUrl=this.whatsNewUrlTemplate.replace("{0}",g).replace("{1}",p)}return e.$inject=["$rootScope","$qNoApply","$timeout","$http","$compile","constants","htmlSanitizer","settingsService","localizationService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.whatsNew},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching whats new data");var t={};return this.getWhatsNew().then(function(n){return t[e.dataKey]=n}).then(function(){return t})},e.prototype.getWhatsNew=function(){var e=this,t=this.$qNoApply.defer(),n={method:"GET",url:this.whatsNewUrl,skipCommonHeaders:!0};return this.$http(n).then(function(n){if(n&&n.data)e.logger.info("Fetched whats new data"),e.parseSocResponse(n.data).then(function(e){t.resolve(e)});else{var a="Empty response for whats new call.";e.logger.error(a),t.reject(a)}}).catch(function(n){e.logger.error("Failed to fetch what's new data. Error: "+JSON.stringify(e.sanitizeError(n))),t.reject(n)}),t.promise},e.prototype.parseSocResponse=function(e){var t=e.document&&e.document.metadata,n=e.document&&e.document.topic,a={title:t&&t.title,features:n&&n.developerConceptualDocument.introduction.para};return this.compileCoachmarkHtml(a).then(function(e){return{html:e}})},e.prototype.compileCoachmarkHtml=function(e){var t=this,n=this.$rootScope.$new(!0);n.data=e;var r=this.$compile(a)(n);return this.$timeout(function(){return n.$destroy(),t.htmlSanitizer.sanitizeHtml(r.html())})},e.prototype.sanitizeError=function(e){return e=e||{},{status:e.statusCode||e.status,errorCode:e.errorCode,code:e.code,errorSubCode:e.errorSubCode}},e}());t.FetchWhatsNewHandler=r,angular.module("teamspace.fetchWhatsNewHandler",["teamspace.constants","teamspace.esLogger","teamspace.htmlSanitizer","teamspace.settingsService","teamspace.localizationService"]).service("fetchWhatsNewHandler",r)},1775:function(e,t){e.exports='<div class="whats-new-promotion-coachmark-content">\n  <div class="whats-new-promotion-coachmark-title">\n    <span>{{data.title}}</span>\n  </div>\n  <div class="whats-new-promotion-coachmark-features">\n    <ul>\n      <li ng-repeat="feature in data.features">\n        <span>{{feature}}</span>\n      </li>\n    </ul>\n  </div>\n</div>'},1776:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.manageTenantService=t,this.logger=n.newLogger("fetchJoinTenantUrlHandler")}return e.$inject=["constants","manageTenantService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.joinTenantUrl},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching join tenant url");var t={};return this.manageTenantService.getJoinTenantUrl().then(function(n){return t[e.dataKey]={url:n}}).then(function(){return t})},e}();t.FetchJoinTenantUrlHandler=a,angular.module("teamspace.fetchJoinTenantUrlHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchJoinTenantUrlHandler",a)},1777:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.callingSupportService=t,this.logger=n.newLogger("FetchUserPhoneNumberHandler")}return e.$inject=["constants","callingSupportService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.userPhoneNumber},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching user phone number from CallingSupportService");var t={};return this.callingSupportService.getPhoneNumberAsync("fetch-user-phone-number-handler").then(function(n){return t[e.dataKey]=n}).then(function(){return t})},e}();t.FetchUserPhoneNumberHandler=a,angular.module("teamspace.fetchUserPhoneNumberHandler",["teamspace.constants","teamspace.esLogger","teamspace.callingSupportService"]).service("fetchUserPhoneNumberHandler",a)},1778:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.constants=t,this.settingsService=n,this.layoutService=a,this.logger=r.newLogger("ChangeThemeActionHandler")}return e.$inject=["$qNoApply","constants","settingsService","layoutService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.changeTheme.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.changeTheme.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!=n.length||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(r),e.close(),this.$qNoApply.reject(r)}var i=n[0];return this.$qNoApply.resolve().then(function(){var e=_(t.settingsService.getThemes()).find(function(e){return e.key===i});if(!e){var n="Unable to find "+i+" in available themes";throw t.logger.error(n),n}t.layoutService.setThemeCookie(e)}).catch(function(n){return t.logger.error("unable to change "+i+" theme"),e.close(),t.$qNoApply.reject(n)}).finally(function(){return e.close()})},e}();t.ChangeThemeActionHandler=a,angular.module("teamspace.changeThemeActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.settingsService","teamspace.layoutService"]).service("changeThemeActionHandler",a)}},[1737]);
//# sourceMappingURL=https://statics.teams.microsoft.com/hashedjs/lazy-ng1-mod-engagement-surface-services.min.js-bfaf52cf.map