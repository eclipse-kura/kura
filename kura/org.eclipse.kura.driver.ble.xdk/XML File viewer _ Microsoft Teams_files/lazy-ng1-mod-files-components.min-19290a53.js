webpackJsonp([13],{1926:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(1927),i(1931),i(1933),i(1935),i(1937)},1927:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1928),s=i(1929),r=i(1930),o=function(){function e(e,t,i,n,s,r,o,a,c,l,d,h,p,u,f,m,v){var g=this;if(this.constants=i,this.layoutService=n,this.utilityService=r,this.loggingService=o,this.messageService=a,this.filesMessagePaneHelper=c,this.authenticationService=l,this.filesEntityService=d,this.storageService=p,this.filesUtilityService=u,this.channelService=f,this.settingsService=m,this.showStartConversationButton=!1,this.panelRegions=teamspace.PanelRegion,this.moreOptionsText=e.instant(s.strings.files_moreOptions),this.startConversationClicked=!1,this.theme=m.getActiveTheme(),v.$on(t,i.events.layout.themeChanged,function(){g.theme=m.getActiveTheme()}),this.provider){if(this.provider.iconsService){var w=this.provider.iconsService.getIcon(this.fileType);w&&(this.fileIconPath=w.largeIconPath||w.defaultIconPath,this.isSvgIcon=w.isSvg,this.iconAltTextKey=w.altTextResourceKey)}h.getEntryBreadcrumbInfo(this.provider).then(function(e){g.thumbnailImgSrc=e.thumbnailImgSrc})}this.fileIconPath||(this.fileIconPath=this.getTypeSvgSrc(),this.isSvgIcon=!0),this.initConversation(),t.$on("$destroy",function(){c&&c.destroyContextMessagePane()}),this.trackData={fileId:this.fileId,fileType:this.fileType,error:this.error,errorReasonForTelemetry:this.errorReasonForTelemetry}}return e.$inject=["$translate","$scope","constants","layoutService","resources","utilityService","loggingService","messageService","filesMessagePaneHelper","authenticationService","filesEntityService","filesNavigationEntryService","storageService","filesUtilityService","channelService","settingsService","eventingService"],e.prototype.$onChanges=function(e){if(this.hasPrimaryOptions=this.primaryOptions&&this.primaryOptions.options&&this.primaryOptions.options.length&&this.primaryOptions.options.some(function(e){return!e.shouldBeHidden()}),this.settingsService.valueAsBoolean(this.constants.settings.names.enableTeamArchive)&&this.conversationInfo&&this.conversationInfo.threadId){var t=this.channelService.getParentTeamAndChannelByChannelId(this.conversationInfo.threadId);this.isTeamArchived=t&&t.team&&t.team.isArchived}this.isEditButtonAvailable=!!this.hasPrimaryOptions||this.filesUtilityService.isVisioDesktopAppOnlyEditEnabled(this.fileType),this.hasMoreOptions=this.moreOptions&&this.moreOptions.length&&this.moreOptions.some(function(e){return!e.shouldBeHidden()})},e.prototype.initConversation=function(){var e=this;if(this.filesMessagePaneHelper&&this._conversationInfo&&this._conversationInfo.threadId){var t=/p2p/i.test(this._conversationInfo.serviceName);this.filesMessagePaneHelper.initializeContextMessagePane(this._conversationInfo.objectId,this._conversationInfo.threadId,t).then(function(i){return e.updateEnablePostToChannel(i,t)})}},e.prototype.updateEnablePostToChannel=function(e,t){this.showStartConversationButton=e&&!t?!!this.channelService.canPostToChannel(this.conversationInfo.threadId)&&e:e},Object.defineProperty(e.prototype,"conversationInfo",{get:function(){return this._conversationInfo},set:function(e){this._conversationInfo||(this._conversationInfo=e,this.initConversation())},enumerable:!0,configurable:!0}),e.prototype.getTypeSvgSrc=function(){void 0===this.fileType&&(this.loggingService.warn("[getTypeSvgSrc] FileType is undefined, setting to empty string to get default svg"),this.fileType="");var e=this.utilityService.getIconClass({type:this.fileType}),t=this.constants.css.fileIcons;return[t.excel,t.onenote,t.pdf,t.powerpoint,t.visio,t.word].includes(e)?"svg/"+this.utilityService.getSVGBase(this.fileType,"icons-{type}-file-32_1.5x")+".html":"svg/"+this.utilityService.getSVGBase(this.fileType,"icons-{type}")+".html"},e.prototype.startConversation=function(){var e=this;if(!this.startConversationClicked){this.startConversationClicked=!0;var t=this.loggingService.newScenario(this.constants.scenarios.files.toggleChatOpened);this.filesMessagePaneHelper.getReplyChainIdFromFileId(this._conversationInfo.objectId,this._conversationInfo.threadId).then(function(i){i?(e.storageService.set(""+e.constants.files.strings.saveChatIsExpanded,!0),e.filesMessagePaneHelper.showRightRail(e._conversationInfo.threadId,i,teamspace.services.ReplyChainIdType.ParentMessageId,/p2p/i.test(e._conversationInfo.serviceName)),e.showStartConversationButton=!1,t.stop()):(e.createFileAttachment?e.createFileAttachment():e.filesEntityService.getFileDetail(e.fileType,e.conversationInfo.objectUrl).then(function(e){return e.value}).then(function(t){return e.getAttachment(t)})).then(function(t){var i=e.getMessageParams(t,e.conversationInfo.threadId);return e.messageService.createMessage(i)}).then(function(t){return e.authenticationService.getUserInformation().then(function(e){return{upn:((e||{}).profile||{}).upn,messageId:t.messageId}})}).then(function(t){return t.upn?e.storageService.set(""+e.constants.files.strings.saveChatIsExpanded,!0):e.loggingService.warn("Failed to resolve user upn on start conversation"),t.messageId?e.storageService.set(""+e.constants.files.strings.saveChatIsExpanded,!0):e.loggingService.warn("Failed to resolve messageId on start conversation"),t.messageId}).then(function(t){return e.filesMessagePaneHelper.initializeContextMessagePane(e.conversationInfo.objectId,e.conversationInfo.threadId,!1,t)}).then(function(){return e.showStartConversationButton=!1}).then(function(){return t.stop()}).catch(function(i){var n="Failed to start conversation";e.startConversationClicked=!1,e.loggingService.error(n),t.fail({error:n})})})}},e.prototype.rightRailShowExistingComponent=function(){var e=this.loggingService.newScenario(this.constants.scenarios.files.toggleChatOpened);this.layoutService.rightRailShowExistingComponent(),e.stop()},e.prototype.getAttachment=function(e){return{objectId:e.objectId,objectUrl:e.objectUrl,siteUrl:e.siteUrl,serverRelativeUrl:e.serverRelativeUrl,title:e.title,type:e.type}},e.prototype.getMessageParams=function(e,t){return{conversationId:t,replyChainId:"",messageSubject:"",messageBody:"",messagePreview:"",fileAttachments:[e],extensions:"",mentions:"",embeddedLinks:[],isHtml:!0,importance:null,clientId:SkypeX.Services.Utilities.newClientMessageId(),draftObjectId:""}},e}();angular.module("teamspace.fileDocumentTitleBar",["teamspace.layoutService","teamspace.utilityService","teamspace.loggingService","teamspace.messageService","teamspace.settingsService","teamspace.filesEntityService","teamspace.authenticationService","teamspace.filesMessagePaneHelper"]).component("fileDocumentTitleBar",{bindings:{isEditMode:"<?",editAction:"<?",fileName:"<",fileType:"<",fileId:"<",hideClose:"<?",onClose:"&?",isEnabled:"=",inlineActions:"<?",primaryOptions:"<?",moreOptions:"<?",conversationInfo:"<?",createFileAttachment:"&?",provider:"<?",error:"<?",errorReasonForTelemetry:"<?"},template:n,controller:o}).run(["$templateCache",function(e){e.put("components/files/document-viewer/file-document-title-bar/file-document-title-bar-options.html",s),e.put("components/files/document-viewer/file-document-title-bar/file-document-title-bar-more-options.html",r)}])},1928:function(e,t){e.exports='<div class="app-title-bar" analytics-panel="{{::$ctrl.panelRegions.main}}" analytics-panel-view="{ panel: {type: {{$root.trackConstants.panelType.documentStage}} }}" track-data="{{::$ctrl.trackData}}">\n  <svg-include class="title-component title-visible svg-icon" ng-if="$ctrl.isSvgIcon" src="::$ctrl.fileIconPath"></svg-include>\n  <div class="title-component title-visible img-icon" ng-if="!$ctrl.isSvgIcon">\n    <img ng-src="{{::$ctrl.fileIconPath}}" alt="{{::$ctrl.iconAltTextKey|translate}}" title="{{::$ctrl.iconAltTextKey|translate}}"/>\n  </div>\n  <h1 class="title-component title-visible" data-tid="document-stage-title-bar">\n    <span class="document-title" tabindex="0" role="heading">{{::$ctrl.fileName}}</span>\n  </h1>\n  \x3c!--\n    TODO: Requirement 437506\n      <span class="save-status" id="file-save-status"></span>\n  --\x3e\n</div>\n<div class="right-side-buttons pull-right">\n  <div ng-if="::$ctrl.thumbnailImgSrc" class="provider-icon">\n    <span class="app-svg img-container">\n      <img ng-src="{{::$ctrl.thumbnailImgSrc}}"/>\n    </span>\n  </div>\n  <div ng-if="$ctrl.inlineActions && $ctrl.inlineActions.length">\n    <button class="ts-sym inline-action" type="button" ng-repeat="menuItem in $ctrl.inlineActions track by $index" ng-if="!(menuItem.shouldBeHidden && menuItem.shouldBeHidden())" ng-click="menuItem.click()" ng-disabled="!$ctrl.isEnabled" aria-label="{{menuItem.title || menuItem.displayName || undefined}}" ng-attr-title="{{menuItem.title || undefined}}">\n      <svg-include src="menuItem.svgPath"></svg-include>\n      <span>{{menuItem.displayName}}</span>\n    </button>\n  </div>\n  <div class="btn-edit btn-group" ng-if="$ctrl.isEditButtonAvailable && !$ctrl.isEditMode && $ctrl.editAction">\n      <button class="btn ts-btn ts-btn-fluent ts-btn-fluent-titlebar" ng-class="($ctrl.theme==\'contrast\') ? \'ts-btn-fluent-secondary\' : \'ts-btn-fluent-primary\'" aria-label="{{::$ctrl.primaryOptions.primaryButtonAria}}" type="button" ng-click="$ctrl.editAction()" ng-disabled="!$ctrl.isEnabled || $ctrl.isTeamArchived" data-tid="title-bar-primary-edit-button">\n        <span class="ts-btn-edit-text">{{::$ctrl.primaryOptions.primaryButtonText}}</span>\n      </button>\n      <div ng-if="::$ctrl.hasPrimaryOptions" class="dropdown-separator"></div>\n      <button ng-if="::$ctrl.hasPrimaryOptions" aria-label="{{::$ctrl.primaryOptions.dropdownButtonText}}" class="btn ts-btn ts-btn-fluent tn-btn-titlebar inset-border dropdown-toggle-split" ng-class="($ctrl.theme==\'contrast\') ? \'ts-btn-fluent-secondary\' : \'ts-btn-fluent-primary\'" ng-disabled="!$ctrl.isEnabled || $ctrl.isTeamArchived" bs-dropdown placement="bottom" container="body" data-template-url="components/files/document-viewer/file-document-title-bar/file-document-title-bar-options.html" data-tid="title-bar-dropdown-edit-button">\n        <svg-include src="\'svg/icons-triangle-down-small.html\'"></svg-include>\n      </button>\n  </div>\n    <button class="ts-btn ts-btn-fluent ts-btn-fluent-titlebar" ng-class="($ctrl.theme==\'contrast\') ? \'ts-btn-fluent-secondary\' : \'ts-btn-fluent-primary\'" ng-if="::$ctrl.hasPrimaryOptions && !$ctrl.editAction" type="button" ng-disabled="!$ctrl.isEnabled" bs-dropdown placement="bottom" container="body" data-template-url="components/files/document-viewer/file-document-title-bar/file-document-title-bar-options.html" data-tid="title-bar-edit-button">\n      <span class="ts-btn-edit-text">{{::$ctrl.primaryOptions.primaryButtonText}}</span>\n      <ng-include src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n    </button>\n    <button ng-show="$ctrl.showStartConversationButton" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary ts-btn-fluent-titlebar" type="button" ng-click="$ctrl.startConversation()" translate-once="{{::$root.resources.strings.files_startConversation }}" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}" track-scenario="{{::$root.trackConstants.trackScenario.fileStartConversation}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.files}}" track-name="{{::$root.trackConstants.trackModuleName.documentStageStartConversationButton}}" track-type="{{::$root.trackConstants.trackType.submit}}" track-summary="Starts a conversation around the file and opens the chat pane" data-tid="start-conversation" ng-disabled="!$ctrl.isEnabled">\n    </button>\n    <button class="ts-btn ts-btn-fluent ts-btn-fluent-secondary btn-close ts-btn-fluent-titlebar" ng-if="$ctrl.onClose && !$ctrl.hideClose" type="button" ng-click="$ctrl.onClose()" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-scenario="{{::$root.trackConstants.trackScenario.closeDocumentStage}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.files}}" track-name="{{::$root.trackConstants.trackModuleName.documentStageCloseButton}}" track-type="{{::$root.trackConstants.trackType.other}}" track-summary="Close the document stage" aria-label="{{::$root.resources.strings.files_closeDocumentStageAria | translate }}" translate-once="{{::$root.resources.strings.files_closeFullscreenButton }}" data-tid="fullscreen-close-button">\n    </button>\n</div>\n<span ng-if="!$ctrl.hasMoreOptions" class="right-padding"></span>\n<div ng-if="$ctrl.hasMoreOptions" class="inline-button pull-right">\n  <button class="ts-sym app-icons-fill-hover" title="{{::$ctrl.moreOptionsText}}" aria-label="{{::$ctrl.moreOptionsText}}" type="button" ng-disabled="!$ctrl.isEnabled" bs-dropdown placement="bottom" container="body" data-template-url="components/files/document-viewer/file-document-title-bar/file-document-title-bar-more-options.html" data-tid="title-bar-more-button" aria-haspopup="true">\n    <ng-include src="\'svg/icons-more.html\'"></ng-include>\n  </button>\n</div>\n<div class="inline-button pull-right collapsable" ng-class="{\'expand\': $ctrl.layoutService.rightRailVisible || !$ctrl.layoutService.rightRailContext}">\n  <button ng-disabled="!$ctrl.isEnabled" type="button" ng-if="!$ctrl.layoutService.rightRailVisible && $ctrl.layoutService.rightRailContext" class="ts-sym app-icons-fill-hover pull-right" ng-click="$ctrl.rightRailShowExistingComponent()" data-tid="document-chat-expand" title="{{::$root.resources.strings.calling_toggleChat_on|translate}}" aria-label="{{::$root.resources.strings.calling_toggleChat_on|translate}}">\n    <ng-include src="\'svg/icons-chat.html\'"></ng-include>\n  </button>\n</div>\n'},1929:function(e,t){e.exports='<div class="context-dropdown dropdown-menu dropdown app-default-menu files-popover">\n  <ul class="context-menu-dropdown file-action-menu" acc-role="menu">\n    <li ng-repeat="menuItem in $ctrl.primaryOptions.options track by $index" ng-class="::menuItem.class" ng-if="!(menuItem.shouldBeHidden && menuItem.shouldBeHidden())" class="ts-menu-item" acc-role="menu-item focus-default" aria-label="{{ ::menuItem.displayName }}">\n      <button class="ts-sym ts-svg" acc-role="focus-default" ng-click="menuItem.click()" data-tid="{{ menuItem.id }}" type="button" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}" track-scenario="{{menuItem.id == \'office-open-in-desktop-app\' ? $root.trackConstants.trackScenario.editFileInApp : $root.trackConstants.trackScenario.editFileOnline}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.files}}" track-name="{{::$root.trackConstants.trackModuleName.fileDocumentTitleBar}}" track-type="{{::$root.trackConstants.trackType.menuItem}}" track-data="{fileAction: \'{{::menuItem.id}}\', fileControl: \'file edit menu\', fileId: \'{{::$ctrl.fileId}}\'}" track-summary="Edit a file in app OR edit a file in Office online">\n        <ng-include src="menuItem.svgPath"></ng-include>\n        <span aria-hidden="true">{{menuItem.displayName}}</span>\n      </button>\n    </li>\n  </ul>\n</div>'},1930:function(e,t){e.exports='<div class="context-dropdown dropdown-menu dropdown app-default-menu files-popover">\n  <ul class="context-menu-dropdown file-action-menu" acc-role="menu">\n    <li ng-repeat="menuItem in $ctrl.moreOptions track by $index" ng-if="!(menuItem.shouldBeHidden && menuItem.shouldBeHidden())" class="ts-menu-item" acc-role="menu-item focus-default" aria-label="{{ ::menuItem.displayName }}">\n      <button class="ts-sym ts-svg" type="button" ng-click="menuItem.click()" data-tid="{{ menuItem.id }}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.selectFileAction}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.files}}" track-name="{{::$root.trackConstants.trackModuleName.fileActionButton}}" track-type="{{::$root.trackConstants.trackType.menuItem}}" track-data="{fileAction: \'{{::menuItem.id}}\', fileControl: \'file action menu\', fileId: \'{{::$ctrl.fileId}}\'}" track-summary="Choose a file action to perform - document stage">\n        <ng-include src="menuItem.svgPath"></ng-include>\n        <span aria-hidden="true">{{menuItem.displayName}}</span>\n      </button>\n    </li>\n  </ul>\n</div>'},1931:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=i(1932),r=i(42),o=function(){function e(e,t,i,n,s,o,a,c,l,d,h){var p=this;this.$window=t,this.$sce=i,this.settingsService=n,this.layoutService=s,this.constants=o,this.loggingService=a,this.utilityService=c,this.authenticationService=l,this.routeUtilityService=d,this.filesDocStageHelperService=h,this.webviewElement=null,this.iframeElement=null,this.childMessageListner=function(e){if(p.iframeElement=p.iframeElement?p.iframeElement:document.getElementById("file-unified-app-viewer-frame"),p.iframeElement&&e.source===p.iframeElement.contentWindow)return p.commonMessageListner({data:e.data})},this.useWebview=n.valueAsBoolean(o.settings.names.isDesktopApp)&&!!t.electronSafeIpc&&t.desktopSettings.enableTabWebviews;var u=t.electronSafeIpc,f=this.layout.bind(this);u&&this.useWebview?(u.send(o.events.desktopApp.allowWebViewCreate,{enablePreload:!0}),u.once(o.events.desktopApp.webViewCreationEnabled,function(){p.webviewElement=window.document.getElementById("file-unified-app-viewer-webview"),p.eventListener=new r.EventListener(p.webviewElement);p.eventListener.addListener("ipc-message",function(e){return p.webviewProcessMessage(e)});p.eventListener.addListener("crashed",function(e){return a.event(o.telemetry.webview.crashed,{errorEvent:JSON.stringify(e)})});p.eventListener.addListener("gpu-crashed",function(e){return a.event(o.telemetry.webview.gpuCrashed,{errorEvent:JSON.stringify(e)})});p.eventListener.addListener("plugin-crashed",function(e){return a.event(o.telemetry.webview.pluginCrashed,{errorEvent:JSON.stringify(e)})});p.eventListener.addListener("did-fail-load",function(e){a.event(o.telemetry.webview.loadFailed,{errorEvent:JSON.stringify({errorCode:e?e.errorCode:null,errorDescription:e?e.errorDescription:null})})}),p.eventListener.addListener("dom-ready",f),t.addEventListener("resize",f),p.init()})):(this.init(),this.registerForBaseEvents()),e.$on("$destroy",function(){t.removeEventListener("resize",f),t.removeEventListener("message",p.childMessageListner),p.eventListener&&p.eventListener.destroy()})}return e.$inject=["$scope","$window","$sce","settingsService","layoutService","constants","loggingService","utilityService","authenticationService","routeUtilityService","filesDocStageHelperService"],e.prototype.registerForBaseEvents=function(){this.$window.addEventListener("message",this.childMessageListner)},e.prototype.commonMessageListner=function(e){switch(e.data.channel){case"multi-window-manager-channel":return this.handlePostMessagesEvents(e.data.payload)}},e.prototype.sendPostMessage=function(e){var t=this.filesDocStageHelperService.getFilesExperienceOrigin(),i=n({},e,{channel:"multi-window-manager-channel",origin:t,metaData:{correlationId:e.correlationId,source:"browserWindow",destination:{channel:e.eventId,processIds:[]}}});this.useWebview?this.webviewElement.send(this.constants.webViewShim.postMessageToWebview,i):this.iframeElement.contentWindow.postMessage(i,t)},e.prototype.handlePostMessagesEvents=function(e){var t=this;switch(e.eventId){case teamspace.services.ChildWindowEventRequest.WindowReady:this.loggingService.info("Child frame has reported ready state");break;case teamspace.services.ChildWindowEventRequest.WindowInitialized:this.loggingService.info("Child frame has reported it is fully initialized");break;case teamspace.services.ChildWindowEventRequest.NewWindow:this.loggingService.info("Child frame requested to open new window directly (blocked)");break;case teamspace.services.ChildWindowEventRequest.AadGetToken:var i=e.eventId;if(e.correlationId&&e.payload){s=e.payload.resource;return this.loggingService.debug("Child frame requested AAD token:  resource="+s+", correlationId="+e.correlationId),this.authenticationService.getAuthTokens([s]).then(function(n){var s={eventId:i,correlationId:e.correlationId,payload:{token:n}};t.sendPostMessage(s)}).catch(function(i){t.loggingService.error("ERROR: failed to get auth token: correlationId="+e.correlationId+", error="+i)})}this.loggingService.error("Expected payload or correlationId for "+i+" but got none.");break;case teamspace.services.ChildWindowEventRequest.AadGetCurrentUser:if(e.correlationId)return this.loggingService.info("Child frame requested current logged in user correlationId="+e.correlationId),this.authenticationService.getUserInformation().then(function(i){var n={eventId:e.eventId,correlationId:e.correlationId,payload:{authUser:i}};t.sendPostMessage(n)}).catch(function(i){t.loggingService.debug("ERROR: failed to get current logged in user correlationId="+e.correlationId+", error="+i)});this.loggingService.error("ERROR: AadGetCurrentUser request was made but no correlationId was given.");break;case teamspace.services.ChildWindowEventRequest.AadClearCache:if(e.payload){var s=e.payload.resource;this.loggingService.debug("Child frame requested clear adal cache: resource="+s+", correlationId="+e.correlationId),s&&this.authenticationService.clearAdalCache(s)}else this.loggingService.error("Expected data for "+e.eventId+" but got none.");break;case teamspace.services.ChildWindowEventRequest.HideFileViewerLoader:var r=document.getElementById("ts-unified-app-loader");r&&r.parentNode.removeChild(r);break;case teamspace.services.ChildWindowEventRequest.StopDocStageScenario:if(e.payload){a=e.payload.sendTime&&Date.now()-e.payload.sendTime;this.handleScenario(e.payload,a)}break;case teamspace.services.ChildWindowEventRequest.GetDriveItemResponse:a=e.payload&&e.payload.sendTime&&Date.now()-e.payload.sendTime;return this.scenario.mark("exp-request-drive-item",{ipcTimeOverhead:a}),this.redeemPromise.then(function(i){t.scenario.mark("redeem-post-success");var s=n({},i,{driveItemCallStartTime:t.driveItemCallStartTime,driveItemCallEndTime:Date.now()}),r={eventId:e.eventId,correlationId:e.correlationId,payload:s};t.sendPostMessage(r)});case teamspace.services.ChildWindowEventRequest.AddScenarioMarker:if(e.payload&&this.scenario){a=e.payload.sendTime&&Date.now()-e.payload.sendTime;this.scenario.mark(e.payload.scenarioMarker,{ipcTimeOverhead:a})}break;case teamspace.services.ChildWindowEventRequest.FilesExperienceSendData:switch(this.loggingService.info("Post message received with messageId"+e.payload.messageId),e.payload.MessageId){case"App_AccessibilityLoopComplete":var o="backward"!==e.payload.Values.Direction;this.layoutService.navigateToNextLandmark(o);break;case"Unload":var a=e.payload.sendTime&&Date.now()-e.payload.sendTime;this.navigateToPreviousState(a)}break;default:this.loggingService.info("Child frame has reported event "+e.eventId+" which doesn't exist "+e)}},e.prototype.navigateToPreviousState=function(e){var t=this.routeUtilityService.getRootRouteParams(),i=t.threadId?decodeURIComponent(t.threadId):void 0,n=t.ctx?decodeURIComponent(t.ctx):void 0,s=t.messageId?decodeURIComponent(t.messageId):void 0,r=t.subEntityId?decodeURIComponent(t.subEntityId):void 0,o=t.serviceName?decodeURIComponent(t.serviceName):void 0,a=this.filesDocStageHelperService.getPivot(o),c=this.constants.scenarios.files.closeFile+"_"+a,l=this.loggingService.findScenario(c);l?l.stop({ipcTimeOverhead:e,openFileScenarioId:this.scenario&&this.scenario.id}):this.loggingService.info("file-unified-app-viewer: could not find scenario"),this.loggingService.info("navigating away from doc-stage on Unload post-message"),this.filesDocStageHelperService.moveToPreviousState(n,s,r,i)},e.prototype.handleScenario=function(e,t){var i=e.status,n=e.data;if(n)i?this.scenario.stop(n):this.scenario.fail(n);else if(i){var s=e,r=s.deltaWithPerceivedBoot,o=s.officeSessionId;this.scenario.stop({deltaWithPerceivedBoot:r,officeSessionId:o,ipcTimeOverhead:t})}else{var a=e,c=a.errorMessage,o=a.officeSessionId;this.scenario.fail({errorMessage:c,officeSessionId:o,ipcTimeOverhead:t})}},e.prototype.handleFocus=function(e){var t=e.target.dataset.focusDirection||(e.shiftKey?"backward":"forward"),i={MessageId:"Host_AccessibilityLoopComplete",SendTime:Date.now(),Values:{Direction:t}},n={eventId:teamspace.services.ChildWindowEventRequest.FilesExperienceSendData,payload:i};(this.iframeElement||this.webviewElement).focus(),this.sendPostMessage(n)},e.prototype.init=function(){var e=this.getNStarViewerExpUrl();this.fileViewerExpUrl=this.$sce.trustAsResourceUrl(e)},e.prototype.getNStarViewerExpUrl=function(){var e=(this.utilityService.djb2_hash(""+this.objectUrl)||"").toString(),t=this.filesDocStageHelperService.getFilesExperienceOrigin()+"/files/apps/com.microsoft.teams.files/files/"+e+"/open",i=this.settingsService.getActiveTheme(),n={agent:"postmessage",objectUrl:this.objectUrl,fileType:this.fileType,userClickTime:this.userClickTime,ctx:this.ctx,scenarioId:this.scenario&&this.scenario.id||null,theme:i},s=this.settingsService.getRing(),r={"ring.id":s&&s.id||"",createdTime:Date.now()},o=t+"?"+Object.keys(n).filter(function(e){return n[e]}).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&")+"&"+Object.keys(r).map(function(e){return"setting="+e+":"+r[e]}).join("&"),a=this.utilityService.parseUrl(o),c="iframe-container.html#iframeurl="+encodeURIComponent(this.$sce.trustAsResourceUrl(a.href))+"&skipDomainValidation=true";return this.useWebview?c:o},e.prototype.webviewProcessMessage=function(e){return this.commonMessageListner({data:e.args[1]})},e.prototype.layout=function(){if(this.webviewElement&&this.$window.electronSafeIpc){this.uuid||(this.uuid=this.utilityService.generateUUID());var e=this.webviewElement.clientWidth,t=this.webviewElement.clientHeight;this.$window.electronSafeIpc.send(this.constants.events.desktopApp.webViewResize,{width:e,height:t,uuid:this.uuid})}},e}();t.FileUnifiedAppViewerController=o,angular.module("teamspace.fileUnifiedAppViewer",["teamspace.settingsService","teamspace.constants","teamspace.loggingService","teamspace.utilityService","teamspace.routeUtilityService","teamspace.filesDocStageHelperService"]).component("fileUnifiedAppViewer",{bindings:{fileType:"<",objectUrl:"<",scenario:"<",userClickTime:"<",ctx:"<",redeemPromise:"<",driveItemCallStartTime:"<"},template:s,controller:o})},1932:function(e,t){e.exports='<div id="file-unified-app-viewer" class="flex-fill" ng-focus="$ctrl.handleFocus($event)" tabindex="0">\n  <iframe id="file-unified-app-viewer-frame" ng-if="::!$ctrl.useWebview" ng-src="{{$ctrl.fileViewerExpUrl}}" class="wopi-iframe flex-fill" frameborder="0" role="presentation" tabindex="-1" aria-hidden="true">\n  </iframe>\n\n  <webview id="file-unified-app-viewer-webview" ng-if="::$ctrl.useWebview" ng-src="{{$ctrl.fileViewerExpUrl}}" class="wopi-iframe flex-fill" frameborder="0" role="presentation" tabindex="-1" aria-hidden="true">\n  </webview>\n</div>\n'},1933:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1934),s=function(){function e(e,t,i,n,s,r,o,a,c,l,d,h,p,u,f,m){var v=this;this.$scope=e,this.$window=i,this.$timeout=s,this.$cookies=r,this.constants=o,this.loggingService=a,this.utilityService=l,this.authenticationService=d,this.appConfig=h,this.eventingService=p,this.filesActionService=f,this.filesUtilityService=m,this.postMessageId="teams",this.clientId="MicrosoftTeams",this.webViewElement=null,this.initialActiveElement=document.getElementById("file-office-frame-container")||window,this.isDesktopApp=c.valueAsBoolean(o.settings.names.isDesktopApp);var g=!1,w=!1,y=!1;if(i&&i.desktopSettings&&(g=i.desktopSettings.enableWebviewPreload,w=i.desktopSettings.enableWebviewSandbox,y=i.desktopSettings.enableTabWebviews),this.useWebView=c.valueAsBoolean(o.settings.names.filesEnableOneUpWebview)&&this.isDesktopApp&&!!i.electronSafeIpc&&(g&&w||y),this.oneUpServiceUrl=t.trustAsResourceUrl(this.getOneUpServiceUrl()),this.webViewSrc="",this.host=l.parseUrl(n.absUrl()).origin,this.currentLocale=u.getLocale(),e.$on("$destroy",function(){v.removeListeners(),v.scenario.cancel()}),!this.siteUrl||!this.serverRelativeUrl)return this.errorCode=o.files.error.invalidArguments,void this.handleError(this.errorCode,this.siteUrl?"Invalid ServerRelativeURL":"Invalid SiteURL");this.useWebView?this.initWebView():this.getAuthToken().then(function(e){v.initFrame(e)}),this.ensureInitialFocusIsNotStolen()}return e.$inject=["$scope","$sce","$window","$location","$timeout","$cookies","constants","loggingService","settingsService","utilityService","authenticationService","appConfig","eventingService","localizationService","filesActionService","filesUtilityService"],e.prototype.initWebView=function(){var e=this,t=this.$window.electronSafeIpc;t&&this.useWebView&&(t.send(this.constants.events.desktopApp.allowWebViewCreate,{enablePreload:!0}),t.once(this.constants.events.desktopApp.webViewCreationEnabled,function(){e.webViewElement=window.document.getElementById("file-one-up-viewer-webview"),e.messageSource=e.webViewElement;e.addListener("ipc-message",function(t){return e.webviewProcessMessage(t)});e.addListener("crashed",function(t){return e.loggingService.event(e.constants.telemetry.webview.crashed,{errorEvent:JSON.stringify(t)})});e.addListener("gpu-crashed",function(t){return e.loggingService.event(e.constants.telemetry.webview.gpuCrashed,{errorEvent:JSON.stringify(t)})});e.addListener("plugin-crashed",function(t){return e.loggingService.event(e.constants.telemetry.webview.pluginCrashed,{errorEvent:JSON.stringify(t)})});e.addListener("did-fail-load",function(t){e.loggingService.event(e.constants.telemetry.webview.loadFailed,{errorEvent:JSON.stringify({errorCode:t?t.errorCode:null,errorDescription:t?t.errorDescription:null})})});var t=e.layout.bind(e);e.addListener("dom-ready",t),e.$window.addEventListener("resize",t),e.$scope.$on("$destroy",function(){e.$window.removeEventListener("resize",t)}),e.webViewSrc="iframe-container.html#iframeurl=about:blank&processTag="+e.constants.files.strings.oneup}))},e.prototype.layout=function(){if(this.webViewElement&&this.$window.electronSafeIpc){this.uuid||(this.uuid=this.utilityService.generateUUID());var e=this.webViewElement.clientWidth,t=this.webViewElement.clientHeight;this.$window.electronSafeIpc.send(this.constants.events.desktopApp.webViewResize,{width:e,height:t,uuid:this.uuid})}},e.prototype.addListener=function(e,t){this.webViewElement?this.webViewElement.addEventListener(e,t):window.addEventListener(e,t),this.listeners||(this.listeners={}),this.listeners[e]=t},e.prototype.removeListeners=function(){for(var e in this.listeners)this.webViewElement?this.webViewElement.removeEventListener(e,this.listeners[e]):window.removeEventListener(e,this.listeners[e]);this.listeners=null},e.prototype.webviewProcessMessage=function(e){if((e&&e.channel)===this.constants.webViewShim.postMessageFromWebview){var t=e.srcElement||e.target;if(this.webViewElement===t)if(!e.args||e.args.length<2)this.loggingService.error("OneUp viewer did not receive all the params");else{var i=e.args&&e.args[0];window&&window.location&&window.location.origin===i?this.handlePostMessageFromContainer(e.args[1]):this.oneUpServiceOrigin===i?this.handlePostMessage({origin:e.args[0],data:e.args[1],source:this.webViewElement}):this.loggingService.error("INVALID_EVENT_ORIGIN",i)}else this.loggingService.error("OneUp viewer received message from a different webview")}},e.prototype.handlePostMessageFromContainer=function(e){var t=this;if(e&&e.func){if("iframeLoaded"===e.func)return void this.getAuthToken().then(function(e){t.embedParams=t.getEmbedParams(e),t.oneUpServiceOrigin=t.utilityService.parseUrl(t.oneUpServiceUrl).origin,t.webViewElement.send(t.constants.webViewShim.postFormToWebview,{url:t.getOneUpServiceUrl(),params:{context:t.embedParams}})});if("error"===e.func)return void this.handleCurrentWindowErrorMessage(e)}},e.prototype.handleCurrentWindowErrorMessage=function(e){var t="";try{t=JSON.stringify(e.args)}catch(e){t=e.toString()}this.loggingService.error("received error: {0}, for oneup viewer",t),this.handleError("IPC error",t)},e.prototype.initFrame=function(e){var t=document.getElementById("file-one-up-viewer-frame"),i=document.getElementById("file-one-up-viewer-form"),n=document.getElementById("file-one-up-viewer-context");t&&(this.messageSource=t.contentWindow),this.embedParams=this.getEmbedParams(e);try{n.value=JSON.stringify(this.embedParams)}catch(e){this.errorCode=this.constants.files.error.invalidArguments}this.registerPostMessageHandler(),i.submit()},e.prototype.getEmbedParams=function(e){var t={id:this.postMessageId,o:this.host,ct:(new Date).getTime()},i=this.getOneUpThemePayload();return{authToken:e,webUrl:this.siteUrl,id:this.serverRelativeUrl,embed:JSON.stringify(t),culture:this.currentLocale,client_id:this.clientId,correlationId:this.loggingService.sessionId+"-"+this.scenario.id,useHostDownload:!0,theme:i,item:this.driveItem}},e.prototype.getOneUpThemePayload=function(){var e={themePrimary:"#6264a7",themeDark:"#293370"},t={buttonPrimaryTextHovered:"#fff",buttonPrimaryTextFocused:"#fff"};return(this.$cookies.get(this.constants.themes.cookieName)||this.constants.themes.default)===this.constants.themes.highContrast&&(e.themePrimary="#000",e.themeDark="#ffff01",e.neutralLighter="#fff",t.buttonPrimaryTextFocused="#252424",t.buttonPrimaryTextHovered="#252424"),{palette:e,semanticColors:t}},e.prototype.getOneUpServiceUrl=function(){var e=this.appConfig.oneUpServiceConstants.host,t=this.appConfig.oneUpServiceConstants.devHost;return t&&(e=e+"?devHost="+t),e},e.prototype.getAuthToken=function(){var e=this.utilityService.parseUrl(this.siteUrl).origin;return this.authenticationService.getAuthTokens([e])},e.prototype.registerPostMessageHandler=function(){var e=this;this.removeListeners();this.addListener("message",function(t){return e.handlePostMessage(t.originalEvent||t)})},e.prototype.handlePostMessage=function(e){var t=this,i=e,n=this.utilityService.parseUrl(this.oneUpServiceUrl).origin,s="[OneDrive:From:Embed:"+this.postMessageId+"]";if(i&&i.origin&&i.origin.toLowerCase()===n.toLowerCase()&&i.source===this.messageSource&&_.startsWith(i.data,s)){var r=i.data.substr(s.length),o=JSON.parse(r||"{}");switch(o.type){case"success":var a=o;this.stopScenario(a.previewType,a.conversationId);break;case"error":var c=o,l=c.error?c.error.code:this.constants.files.error.unknownOneUp,d=c.error?c.error.message:this.constants.files.error.unknownOneUp;this.handleError(l,d,c.conversationId,c.isExpected);break;case"download":if(this.serviceName&&this.fileDetail){var h={serviceName:this.serviceName,getContextBase:function(){return t.filesUtilityService.getContextBase(t.fileDetail,t.serviceName,void 0,t.fileDetail.objectUrl,!1)}};this.filesActionService.execute(teamspace.services.EntityActionType.Download,this.fileDetail,h)}else this.loggingService.error("oneUp download failed because fileDetail or serviceName undefined for scenario "+this.scenario.id)}i.source&&void 0!==o.conversationId&&this.postAckMessage(i.source,o.conversationId)}},e.prototype.postAckMessage=function(e,t){if(e){var i={type:"acknowledge",conversationId:t},n="[OneDrive:To:Embed:"+this.postMessageId+"]"+JSON.stringify(i);if(this.useWebView&&this.webViewElement)this.webViewElement.send(this.constants.webViewShim.postMessageToWebview,n);else{var s=this.utilityService.parseUrl(this.oneUpServiceUrl).origin;e.postMessage(n,s)}}},e.prototype.stopScenario=function(e,t){this.eventingService.$emit(this.constants.events.files.fileOneUpViewerLoaded,{conversationId:t,previewType:e,useWebview:this.getUseWebViewFlag(),scenario:this.scenario})},e.prototype.handleError=function(e,t,i,n){n||this.checkIfExpectedFailure(e)?this.scenario.incomplete({errorCode:e,errorMessage:t,conversationId:i,useWebview:this.getUseWebViewFlag(),isExpectedFailure:this.constants.files.isExpectedFailure.yes}):this.scenario.fail({errorCode:e,errorMessage:t,conversationId:i,useWebview:this.getUseWebViewFlag()})},e.prototype.checkIfExpectedFailure=function(e){var t=this.constants.responseCode;return-1!==[t.unauthorizedAccess,t.forbidden,t.notFound,t.notAcceptable].indexOf(Number(e))},e.prototype.getUseWebViewFlag=function(){return this.useWebView?"true":"false"},e.prototype.ensureInitialFocusIsNotStolen=function(){var e=this,t=angular.element(this.$window);this.onWindowBlur&&(t.unbind(this.constants.events.jQuery.blur,this.onWindowBlur),this.onWindowBlurDestroyHandler()),this.onWindowBlur=function(t){return e.onWindowBlurHandler(t)},t.on(this.constants.events.jQuery.blur,this.onWindowBlur),this.onWindowBlurDestroyHandler=this.$scope.$on("$destroy",function(){t.unbind(e.constants.events.jQuery.blur,e.onWindowBlur)})},e.prototype.onWindowBlurHandler=function(e){var t=this;angular.element(this.$window).unbind(this.constants.events.jQuery.blur,this.onWindowBlur),this.onWindowBlurDestroyHandler(),this.onWindowBlur=null,this.$timeout(function(){return angular.element(t.initialActiveElement).focus()},100,!1)},e}();angular.module("teamspace.fileOneUpViewer",["teamspace.settingsService","teamspace.utilityService","teamspace.authenticationService"]).component("fileOneUpViewer",{bindings:{scenario:"<",type:"<",siteUrl:"<",serverRelativeUrl:"<",errorCode:"=",fileDetail:"<",serviceName:"<",driveItem:"<"},template:n,controller:s})},1934:function(e,t){e.exports='<div id="file-one-up-viewer" class="flex-fill">\n\n  <form id="file-one-up-viewer-form" target="file-one-up-viewer-frame" method="POST" action="{{$ctrl.oneUpServiceUrl}}" hidden>\n    <input id="file-one-up-viewer-context" type="text" name="context"/>\n    <input type="submit"/>\n  </form>\n\n  <iframe id="file-one-up-viewer-frame" name="file-one-up-viewer-frame" ng-if="::!$ctrl.useWebView" ng-src="about:blank" sandbox="allow-forms allow-popups allow-pointer-lock allow-same-origin allow-scripts" class="wopi-iframe flex-fill" frameborder="0" role="presentation" tabindex="-1" aria-hidden="true">\n  </iframe>\n\n  <webview id="file-one-up-viewer-webview" ng-if="::$ctrl.useWebView" ng-src="{{$ctrl.webViewSrc}}" class="wopi-iframe flex-fill" frameborder="0" role="presentation" tabindex="-1" aria-hidden="true">\n  </webview>\n</div>\n'},1935:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1936),s=function(){function e(e,t,i,n,s,r,o,a,c,l,d,h,p,u,f,m,v,g,w,y,b,S,I){var E=this;this.$q=e,this.$scope=t,this.$state=i,this.$translate=n,this.constants=s,this.resources=r,this.loggingService=o,this.utilityService=a,this.routeUtilityService=c,this.filesEntityService=l,this.filesUtilityService=d,this.filesActionService=h,this.analyticsService=p,this.filesActionRouter=u,this.filesProviderFactory=f,this.settingsService=m,this.sharepointScenarioHandler=v,this.sharePointFilePreviewService=g,this.filesRedeemService=y,this.navigationService=b,this.platformDetectService=S,this.filesSharingHelper=I,this.isPreProcessingComplete=void 0,this.useNStarViewerExpInMainWindow=!1,this.scenarioComplete=!1,this.fileDetailsFetchSuccess=!1;var $=c.getRootRouteParams();this.ctx=$.ctx?decodeURIComponent($.ctx):void 0,this.accessType=$.accessType;var U;!this.objectUrl||$.fileName&&this.fileType||(U=d.getFileNameFromObjectURL(this.objectUrl)),this.fileName=$.fileName?$.fileName:U,!this.shareUrl&&$.shareUrl&&(this.shareUrl=$.shareUrl),!this.shareId&&$.shareId&&(this.shareId=$.shareId),I.shareLogInfo(s.files.actionLogs.fileOpen,this.fileId,this.shareUrl?"shareUrl exists":"shareUrl does not exist"),this.isNewFile=this.ctx===this.constants.scenarios.files.newFileCreationContext;var C,T=this.getActionType(),k=m.valueAsBoolean(s.settings.names.filesEnableSharePointFilePreviewService);if(i.current.name!==s.states.appDocumentViewer&&i.current.name!==s.states.appAppsAppFileSection||$.viewerAction!==s.files.fileActions.viewer.edit?(C=k?g.getPreviewerType(this.fileType):teamspace.services.files.modules.sharePoint.FilePreviewerTypes.Wac,this.wacEdit=!1):(C=k?g.getEditorType(this.fileType):teamspace.services.files.modules.sharePoint.FilePreviewerTypes.Wac,this.wacEdit=!0),this.objectUrl&&d.isNStarViewerExpInMainWindowEnabled(this.fileType)&&this.platformDetectService.getBrowser()!==this.constants.browser.ie&&(this.wacEdit=!0,this.useNStarViewerExpInMainWindow=!0,C=teamspace.services.files.modules.sharePoint.FilePreviewerTypes.UnifiedApp),w.$on(t,s.events.files.fileOneUpViewerLoaded,function(e,t){E.oneUpViewerLoadSucessMessage=t,E.stopScenario()}),this.useOneUp=C===teamspace.services.files.modules.sharePoint.FilePreviewerTypes.OneUp,this.scenario=o.findScenario(this.scenarioName),this.scenario||(o.warn("file-office-frame: could not find scenario"),this.scenario=o.newScenario(this.scenarioName,null,function(){E.scenarioComplete=!0},s.timeInMiliseconds.tenMinutes),this.scenario.eventData={type:this.fileType,entryPoint:this.ctx,serviceName:this.serviceName}),this.scenario.eventData.viewerType=C,this.scenario.eventData.type=d.scrubUnknownFileExtensions(this.fileType),this.baseUrl||(this.baseUrl=d.extractSiteUrl(this.objectUrl)),this.useOneUp&&(this.oneUpParams={baseUrl:this.baseUrl,fileType:this.fileType,scenario:this.scenario,serverRelativeUrl:d.extractServerRelativeUrl(this.objectUrl)}),this.useOneUp&&!a.isDocumentType(this.fileType))return this.setFileDetails(),void this.redeemFile(C,$,U,T,!1);this.useNStarViewerExpInMainWindow?this.redeemFile(C,$,U,T,!1):(this.redeemFile(C,$,U,T),t.$on("$destroy",function(){E.scenarioComplete||E.scenario.cancel()}))}return e.$inject=["$q","$scope","$state","$translate","constants","resources","loggingService","utilityService","routeUtilityService","filesEntityService","filesUtilityService","filesActionService","analyticsService","filesActionRouter","filesProviderFactory","settingsService","sharepointScenarioHandler","sharePointFilePreviewService","eventingService","filesRedeemService","navigationService","platformDetectService","filesSharingHelper"],e.prototype.getActionType=function(){if(this.isNewFile)return this.constants.wopiActions.editNew;switch(this.utilityService.getIconClass({type:this.fileType})){case this.constants.css.fileIcons.word:case this.constants.css.fileIcons.excel:return this.constants.wopiActions.open;case this.constants.css.fileIcons.powerpoint:return this.constants.wopiActions.edit;default:return}},e.prototype.redeemFile=function(e,t,i,n,s){var r=this;if(void 0===s&&(s=!0),this.shareUrl||this.useNStarViewerExpInMainWindow){var o={fileId:this.fileId,shareId:this.shareId};this.scenario.mark("redeem-call-started"),this.driveItemCallStartTime=Date.now(),this.redeemPromise=this.filesRedeemService.redeemFile(this.objectUrl,this.shareUrl,this.useNStarViewerExpInMainWindow,n,o),this.redeemPromise.then(function(n){r.scenario.mark("redeem-call-finished"),r.driveItem=n,r.isPreProcessingComplete=!0,s&&r.fetchFileDetailsAndSetHeaders(e,t,i)}).catch(function(e){r.loggingService.error("Error in redeeming file - "+e),r.scenario.mark("redeem-call-failed"),r.cleanNStarViewerExp(),r.onFileLoadError(e,!0)}).finally(function(){if(r.useNStarViewerExpInMainWindow&&(r.setFileDetails(),r.isPreProcessingComplete&&!(r.driveItem&&r.driveItem.openWith&&r.driveItem.openWith.wac))){r.scenario.mark("redeem-call-incomplete"),r.cleanNStarViewerExp();var e={statusCode:200,message:"jsAPI parameters missing in driveItem API response"};r.onFileLoadError(e,!0)}})}else this.isPreProcessingComplete=!0,s&&this.fetchFileDetailsAndSetHeaders(e,t,i)},e.prototype.cleanNStarViewerExp=function(){var e=document.getElementById("file-office-frame-experience-container");e&&e.parentNode.removeChild(e)},e.prototype.fetchFileDetailsAndSetHeaders=function(e,t,i){var n,s=this,r=this.filesProviderFactory.create(teamspace.services.files.FilesProviderType.Sharepoint),o=this.filesActionRouter.getItemDetailsRepository(r),a=!0;(this.useNStarViewerExpInMainWindow||e==teamspace.services.files.modules.sharePoint.FilePreviewerTypes.UnifiedApp)&&(a=!1);var c=t.rootContext?decodeURIComponent(t.rootContext):void 0;if(this.getByFileIdAndBaseUrl(c)){var l=this.fileType?this.fileType:this.utilityService.getFileExtension(i);n=o.getById(this.baseUrl,this.fileId,l===this.constants.onenote.extension,this.isNewFile,a)}else n=this.objectUrl?o.getByUrl(this.objectUrl,a):this.$q.reject(teamspace.services.files.FilesError.createFromInternalError(this.constants.files.internalErrorCodes.common.argumentError,"File is not specified."));n.then(function(e){s.scenario.mark("details-call-finished"),s.fileDetail=e.value,s.fileDetail.size&&(s.scenario.eventData.size=s.utilityService.bytesToMb(s.fileDetail.size)),s.useOneUp||(s.wacUrl=s.wacEdit?s.fileDetail.wacUrlEdit:s.fileDetail.wacUrl),s.fileName||(s.fileName=s.fileDetail.title);var t=s.getSiteUrlFromFileDetails(s.fileDetail);if(t=decodeURIComponent(t),s.baseUrl!==t&&(s.baseUrl=t),s.useOneUp){if(!s.oneUpParams){var i=decodeURIComponent(s.fileDetail.objectUrl);s.oneUpParams={baseUrl:t,fileType:s.fileType,scenario:s.scenario,serverRelativeUrl:s.filesUtilityService.extractServerRelativeUrl(i)}}s.oneUpParams.fileDetail=s.fileDetail,s.oneUpParams.serviceName=s.serviceName}return s.fileDetail}).then(function(e){s.initializeTitleAndStopScenario()}).catch(function(e){return s.onFileLoadError(e,!1,!0)})},e.prototype.setFileDetails=function(){var e=this.objectUrl;this.isPreProcessingComplete&&this.driveItem&&this.driveItem.webUrl&&(e=this.driveItem.webUrl),this.fileDetail={objectId:this.fileId,objectUrl:this.objectUrl,title:this.fileName,type:this.fileType,wacUrl:"",wacUrlEdit:"",openInWindowFileUrl:e,isPersonal:this.serviceName===this.constants.files.serviceName.personal,siteUrl:""},this.oneUpParams&&(this.oneUpParams.fileDetail=this.fileDetail,this.oneUpParams.serviceName=this.serviceName),this.initializeTitleAndStopScenario()},e.prototype.initializeTitleAndStopScenario=function(){this._initializeTitleBar(),this.fileDetailsFetchSuccess=!0,this.stopScenario()},e.prototype.getByFileIdAndBaseUrl=function(e){return this.baseUrl&&this.fileId&&(e===this.constants.scenarios.files.itemsViewRootContext||this.fileType!==this.constants.onenote.extension)},e.prototype.getSiteUrlFromFileDetails=function(e){return e&&e.objectUrl||this.onFileLoadError({errorCode:void 0,internalErrorCode:""+this.constants.files.internalErrorCodes.common.invalidUrl,statusCode:200},!1,!0),e.siteUrl?e.siteUrl:(e.parentListUrl||this.onFileLoadError({errorCode:void 0,internalErrorCode:""+this.constants.files.internalErrorCodes.sharepoint.missingListUrl,statusCode:200},!1,!0),this.filesUtilityService.extractSiteUrl(e.objectUrl,e.parentListUrl))},e.prototype.stopScenario=function(){if(this.oneUpViewerLoadSucessMessage&&this.fileDetailsFetchSuccess&&this.oneUpParams&&this.oneUpParams.scenario&&this.oneUpViewerLoadSucessMessage.scenario===this.scenario){var e={conversationId:this.oneUpViewerLoadSucessMessage.conversationId,previewType:this.oneUpViewerLoadSucessMessage.previewType,useWebview:this.oneUpViewerLoadSucessMessage.useWebview};this.oneUpParams.scenario.stop(e)}},e.prototype._initializeTitleBar=function(){var e=this;if(this.fileDetail){var t={serviceName:this.serviceName,getContextBase:function(){return e.filesUtilityService.getContextBase(e.fileDetail,e.serviceName,void 0,e.fileDetail.objectUrl,!1)}},i=this.filesActionService.isReadOnlyNotTeamOwner({accessType:this.accessType,threadId:this.threadId}),n=this.filesEntityService.getOpenInText(this.fileDetail.type,i),s=this.settingsService.valueAsBoolean(this.constants.settings.names.filesEnableSharePointFilePreviewService);if(this.filesUtilityService.isVisioDesktopAppOnlyEditEnabled(this.fileDetail.type)){this.editAction=function(){return e.filesActionService.execute(teamspace.services.EntityActionType.OpenInDesktopApp,e.fileDetail,t)};var r=this.filesUtilityService.getProductLabels(this.fileDetail.type);this.titleBarPrimaryOptions={primaryButtonText:r.desktopProductName,primaryButtonAria:this.$translate.instant(this.resources.strings.files_editButtonAriaLabelVisio)}}else{var o=this.settingsService.valueAsBoolean(this.constants.settings.names.enableOfficeViewerEdit);o&&(this.editAction=function(){return e.changeToEdit()});var a=i?this.resources.strings.files_menuLabelOpenInTeams:this.resources.strings.files_menuLabelEditInTeams,c=o&&(!s||this.sharePointFilePreviewService.canEditFileInTeams(this.fileDetail.type)),l={id:"office-edit-in-teams",displayName:this.$translate.instant(a),class:"open-in-teams-entry",click:function(){return e.changeToEdit()},shouldBeHidden:function(){return!c},svgPath:"svg/icons-msft-teams.html"},d=s?this.sharePointFilePreviewService.canEditFileInDesktopApp(this.fileDetail.type)&&this.fileDetail.objectUrl:this.filesActionService.canUse(teamspace.services.EntityActionType.OpenInDesktopApp,this.fileDetail,{serviceName:this.serviceName}),h={id:"office-open-in-desktop-app",displayName:n.openInDesktopAppText,click:function(){return e.filesActionService.execute(teamspace.services.EntityActionType.OpenInDesktopApp,e.fileDetail,t)},shouldBeHidden:function(){return!d},svgPath:"svg/"+this.utilityService.getSVGBase(this.fileDetail.type,"icons-{type}")+".html"},p=s?this.sharePointFilePreviewService.canEditFileInSharePoint(this.fileDetail.type)&&this.fileDetail.openInWindowFileUrl:this.filesActionService.canUse(teamspace.services.EntityActionType.OpenInNewTab,this.fileDetail,{serviceName:this.serviceName});this.openInNewTabMenuItem={id:"office-open-in-new-tab",displayName:n.openInNewTabText,click:function(){return e.filesActionService.execute(teamspace.services.EntityActionType.OpenInNewTab,e.fileDetail,t)},shouldBeHidden:function(){return!p},svgPath:"svg/"+this.utilityService.getSVGBase(this.fileDetail.type,"icons-{type}")+".html"};var u=i?this.resources.strings.files_openButtonLabel:this.resources.strings.files_editButtonLabel;this.titleBarPrimaryOptions={primaryButtonText:this.$translate.instant(u),primaryButtonAria:this.$translate.instant(this.resources.strings.files_editButtonAriaLabel),dropdownButtonText:this.$translate.instant(this.resources.strings.files_moreEditOptionsButtonLabel),options:[l,h,this.openInNewTabMenuItem]}}this.titleBarMoreOptions=[{id:"download-office-document",displayName:this.$translate.instant(this.resources.strings.files_menuLabelDownload),click:function(){return e.filesActionService.execute(teamspace.services.EntityActionType.Download,e.fileDetail,t)},shouldBeHidden:function(){return!e.filesActionService.canUse(teamspace.services.EntityActionType.Download,e.fileDetail,{serviceName:e.serviceName,showActionMenuDownload:!0})},svgPath:"svg/icons-download.html"},{id:"open-office-document-in-sharepoint",displayName:this.filesActionService.textFor(teamspace.services.EntityActionType.OpenInSharePoint,{serviceName:this.serviceName}),click:function(){return e.filesActionService.execute(teamspace.services.EntityActionType.OpenInSharePoint,e.fileDetail,null)},shouldBeHidden:function(){return!e.filesActionService.canUse(teamspace.services.EntityActionType.OpenInSharePoint,e.fileDetail,{serviceName:e.serviceName})},svgPath:"svg/"+this.filesActionService.iconFor(teamspace.services.EntityActionType.OpenInSharePoint,this.fileDetail,{serviceName:this.serviceName}).first+".html"},{id:"office-open-in-desktop-app",displayName:n.openInDesktopAppText,click:function(){return e.filesActionService.execute(teamspace.services.EntityActionType.OpenInDesktopApp,e.fileDetail,t)},shouldBeHidden:function(){return!e.filesActionService.canUse(teamspace.services.EntityActionType.OpenInDesktopApp,e.fileDetail,{serviceName:e.serviceName})||!e.wacEdit},svgPath:"svg/"+this.utilityService.getSVGBase(this.fileDetail.type,"icons-{type}")+".html"},{id:"office-open-in-new-tab",displayName:n.openInNewTabText,click:function(){return e.filesActionService.execute(teamspace.services.EntityActionType.OpenInNewTab,e.fileDetail,t)},shouldBeHidden:function(){return!e.filesActionService.canUse(teamspace.services.EntityActionType.OpenInNewTab,e.fileDetail,{serviceName:e.serviceName})||!e.wacEdit},svgPath:"svg/"+this.utilityService.getSVGBase(this.fileDetail.type,"icons-{type}")+".html"}],this.threadId&&(this.titleBarConversationInfo={threadId:this.threadId,objectId:this.fileDetail.objectId,serviceName:this.serviceName,objectUrl:this.fileDetail.objectUrl})}},e.prototype.getAccessibleIframeNotice=function(){if(this.openInNewTabMenuItem)return this.$translate.instant(this.resources.strings.files_accessible_iframe_notice)},e.prototype.openInNewTab=function(e){e.which===this.constants.keyCodes.enter&&e.target===e.currentTarget&&(this.openInNewTabMenuItem.click(),e.preventDefault(),this.analyticsService.onPanelAction(this.$scope,{action:{gesture:teamspace.components.PanelActionGesture.click,scenario:teamspace.components.PanelActionScenario.openFile,scenarioType:teamspace.components.PanelActionScenarioType.files},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.documentStage.toString(),teamspace.components.PanelModuleName,this.loggingService).toString(),type:teamspace.components.PanelModuleType.viewer,summary:"Opening document from accessible iframe wrapper"},dataBag:{wacAccessibilityOpenOnline:!0}}))},e.prototype.changeToEdit=function(){var e=this;if(this.scenarioComplete||this.scenario.cancel({errorCode:"changeToEdit"}),this.scenarioComplete=!1,this.scenario=this.loggingService.newScenario(this.constants.scenarios.files.editFileFullScreen+"_"+this.serviceName,null,function(){e.scenarioComplete=!0}),this.scenario.eventData={type:this.fileType,entryPoint:this.ctx,serviceName:this.serviceName},this.$state.current.name==this.constants.states.appDocumentViewer){var t=this.routeUtilityService.getRootRouteParams();t.viewerAction=this.constants.files.fileActions.viewer.edit;var i={documentViewerParams:t,viewerState:this.constants.states.appDocumentViewer};this.navigationService.navigateToFileViewer(i,{location:"replace",notify:!1})}this.wacUrl=this.fileDetail.wacUrlEdit,this.wacEdit=!0},e.prototype.onFileLoadError=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),this.fileErrorCode=e&&(e.errorCode||e.internalErrorCode||e.statusCode)||this.constants.files.error.unknown;var n=_.get(e,"errorMessage.error");if(this.errorReasonForTelemetry=n&&n["error.errorMessage.error"],t||i){if(!e)return void this.scenario.fail({errorCode:"Unknown Error"});var s=e.statusCode,r=e.message||e.internalErrorCode||this.errorReasonForTelemetry;if(!s)return void this.scenario.fail({errorCode:"Unknown status code",errorMessage:r});if("number"!=typeof s){var o="type: "+typeof s+", status: "+s;return r=r?o+", message: "+r:o,void this.scenario.fail({errorCode:"Invalid status code type",errorMessage:r})}switch(s){case this.constants.responseCode.clientFailure:case this.constants.responseCode.badRequest:case this.constants.responseCode.internalServerError:case this.constants.responseCode.serviceUnavailable:case this.constants.responseCode.ok:this.scenario.fail({errorCode:s,errorMessage:r});break;default:this.scenario.incomplete({errorCode:s,errorMessage:r})}}else if(this.scenario.mark("scenario-stop-pending"),this.filesSharingHelper.shareLogInfo(this.constants.files.actionLogs.fileOpenError,this.fileId,this.fileErrorCode,this.errorReasonForTelemetry),this.scenario){var a={errorCode:e&&(e.errorCode||e.internalErrorCode),statusCode:e&&e.statusCode};this.sharepointScenarioHandler.getFilesScenario(a,this.constants.files.scenarioActions.getFiles).finishScenario(this.scenario)}},e}();angular.module("teamspace.fileOfficeFrame",["teamspace.loggingService","teamspace.utilityService","teamspace.routeUtilityService","teamspace.filesUtilityService","teamspace.filesActionService","teamspace.filesEntityService","teamspace.filesRedeemService","teamspace.analyticsService","teamspace.platformDetectService","teamspace.authenticationService","teamspace.services.files.modules.sharePoint.sharePointFileDetailsRepository","teamspace.services.files.modules.sharePoint.sharePointFilePreviewService","teamspace.services.files.modules.scenarios.sharepointScenarioHandler","teamspace.services.files.modules.sharePoint.vroom.sharepointShareService","teamspace.navigationService","teamspace.services.files.modules.sharePoint.filesSharingHelper"]).component("fileOfficeFrame",{bindings:{serviceName:"<",fileType:"<",objectUrl:"<",baseUrl:"<",fileId:"<",threadId:"<?",onTitleBarClosed:"&?",scenarioName:"<",userClickTime:"<",shareUrl:"<",shareId:"<"},template:n,controller:s})},1936:function(e,t){e.exports='<div id="file-office-frame" class="flex-fill">\n\n  \x3c!-- busy animation --\x3e\n  <busy-animation size="medium" ng-if="!($ctrl.fileDetail || ($ctrl.useOneUp && $ctrl.oneUpParams && !$ctrl.wacEdit)) && !$ctrl.fileErrorCode && !$ctrl.useNStarViewerExpInMainWindow" context="file-office-frame">\n  </busy-animation>\n\n  <file-document-title-bar ng-if="$ctrl.fileDetail || $ctrl.fileErrorCode" is-edit-mode="$ctrl.wacEdit" edit-action="$ctrl.editAction" file-name="::$ctrl.fileName" file-type="::$ctrl.fileType" file-id="::$ctrl.fileId" hide-close="::!$ctrl.onTitleBarClosed" on-close="::$ctrl.onTitleBarClosed()" is-enabled="true" primary-options="::$ctrl.titleBarPrimaryOptions" more-options="::$ctrl.titleBarMoreOptions" error="$ctrl.fileErrorCode" error-reason-for-telemetry="$ctrl.errorReasonForTelemetry" conversation-info="::$ctrl.titleBarConversationInfo">\n  </file-document-title-bar>\n\n  <file-full-alert class="flex-fill" error="$ctrl.fileErrorCode" ng-if="$ctrl.fileErrorCode" object-url="{{$ctrl.objectUrl}}" share-url="{{$ctrl.shareUrl}}">\n  </file-full-alert>\n\n  <div class="office-frame flex-fill">\n    <div tabindex="0" set-focus="true" id="file-office-frame-container" acc-role="tab-handler-document-viewer-frame" role="application" class="flex-fill office-viewer-container" aria-label="{{::$ctrl.getAccessibleIframeNotice()}}" ng-if="::$ctrl.isPreProcessingComplete && !$ctrl.useNStarViewerExpInMainWindow" ng-keydown="$ctrl.openInNewTab($event)">\n      <file-office-viewer ng-if="$ctrl.fileDetail && ($ctrl.wacEdit || !$ctrl.useOneUp) && !$ctrl.useNStarViewerExpInMainWindow" type="::$ctrl.fileDetail.type" scenario="$ctrl.scenario" wac-url-source="$ctrl.wacUrl" wac-edit="$ctrl.wacEdit" ctx="::$ctrl.ctx" file-type="::$ctrl.fileType" class="flex-fill">\n      </file-office-viewer>\n      <file-one-up-viewer ng-if="$ctrl.oneUpParams && !$ctrl.wacEdit && !$ctrl.fileErrorCode && !$ctrl.useNStarViewerExpInMainWindow" type="::$ctrl.oneUpParams.fileType" scenario="$ctrl.oneUpParams.scenario" site-url="$ctrl.oneUpParams.baseUrl" server-relative-url="$ctrl.oneUpParams.serverRelativeUrl" file-detail="::$ctrl.oneUpParams.fileDetail" service-name="::$ctrl.oneUpParams.serviceName" error-code="$ctrl.fileErrorCode" drive-item="$ctrl.driveItem" class="flex-fill">\n      </file-one-up-viewer>\n    </div>\n\n    <div tabindex="0" set-focus="true" id="file-office-frame-experience-container" class="flex-fill office-viewer-container" acc-role="tab-handler-document-viewer-frame" role="application" aria-label="{{::$ctrl.getAccessibleIframeNotice()}}" ng-if="$ctrl.useNStarViewerExpInMainWindow" ng-keydown="$ctrl.openInNewTab($event)">\n      <div id="ts-unified-app-loader">\n        <busy-animation size="medium" context="file-unified-app-viewer">\n        </busy-animation>\n      </div>\n      \x3c!-- ng-show ensures that files experience is not visible till redeem call succeeds.--\x3e\n      <file-unified-app-viewer ng-if="!$ctrl.fileErrorCode" ng-show="::$ctrl.isPreProcessingComplete" file-type="::$ctrl.fileType" object-url="::$ctrl.objectUrl" user-click-time="::$ctrl.userClickTime" scenario="::$ctrl.scenario" ctx="::$ctrl.ctx" drive-item-call-start-time="::$ctrl.driveItemCallStartTime" class="flex-fill" redeem-promise="$ctrl.redeemPromise">\n      </file-unified-app-viewer>\n    </div>\n  </div>\n</div>'},1937:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1938),s=function(){function e(e,t,i,n,s,r,o,a,c,l){var d=this;this.$scope=e,this.$sce=t,this.$window=i,this.$location=n,this.$timeout=s,this.constants=r,this.utilityService=a,this.filesUtilityService=l,this.initialActiveElement=document.getElementById("file-office-frame-container")||window,this.isOneNote=r.fileExtensions.onenote.indexOf(this.type)>=0,this.isVisio=r.fileExtensions.visio.indexOf(this.type)>=0,this.isElectronApp=c.isElectron(),this.useHwaWebView=c.isHwa()&&o.valueAsBoolean(r.settings.names.enableMsWebViewFileOfficeViewer),this.useElectronWebView=this.isElectronApp;var h=i.electronSafeIpc;this.useHwaWebView?(this.init(),this._stopFullScreenScenario()):h&&this.useElectronWebView?(h.send(r.events.desktopApp.allowWebViewCreate),h.once(r.events.desktopApp.webViewCreationEnabled,function(){d.init(),d._stopFullScreenScenario(),d.isWebViewCreationEnabled=!0})):(this.init(),this._registerScenarioEnd()),this._ensureInitialFocusIsNotStolen()}return e.$inject=["$scope","$sce","$window","$location","$timeout","constants","settingsService","utilityService","desktopUtilityService","filesUtilityService"],e.prototype.$onChanges=function(e){var t=this;if(e.wacUrlSource&&!e.wacUrlSource.isFirstChange()){var i=this.$window.electronSafeIpc;i&&this.useElectronWebView&&this.isWebViewCreationEnabled||this.useHwaWebView?(this.init(),this._stopFullScreenScenario()):i&&this.useElectronWebView||(this.wacUrl=null,this.$timeout(function(){return t.init()},0,!1),this._registerScenarioEnd())}},e.prototype.init=function(){var e=this,t=this.wacUrlSource+"&hh=1",i=t.match(/sc=pmo[^&]*/g);t=t.replace(/sc=.*?&/g,""),this.wacEdit?t+="&sc=OwaEdit":i&&i.length&&(t=t+"&"+i[0]),t+="&uih=Teams";var n=this.filesUtilityService.isNStarViewerExpInMainWindowEnabled(this.fileType);t=this.ctx===this.constants.scenarios.files.newFileCreationContext&&n?t+"&uiEmbed=1":t;var s=this.utilityService.parseUrl(t);if(this.wacOrigin=s&&s.origin,this.wacUrl=this.$sce.trustAsResourceUrl(t),this.sourceElement=document.getElementsByClassName("wopi-iframe")[0],this.sourceElement){var r=this.layout.bind(this);this.sourceElement.addEventListener("dom-ready",r),this.$window.addEventListener("resize",r),this.$scope.$on("$destroy",function(){e.sourceElement.removeEventListener("dom-ready",r),e.$window.removeEventListener("resize",r)})}},e.prototype.layout=function(){if(this.sourceElement&&this.$window.electronSafeIpc){this.uuid||(this.uuid=this.utilityService.generateUUID());var e=this.sourceElement.clientWidth,t=this.sourceElement.clientHeight;this.$window.electronSafeIpc.send(this.constants.events.desktopApp.webViewResize,{width:e,height:t,uuid:this.uuid})}},e.prototype._registerScenarioEnd=function(){var e=this,t=this.$location.host();if(!(!this.useElectronWebView&&(t.endsWith(this.constants.counters.skype.skypeDomain)||t.endsWith(this.constants.counters.microsoft.domain)))||this.isOneNote||this.isVisio||this.wacEdit)this._stopFullScreenScenario();else{var i=angular.element(this.$window);this._onPostMessageReceive&&(i.unbind("message",this._onPostMessageReceive),this._onPostMessageReceiveDestroyHandler()),this._onPostMessageReceive=function(t){return e._postMessageReceiveHandler(t)},i.on("message",this._onPostMessageReceive),this._onPostMessageReceiveDestroyHandler=this.$scope.$on("$destroy",function(){i.unbind("message",e._onPostMessageReceive)})}},e.prototype._postMessageReceiveHandler=function(e){var t=e.originalEvent||e;if(t&&t.origin&&t.origin===this.wacOrigin){var i=JSON.parse(t.data||"{}");i.MessageId&&i.MessageId.toLowerCase()==="App_LoadingStatus".toLowerCase()&&(this._stopFullScreenScenario("wac"),angular.element(this.$window).unbind("message",this._onPostMessageReceive),this._onPostMessageReceiveDestroyHandler(),this._onPostMessageReceive=null)}},e.prototype._stopFullScreenScenario=function(e){void 0===e&&(e=""),this.scenario&&this.scenario.stop({context:e})},e.prototype._ensureInitialFocusIsNotStolen=function(){var e=this;this.focusCounter=0;var t=angular.element(this.$window);this._onWindowBlur&&(t.unbind(this.constants.events.jQuery.blur,this._onWindowBlur),this._onWindowBlurDestroyHandler()),this._onWindowBlur=function(t){return e._onWindowBlurHandler(t)},t.on(this.constants.events.jQuery.blur,this._onWindowBlur),this._onWindowBlurDestroyHandler=this.$scope.$on("$destroy",function(){t.unbind(e.constants.events.jQuery.blur,e._onWindowBlur)})},e.prototype._onWindowBlurHandler=function(e){var t=this;this.focusCounter++;var i=this.isOneNote?2:1;this.focusCounter==i&&(angular.element(this.$window).unbind(this.constants.events.jQuery.blur,this._onWindowBlur),this._onWindowBlurDestroyHandler(),this._onWindowBlur=null),this.$timeout(function(){return angular.element(t.initialActiveElement).focus()},100,!1)},e}();angular.module("teamspace.fileOfficeViewer",["teamspace.settingsService","teamspace.filesUtilityService"]).component("fileOfficeViewer",{bindings:{type:"<",scenario:"<",wacEdit:"<",wacUrlSource:"<",ctx:"<",fileType:"<"},template:n,controller:s})},1938:function(e,t){e.exports='<div id="file-office-viewer" class="flex-fill">\n\n  <iframe ng-if="$ctrl.wacUrl && !($ctrl.useElectronWebView || $ctrl.useHwaWebView)" ng-src="{{$ctrl.wacUrl}}" ng-attr-sandbox="{{ ::$ctrl.isElectronApp ? \'allow-forms allow-popups allow-pointer-lock allow-same-origin allow-scripts\' : undefined }}" class="wopi-iframe flex-fill" frameborder="0" role="presentation" tabindex="-1" aria-hidden="true">\n  </iframe>\n\n  <webview ng-if="::$ctrl.useElectronWebView && !$ctrl.useHwaWebView" ng-src="{{$ctrl.wacUrl}}" class="wopi-iframe flex-fill" frameborder="0" role="presentation" tabindex="-1" aria-hidden="true">\n  </webview>\n\n  \x3c!-- TODO tac: use embedded-page-container instead once it supports url updates --\x3e\n  <x-ms-webview ng-if="::$ctrl.useHwaWebView" ng-src="{{$ctrl.wacUrl}}" class="wopi-iframe flex-fill" frameborder="0" role="presentation" tabindex="-1" aria-hidden="true">\n  </x-ms-webview>\n</div>\n'}},[1926]);
//# sourceMappingURL=https://statics.teams.microsoft.com/hashedjs/lazy-ng1-mod-files-components.min.js-50727a42.map